var defaultTip={regMobile:"目前手机注册仅支持中国大陆地区手机号",regMobileFormat:'请输入合法手机号，海外用户请用<a href="http://reg.renren.com/xn6245.do">邮箱注册</a>',regMobileEmpty:"还没有填写手机号",pwd:"请输入6-20 个字符作为登录密码",name:"请输入真实中文名称，让朋友更容易找到你",c_id:"请输入真实的身份证号码",f_id:"请输入正确的证件号码",icode:"请输入4位验证码",reg_birthday:"请选择生日",gender:"请选择性别",stage:"请选择身份",verify_phone:"请输入需要更改的手机号",verify_icode:"请输入5位验证码",verify_icode_again:'没有收到验证码？建议您使用<a href="http://reg.renren.com/xn6245.do">邮箱注册</a>',verify_icode_error:"5位验证码输入有误"},completeForm={config:{showTimer:""},init:function(){this.addEvent(),$("#btn_getcode").attr("disabled",!0)},createFriDialog:function(e){for(var r="",o=e.length,i=0;o>i;i++){var a=e[i];r+='<li class="fri-list-item" data-id="'+a.id+'" data-status="false"><a href="#nogo" class="fir-list-a"><span class="fri-thumb"><img src="'+a.head+'"/></span><span class="fri-name">'+a.name+'</span><span class="fri-add-btn">加为好友</span></a></li>'}var s=$("<div></div>").html(['<div class="addfri-dialog-con">','<div class="addfri-dialog-main">','<h3 class="address-fri-title">他们的同学录里有你的手机号，也许是你的朋友</h3>','<div class="address-fri-con" id="address-fri-con">','<ul class="address-fri-list" id="address-fri-list">'+r+"</ul>","</div></div>",'<div class="address-fri-bom">','<a href="http://guide.renren.com/fillinfonew" class="go-baseInfo-btn">保存</a>','<a href="http://guide.renren.com/fillinfonew">跳过</a></div>',"</div>"].join(""));return s},addFriends:function(e,r){This=this,nx.user._rtk=nx.user._rtkNew;var o=e.parent();$.ajax({type:"POST",url:"http://guide.renren.com/ajaxRequestFriendsInGuideFlow",data:"code=0&friends="+r+"&from=gt_inforec_guide3&pos=1",dataType:"json",success:function(r){if(0==r.code){e.addClass("addfri"),o.attr("data-status","true"),This.addFriNum++;var i=$("#friend-timeline");i.find(".item-icon").addClass("itemflag"),This.createFriInfo(i)}else 1==r.code&&$.dialog.error(r.msg)}})},addressFriList:function(e){require(["ui/dialog"],function(){var r=completeForm.createFriDialog(e);$(r).dialog({dialogClass:"address-fri-win",title:"认识那些人？",width:"618px",buttons:!1}),require(["ui/scrollbar"],function(){$("#address-fri-con").scrollbar({})}),$(".addfri-dialog-con").delegate(".fir-list-a","click",function(){var e=$(this);if(!e.hasClass("addfri")){var r=e.parent(),o=r.attr("data-id");completeForm.addFriends(e,o)}})})},getMobileFriend:function(){$("#friend-timeline").addClass("show"),$.ajax({type:"GET",url:"http://guide.renren.com/addressfriendnew",dataType:"json",success:function(e){var r=e.candidate;completeForm.addressFriList(r)}})},addEvent:function(){var e=this;$("#error-show").hover(function(){clearTimeout(e.config.showTimer)},function(){$(this).hide()}),$("#regMobile").blur(function(){var r=$("#btn_getcode").val();"发送次数过多"===r?$("#btn_getcode").attr("disabled",!0):e.checkPhone()}),$("#regMobile").keyup(function(r){e.errorHide($(this))}),$("#pwd").blur(function(){var r=$("#error-show");r.is(":visible")&&-1!==r.html().indexOf("http")||e.checkPassword()}),$("#pwd").keyup(function(){e.errorHide($(this)),e.checkPasswordRank()}),$("#regMobile").keyup(function(){$("#pg").removeClass("mobileright"),$("#pg").removeClass("mobilewrong")}),$("#btn_getcode").click(function(){e.checkGrapAjax()}),$("#phone_button_submit").click(function(){var r=$("#regMobile").val(),o=$("#pwd").val(),i=$("#icode").val();return""==r?void e.showRegError("请填写手机号码"):""==o?void e.showRegError("请填写密码"):""==i?void e.showRegError("请填写短信验证码"):void $.ajax({type:"POST",url:"http://reg.renren.com/m-v7reg.do",data:"regEmail="+r+"&pwd="+o+"&icode="+i+"&ss=10113&action_id=206218&accType=3&g=g&b=b&icode_type=web_reg",dataType:"json",success:function(e){1==e.code?define(function(require){require("ui/dialog"),$.dialog.error(e.msg)}):0==e.code&&$.ajax({type:"GET",url:"http://guide.renren.com/fillinfonew",dataType:"text",success:function(e){var r=e.match(/requestToken[^\d]*(\d+)/im)[1],o=e.match(/\_rtk\s*\:\s*\'(.*?)\'/)[1];nx.user.requestToken=r,nx.user._rtkNew=o,nx.user.requestToken&&nx.user._rtkNew&&completeForm.getMobileFriend()}})}})})},errorHide:function(e){var r=e.val();""===r&&e.next().attr("class","")},checkPhone:function(){var e=this,r=$("#regMobile").val().trim();return""==r?(e.showRegError(defaultTip.regMobileEmpty),void $("#btn_getcode").attr("disabled",!0)):11===r.length&&"100"===r.substr(0,3)?!0:/^1[3|4|5|7|8][0-9]\d{8}$/.test(r)?(e.checkPhoneAjax(),$("#btn_getcode").attr("disabled",!1),!0):(e.showRegError(defaultTip.regMobileFormat),$("#btn_getcode").attr("disabled",!0),!1)},showPhoneTip:function(){""==$("#regMobile").val()&&this.showRegError(defaultTip.regMobile)},showRegError:function(e){var r=this;$("#error-show").html(e),$("#error-show").show(),r.config.showTimer&&clearTimeout(r.config.showTimer),r.config.showTimer=setTimeout(function(){$("#error-show").hide(50)},3e3)},checkPassword:function(){var e=this;if(""!=$("#pwd").val()){var r=$("#pwd").val().trim(),o=r.length;return 6>o||o>20?(e.showRegError("密码应由6-20 个字符组成"),!1):!0}return e.showRegError("请输入密码，不能为空"),!1},checkPasswordRank:function(){var e=$("#pwd").val().trim(),r=e.length,o=this;if(6>r&&r>=0)return!1;switch(o.isPwdTooSimple(e)){case 1:r>=6&&14>r?($("#wg").addClass("weak"),$("#wg").removeClass("strong"),$("#wg").removeClass("middle")):r>=14?($("#wg").addClass("middle"),$("#wg").removeClass("weak"),$("#wg").removeClass("")):($("#wg").addClass("weak"),$("#wg").removeClass("middle"),$("#wg").removeClass("weak"));break;case 2:r>=6&&14>r?($("#wg").addClass("middle"),$("#wg").removeClass("weak"),$("#wg").removeClass("strong")):r>=14&&($("#wg").addClass("strong"),$("#wg").removeClass("middle"),$("#wg").removeClass("weak"));break;default:$("#wg").addClass("strong"),$("#wg").removeClass("middle"),$("#wg").removeClass("weak")}return!0},isPwdTooSimple:function(e){for(var r=0,o=0,i=0,a=0,s=0,t=e.length,d=0;t>d;d++){var n=e.charCodeAt(d);n>=48&&57>=n?r++:n>=65&&90>=n?o++:n>=97&&122>=n?i++:a++}return r>0&&s++,o>0&&s++,i>0&&s++,a>0&&s++,s},showRegMessage:function(e){$("#error-show").html(e),$("#error-show").show(),setTimeout(function(){$("#error-show").hide(50)},3e3)},checkGrapAjax:function(){var e=this,r=$("#regMobile").val(),o=($("#textinput").val(),$("#btn_getcode"));return""===r?!1:void define(function(require){require("ui/dialog");var i="http://reg.renren.com/ajax-mobile-code-new.do",a=function(){$.dialog.verify("让我们确定你不是机器人","web_reg",function(s,t){$.post(i,{opt:1,mn:r,icode:t,icode_type:"web_reg"},function(r){var i=r.code;if("0"===i){console.log(123);var s=60;o.val(s+"秒重新发送");var t=setInterval(function(){s--,0!=s?(o.val(s+"秒重新发送"),o.removeClass("verify_geticode").addClass("verify_geticode_over"),o.css("cursor","default"),o.attr("disabled","disabled")):(clearInterval(t),o.removeAttr("disabled"),o.val("发送验证码"),o.css("cursor","pointer"),o.removeClass("verify_geticode_over").addClass("verify_geticode"))},1e3)}else"-1"===i?(o.val("不可再发送验证码"),o.removeClass("verify_geticode").addClass("verify_geticode_over"),e.showRegError("手机号码已被机主屏蔽注册，可联系机主解除屏蔽"),$("#icode_error_span").removeClass("error")):"-3"===i?(o.val("发送次数过多"),$("#btn_getcode").attr("disabled",!0),o.removeClass("verify_geticode").addClass("verify_geticode_over"),e.showRegError('发送验证码次数过多，如仍未收到激活码，请使用<a href="http://reg.renren.com/xn6245.do">邮箱</a>注册'),$("#icode_error_span").removeClass("error")):-4==i&&$.dialog.error("您的图形验证码输入错误，请重新输入",a())},"json")})};a()})},checkPhoneAjax:function(){var e=this,r=$("#regMobile").val(),o="http://reg.renren.com/AjaxRegisterAuth.do";$.ajax({url:o,data:"authType=email&stage=3&t="+(new Date).getTime()+"&value="+r,type:"post",dataType:"text",success:function(r){e.checkPhoneAjaxLoad(r)}})},checkPhoneAjaxLoad:function(e){return"OK"==e||"OKNAME"==e?(this.mobileChecked=!0,$("#pg").addClass("mobileright"),$("#pg").removeClass("mobilewrong"),!0):""!=e?(this.mobileChecked=!1,this.showRegError(e),$("#pg").removeClass("mobileright"),$("#pg").addClass("mobilewrong"),this.showRegError("手机号已经绑定，不能注册"),!1):void this.hideRegError("regMobile")}};$(function(){completeForm.init()});