function playShadow(e){e(".live-content a").attr("href","javascript:;").attr("target","");var t=e('<div class="w-play-shadow"></div>');e(".live-content a").mouseenter(function(){var i=e(".w-play-shadow");i.length<=0&&t.appendTo(e(this)).fadeIn()}).mouseleave(function(){var t=e(".w-play-shadow");t.length&&t.fadeOut().remove()})}function getHotList(e){e.ajax({url:"http://zhibo.renren.com/liveroom/hot/list",type:"get",data:{offset:0,limit:10},dataType:"JSON",success:function(t){if(0==t.code){for(var i=t.data,n=i.length>3?3:t.data.length,a="",s=0;n>s;s++)a+=['<li class="list-item">','<a href="http://zhibo.renren.com/liveroom/'+i[s].activityId+'?channelId=10013" data-id="'+i[s].activityId+'" target="_blank">','<img class="poster" src="'+i[s].coverImgUrl+'" alt="'+i[s].name+'的直播间">',' <div class="live-info">','<p class="title ellip">'+i[s].title+"</p>",'<p class="name ellip">'+i[s].name+"</p>",'<p class="view-count">'+i[s].viewerTotalCount+"人</p>","</div>",'<div class="live-icon"></div>','<div class="mask-play"></div>',"</a>","</li>"].join("");nx.data.isDoubleFeed?(e(".liveRightCol .liveListUl").empty(),e(".liveRightCol .liveListUl").append(a),e(".liveRightCol").show(),e(".liveLeftCol").hide()):(e(".liveLeftCol .liveListUl").empty(),e(".liveLeftCol .liveListUl").append(a),e(".liveLeftCol").show(),e(".liveRightCol").hide())}}})}var test=1;console.log("all"),define("ui/renren/huati",function(require,e){require("ui/tooltip"),console.log("all4");var t=require("jquery"),i=require("mustache.js"),n={wrapHtml:['<div id="huatiBoxIn">','<div class="side-item-header clearfix">',"<h4>热门话题</h4>",'<div class="option">','<a href="#nogo" class="pager-btn pager-back back-disable" title="上一页" ></a>','<a href="#nogo" class="pager-btn pager-forward forward-disable" title="下一页" ></a>','<a href="http://huati.renren.com" target="_blank" title="更多话题" class="more"></a>',"</div>","</div>",'<div class="side-item-body huati-side-area clearfix"  id="huatiListBox">','<ul class="huati-side-list clearfix" id="huatiList">',"</ul>","</div>","</div>"].join(""),templHtml:["{{#list}}",'<li class="clearfix">','<a href="http://huati.renren.com/{{showUrl}}" target="_blank" class="huati-side-title">','	<span class="huati-title" title="{{title}}" style="display:none;">{{title}}</span>','	<span class="huati-desc">{{description}}</span>',"</a>",'<div class="huati-side-main">','<a class="huati-side-img" target="_blank" href="http://huati.renren.com/{{showUrl}}">','	<img class="footprint-thumb" src="{{summaryThumbUrl}}" />',"</a>",'<div class="huati-side-descript">{{description}}</div>',"</div>","</li>","{{/list}}"].join(""),templDoubleHtml:["{{#list}}","<li>",'<a class="huati-side-img" target="_blank" href="http://huati.renren.com/{{showUrl}}">','<img class="footprint-thumb" src="{{summaryThumbUrl}}" />',"</a>",'<div class="huati-side-main">','<a href="http://huati.renren.com/{{showUrl}}" target="_blank" class="huati-side-title" title="{{title}}">{{title}}</a>','<div class="huati-side-descript">{{description}}</div>','<a class="huati-detail-btn" target="_blank" href="http://huati.renren.com/{{showUrl}}"><span class="link-icon">话题详情</span></a>',"</div>","</li>","{{/list}}"].join("")};t.widget("renren.huati",{options:{column:"single",loadUrl:"http://huati.renren.com/browse/carouseltopic",amount:1,speed:200,area:"#huatiBoxIn",ul:"#huatiList",box:"#huatiListBox",btn1:".pager-back",btn2:".pager-forward",btn1dclass:"back-disable",btn2dclass:"forward-disable",more:".more",listWidth:224},_create:function(){this._initData(),this._fetch()},_init:function(){},_destroy:function(){},_events:function(){var e=this;t(this.options.area).delegate(this.options.btn1,"click",function(){return e._back(),!1}),t(this.options.area).delegate(this.options.btn2,"click",function(){return e._forward(),!1});var i,n=t(this.options.box).parent();n.hover(function(){i&&(nx.timer.clearTimeout(i),i=null),n.find(".pager-btn").show(),n.closest(".double-cols-feed").length||(e.hover=!0,i=nx.timer.setTimeout(function(){n.find(".huati-side-title").find("span").hide(),n.find(".huati-side-title").find(".huati-title").show(),n.find(".huati-side-main").show().animate({height:"54px"},300)},300))},function(){i&&(nx.timer.clearTimeout(i),i=null),n.find(".pager-btn").hide(),n.closest(".double-cols-feed").length||(e.hover=!1,i=nx.timer.setTimeout(function(){n.find(".huati-side-title").find("span").hide(),n.find(".huati-side-title").find(".huati-desc").show(),n.find(".huati-side-main").animate({height:0}).hide()},300))}),t(this.options.box).parent().tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(i.vertical).addClass(i.horizontal).appendTo(this)}}})},_initData:function(){this.data={},this.req=null,this.cindex=0,this.direction="forward",this._disableForward=!0,this._disableBack=!0,this.slideTimer=null,this.type=null},_setContent:function(e){var i=this._getSomeDom(this.data,this.cindex,this.cindex+this.options.amount),n=t(i);"forward"===this.direction&&t(this.options.ul).append(n),"back"===this.direction&&t(this.options.ul).prepend(n),this.hover&&(t(this.options.ul).find(".huati-side-title").find("span").hide(),t(this.options.ul).find(".huati-side-title").find(".huati-title").show(),t(this.options.ul).find(".huati-side-main").height(54).show()),e||this._slide()},_getSomeDom:function(e,t,i){var n=e.slice(t,i),a=this._createCardHtml(n);return a},_slide:function(){this._disableActions=!0;var e,i=t(this.options.ul),n=this;"forward"===this.direction&&(e=t(n.options.ul).find("li").eq(0),i.animate({left:-n.options.listWidth},this.options.speed,function(){e.remove(),i.css({left:"0"}),n._disableActions=!1})),"back"===this.direction&&(i.css({left:-n.options.listWidth}),e=t(n.options.ul).find("li").eq(1),i.animate({left:0},this.options.speed,function(){e.remove(),i.css({left:"0"}),n._disableActions=!1}))},_fetch:function(){var e=this.options.loadUrl,i=this;this.req=t.ajax({url:e+"?t="+Math.random(),type:"GET",dataType:"json",success:function(e){if(e.length){var a=/([^\/]+)$/,s="p/m2w55h55q85lt_$1";e.forEach(function(e){e.summaryThumbUrl=e.summaryThumbUrl.replace(a,s)}),i.data=e,t(n.wrapHtml).appendTo(t("#huatiBox").show()),i._setContent(!0),t(i.options.ul).parent().show(),i.data.length>i.options.amount&&i._enableForward(),i._events()}},error:function(){t("#huatiBox").length&&t("#huatiBox").hide()}})},_createCardHtml:function(e){return"single"==this.options.column&&e.forEach(function(e){nx.stringplus.TLength(e.description)>34&&(e.description=nx.stringplus.TSubString(e.description,34,"..."))}),e={list:e},"single"==this.options.column?i.render(n.templHtml,e):"double"==this.options.column?i.render(n.templDoubleHtml,e):void 0},_enableForward:function(){this._disableForward&&(t(this.options.area).find(this.options.btn2).removeClass(this.options.btn2dclass),this._disableForward=!1)},_enableBack:function(){this._disableBack&&(t(this.options.area).find(this.options.btn1).removeClass(this.options.btn1dclass),this._disableBack=!1)},_disableForwardAction:function(){t(this.options.area).find(this.options.btn2).addClass(this.options.btn2dclass),this.direction="back",this._disableForward=!0},_disableBackAction:function(){t(this.options.area).find(this.options.btn1).addClass(this.options.btn1dclass),this.direction="forward",this._disableBack=!0},_canForward:function(){return this.cindex<this.data.length-this.options.amount},_canBack:function(){return this.cindex>0||this.data.length>0?!0:!1},_forward:function(e){this._disableActions||this._disableForward||(this.direction="forward",this._checkBeforeForward(),this._setContent(e),this._checkAfterForward(),this._canBack()&&this._enableBack())},_checkBeforeForward:function(){this.cindex+=this.options.amount},_checkAfterForward:function(){this._canForward()||this._disableForwardAction()},_back:function(){this._disableActions||this._disableBack||(this.direction="back",this._checkBeforeBack(),this._setContent(),this._checkAfterBack())},_checkBeforeBack:function(){this.cindex-=this.options.amount,this._canForward()&&this._enableForward(),this.data.length>0&&this._enableForward()},_checkAfterBack:function(){this.cindex<=0&&this._disableBackAction()},_getItem:function(e){return t("#commonFriend_"+e)}})}),define("ui/renren/footprint",function(require,e){require("ui/tooltip"),console.log("all3");var t=require("jquery"),i=require("mustache.js"),n={templHtml:["{{#list}}","<li>",'<span class="headpichold">','<a href="http://www.renren.com/profile.do?id={{guestId}}" namecard="{{guestId}}" target="_blank">','<img class="footprint-thumb" src data-src="{{headUrl}}" title="{{name}} {{date}}"/>',"</a>","</span>","</li>","{{/list}}"].join("")};t.widget("renren.footprint",{options:{loadUrl:"http://www.renren.com/footpointView",getNumUrl:"http://www.renren.com/footpointView/footprintCount",amount:6,speed:200,area:"#footprintBox",ul:"#footprintList",box:"#footprintListBox",btn1:".pager-back",btn2:".pager-forward",btn1dclass:"back-disable",btn2dclass:"forward-disable",more:".more",listWidth:214,freshTime:6e5},_create:function(){this._dealImg(),this._initData(),this._events(),this._countFresh()},_init:function(){},_destroy:function(){},_events:function(){var e=this;t(this.options.area).delegate(this.options.btn1,"click",function(){return e._back(),!1}),t(this.options.area).delegate(this.options.btn2,"click",function(){return e.req?e._forward():e._fetch(),!1}),t(this.options.box).parent().hover(function(){t(this).find(".pager-back").css({display:"inline-block"}),t(this).find(".pager-forward").css({display:"inline-block"})},function(){t(this).find(".pager-back").css({display:"none"}),t(this).find(".pager-forward").css({display:"none"})}),t(this.options.box).parent().tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(i.vertical).addClass(i.horizontal).appendTo(this)}}}),t("#footprintTab").mouseover(function(){if(0==t("#footprintBox .no-footprint").length&&t(this).hasClass("active")){var i=parseInt(t("#footprintBox .side-item-header h4 span").text());e._getFootprintNum(function(n){n>i&&(t("#footprintBox .side-item-header h4 span").text(n),t("#footprintNum").text(""),e._enableForward(),e._disableBackAction(),e._initData(),e._fetch(!0))})}})},_countFresh:function(){if(0==t("#footprintBox .no-footprint").length){var e=this;setTimeout(function(){e._showFootprintNum(),e._countFresh()},e.options.freshTime)}},_dealImg:function(e){var i=e||0,n=t("#footprintList").find(".footprint-thumb"),a=n.length;for(i;a>i;i++){var s=t(n[i]),o=s.attr("data-src"),r=o.lastIndexOf("/");o=o.substr(0,r)+"/p/m3w100h100q85lt_"+o.substr(r+1),s.attr("src",o)}},_initData:function(){this.data={},this.req=null,this.cindex=0,this.direction="forward",this._disableForward=!0,this._disableBack=!0,this.slideTimer=null,this.footprintNum=parseInt(t("#footprintBox .side-item-header span").text());var e=t(this.options.area).find("input").val();e>this.options.amount?this._disableForward=!1:(this._disableForward=!0,this._disableForwardAction())},_setContent:function(e){var i=this._getSomeDom(this.data,this.cindex,this.cindex+this.options.amount),n=t('<div class="group"></div>').append(i),a=0;"forward"===this.direction&&(t(this.options.ul).append(n),a=6),"back"===this.direction&&(t(this.options.ul).prepend(n),a=0),e||(this._dealImg(a),this._slide())},_getSomeDom:function(e,t,i){var n=e.slice(t,i),a=this._createCardHtml(n);return a},_slide:function(){this._disableActions=!0;var e,i=t(this.options.ul),n=this;"forward"===this.direction&&(e=t(n.options.ul).find(".group").eq(0),i.animate({left:-n.options.listWidth},this.options.speed,function(){e.remove(),i.css({left:"0"}),n._disableActions=!1})),"back"===this.direction&&(i.css({left:-n.options.listWidth}),e=t(n.options.ul).find(".group").eq(1),i.animate({left:0},this.options.speed,function(){e.remove(),i.css({left:"0"}),n._disableActions=!1}))},_getFootprintNum:function(e){var i=this.options.getNumUrl;t.ajax({url:i,type:"get",dataType:"json",success:function(t){e(t.count)}})},_showFootprintNum:function(){this._getFootprintNum(function(e){var i=e-parseInt(t("#footprintBox .side-item-header h4 span").text());return t("#footprintNum").show(),0==i?void t("#footprintNum").hide():void(i>20?t("#footprintNum").text("20+"):t("#footprintNum").text(i))})},_getFirstPage:function(){var e=this.options.loadUrl,i=this;i.req=t.ajax({url:e,type:"post",dataType:"json",success:function(e){var n,a="";if(i.data.length>=6)for(n=0;6>n;n++)a+='<li><span class="headpichold"><a title="'+i.data[n].name+" "+i.data[n].date+'" target="_blank" namecard="'+i.data[n].guestId+'" href="http://www.renren.com/profile.do?id='+i.data[n].guestId+'"><img width="32" height="32" src="'+i.data[n].headUrl+'"></a></span></li>';else for(n=0;n<i.data.length;n++)a+='<li><span class="headpichold"><a title="'+i.data[n].name+" "+i.data[n].date+'" target="_blank" namecard="'+i.data[n].guestId+'" href="http://www.renren.com/profile.do?id='+i.data[n].guestId+'"><img width="32" height="32" src="'+i.data[n].headUrl+'"></a></span></li>';t(i.options.ul).find(".group").html(a),i.data.length>i.options.amount&&i._enableForward()}})},_fetch:function(e){var i=this.options.loadUrl,n=this;n.req=t.ajax({url:i,type:"post",dataType:"json",success:function(i){if(n.data=i.visitList,!(n.data.length<1)){if(e){var a,s="";if(n.data.length>=6)for(a=0;6>a;a++)s+='<li><span class="headpichold"><a title="'+n.data[a].name+" "+n.data[a].date+'" target="_blank" namecard="'+n.data[a].guestId+'" href="http://www.renren.com/profile.do?id='+n.data[a].guestId+'"><img width="32" height="32" src="'+n.data[a].headUrl+'"></a></span></li>';else for(a=0;a<n.data.length;a++)s+='<li><span class="headpichold"><a title="'+n.data[a].name+" "+n.data[a].date+'" target="_blank" namecard="'+n.data[a].guestId+'" href="http://www.renren.com/profile.do?id='+n.data[a].guestId+'"><img width="32" height="32" src="'+n.data[a].headUrl+'"></a></span></li>';return t(n.options.ul).find(".group").html(s),void(n.data.length>n.options.amount&&n._enableForward())}n._forward(),n.data.length>n.options.amount&&n._enableForward()}}})},_createCardHtml:function(e){return e={list:e},i.render(n.templHtml,e)},_enableForward:function(){this._disableForward&&(t(this.options.area).find(this.options.btn2).removeClass(this.options.btn2dclass),this._disableForward=!1)},_enableBack:function(){this._disableBack&&(t(this.options.area).find(this.options.btn1).removeClass(this.options.btn1dclass),this._disableBack=!1)},_disableForwardAction:function(){t(this.options.area).find(this.options.btn2).addClass(this.options.btn2dclass),this.direction="back",this._disableForward=!0},_disableBackAction:function(){t(this.options.area).find(this.options.btn1).addClass(this.options.btn1dclass),this.direction="forward",this._disableBack=!0},_canForward:function(){return this.cindex<this.data.length-this.options.amount},_canBack:function(){return this.cindex>0||this.data.length>0?!0:!1},_forward:function(e){this._disableActions||this._disableForward||(this.direction="forward",this._checkBeforeForward(),this._setContent(e),this._checkAfterForward(),this._canBack()&&this._enableBack())},_checkBeforeForward:function(){this.cindex+=this.options.amount},_checkAfterForward:function(){this._canForward()||this._disableForwardAction()},_back:function(){this._disableActions||this._disableBack||(this.direction="back",this._checkBeforeBack(),this._setContent(),this._checkAfterBack())},_checkBeforeBack:function(){this.cindex-=this.options.amount,this._canForward()&&this._enableForward(),this.data.length>0&&this._enableForward()},_checkAfterBack:function(){this.cindex<=0&&this._disableBackAction()}})}),define("ui/renren/recommendFri",["jquery","mustache.js","ui/tooltip","ui/renren/relationFollow"],function(e,t){var i={wrapHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>推荐好友</h4>",'<div class="option">','<a href="#" stats="recommendfriends-refresh" class="pager-forward" title="换一组" ></a>','<a href="http://friend.renren.com/newfriends" stats="recommendfriends-more" target="_blank" title="更多推荐" class="more"></a>',"</div>","</div>",'<div class="side-item-body recommend-fri-area clearfix">','<ul class="recommend-friends-list">',"</ul>","</div>","</div>"].join(""),titleHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>热门推荐</h4>",'<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://app.renren.com" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),appTitleHtml:['<div id="recommendFriBox" class="recommend-box recommend-app-ad">','<div class="side-item-header clearfix">','<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://2014.renren.com/im" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),adHtml:["{{#list}}","<li>",'<p class="userhead"><a target="_blank" href="{{link}}" data-log="picture" class="ad-log"><img src="{{imgurl}}" width="100" height="100"><span class="username">{{name}}</span></a></p>','<p class="app-title"><a data-log="title" class="ad-log" target="_blank" href="{{link}}">{{content}}</a></p>',"</li>","{{/list}}"].join(""),appAdHtml:["{{#list}}",'<li><h4><a target="_blank" data-log="title" class="ad-log app-ad-title" href="{{link}}">{{name}}</a></h4>',"{{#isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_two_pane}}" alt="{{name}}" width="400" height="135"></a></li>',"{{/isDouble}}","{{^isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_single}}" alt="{{name}}" width="240" height="160"></a></li>',"{{/isDouble}}","</li>","{{/list}}"].join(""),templHtml:["{{#list}}",'<li class="recommend-friend" data-id="{{id}}" data-type="{{data_type}}">','<div class="userhead" namecard="{{id}}">','<a href="http://www.renren.com/profile.do?id={{id}}"><img src="{{mainimg}}" width="68" height="68"/></a>','<span class="friends-num">{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{shortExplanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}</span>",'<a title="不再推荐此人" class="ui-icon ui-iconfont x-to-hide" href="#" stats="recommendfriends-exclude">&#xe846;</a>',"</div>",'<p class="userinfo-single">','<a namecard="{{id}}" title="{{name}}" class="username" href="http://www.renren.com/profile.do?id={{id}}" stats="recommendfriends-profile">{{shortName}}</a>','<a href="#" stats="recommendfriends-add" class="add-btn recommend-single" data-id="{{id}}" data-from="Web_SG_RcdFour_addFriend" title="关注好友"><span class="ui-icon ui-iconfont">&#xe849;</span></a>',"</p>","</li>","{{/list}}"].join(""),templDoubleHtml:["{{#list}}",'<li class="recommend-friend" data-id="{{id}}" data-type="{{data_type}}">','<div class="userhead">','<img src="{{mainimg}}" width="90" height="90"/>','<a href="#" stats="recommendfriends-add" class="ui-icon add-btn" data-id="{{id}}" data-from="Web_SG_RcdFour_addFriend" title="关注好友"></a>','<a title="不再推荐此人" class="ui-icon ui-iconfont x-to-hide" href="#" stats="recommendfriends-exclude">&#xe846;</a>',"</div>",'<p class="userinfo">','<a target="_blank" title="{{name}}" class="username" href="http://www.renren.com/profile.do?id={{id}}" stats="recommendfriends-profile">{{shortName}}</a>','<span class="friends-num">{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{explanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}</span>","</p>","</li>","{{/list}}"].join("")};e.widget("renren.recommendfri",{options:{isDoubleFeed:!1},_create:function(){this.data=[],this.req=null,this.timer=null,this.showNum=this.options.isDoubleFeed?4:6,this.element.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-5",at:"center top",using:function(t,i){e(this).css(t),e("<div>").addClass("right-opt-tip-arrow").addClass(i.vertical).addClass(i.horizontal).appendTo(this)}}}),this._on({"click .pager-forward":"_fetch","click .x-to-hide":"_remove","mouseover .add-btn":function(t){var i=this;e(t.currentTarget).renrenrelationFollow({addAction:function(){i._remove(t)},friendAction:function(){i._remove(t)}})}}),this._fetch()},_destroy:function(){this.element.tooltip("destroy")},_setOption:function(e,t){"isDoubleFeed"===e&&(this._super(e,t),this.showNum=this.options.isDoubleFeed?4:6,this.data.length<this.showNum?this._fetch():this._setContent())},_fetch:function(t){return this.req?!1:(this.req=e.ajax({url:"http://rcd.renren.com/cwf_nget_v7rcd_new",data:"pz=10",dataType:"jsonp",jsonp:"_jcb",context:this,complete:function(){this.req=null},success:function(t){if(t.code||!t.data||t.data.list.length<1)return void this.element.remove();var i=/^(\d+).(.+)$/;this.data=t.data.list,this.data.forEach(function(t){t.shortExplanation=t.explanation.replace(i,"$2$1").replace("的人",""),t.shortName=nx.stringplus.TSubString(e.trim(t.name),4,"...")}),this._setContent()}}),void(t&&t.preventDefault()))},_setFramework:function(){this.element.html(i.wrapHtml)},_setContent:function(){var t=this.data.slice(0,this.showNum),i=this._createCardHtml(t);this.element.find(".add-btn").each(function(t,i){i=e(i),i.data("renren-addfriend")&&i.renrenaddfriend("destroy")}),this._setFramework(),this.element.find(".recommend-friends-list").html(i)},_patchContent:function(e){var t=this._createCardHtml([e]);this.element.find(".recommend-friends-list").append(t)},_createCardHtml:function(e){var n,a={list:e};return e.forEach(function(e){e.hasCommonFri=-1!==e.explanation.indexOf("共同好友")}),n=this.options.isDoubleFeed?t.render(i.templDoubleHtml,a):t.render(i.templHtml,a)},_remove:function(t){var i=e(t.target),n=i.parents(".recommend-friend"),a=n.data("id"),s=n.data("type"),o=this;n.find(".add-btn").data("renren-addfriend")&&n.find(".add-btn").renrenrelationFollow("destroy"),this.data.forEach(function(e,t){e.id===a&&o.data.splice(t,1)}),n.animate({opacity:0},1e3,function(){n.remove(),o.data[o.showNum-1]?o._patchContent(o.data[o.showNum-1]):o._fetch()}),i.hasClass("x-to-hide")&&e.ajax({url:"http://rcd.renren.com/cwf_nremove_home",type:"post",data:"type="+s+"&guest="+a,dataType:"text"}),t.preventDefault()}})}),define("ui/renren/recommendFri_old",function(require,e){require("ui/tooltip"),require("ui/renren/relationFollow");var t=require("jquery"),i=require("mustache.js"),n={wrapHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>推荐好友</h4>",'<div class="option">','<a href="#nogo" stats="recommendfriends-old-back" class="pager-back back-disable" title="上一页" ></a>','<a href="#nogo" stats="recommendfriends-old-forward" class="pager-forward forward-disable" title="下一页" ></a>','<a href="http://friend.renren.com/newfriends" stats="recommendfriends-old-more" target="_blank" title="更多推荐" class="more"></a>',"</div>","</div>",'<div class="side-item-body recommend-fri-area clearfix"  id="pymk_home_2">','<ul class="recommend-friends-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),titleHtml:['<div id="recommendFriBox" class="recommend-box">','<div class="side-item-header clearfix">',"<h4>热门推荐</h4>",'<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://app.renren.com" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),appTitleHtml:['<div id="recommendFriBox" class="recommend-box recommend-app-ad">','<div class="side-item-header clearfix">','<div class="option">','<a href="#nogo" data-log="backward" class="ad-log pager-back back-disable" title="上一页" ></a>','<a href="#nogo" data-log="forward" class="ad-log pager-forward forward-disable" title="下一页" ></a>','<a href="http://2014.renren.com/im" target="_blank" title="更多推荐" data-log="more" class="more ad-log"></a>',"</div>","</div>",'<div class="recommend-app-area" id="pymk_home_2">','<ul class="recommend-app-list" id="commonFriends_home_2">',"</ul>","</div>","</div>"].join(""),adHtml:["{{#list}}","<li>",'<p class="userhead"><a target="_blank" href="{{link}}" data-log="picture" class="ad-log"><img src="{{imgurl}}" width="100" height="100"><span class="username">{{name}}</span></a></p>','<p class="app-title"><a data-log="title" class="ad-log" target="_blank" href="{{link}}">{{content}}</a></p>',"</li>","{{/list}}"].join(""),appAdHtml:["{{#list}}",'<li><h4><a target="_blank" data-log="title" class="ad-log app-ad-title" href="{{link}}">{{name}}</a></h4>',"{{#isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_two_pane}}" alt="{{name}}" width="400" height="135"></a></li>',"{{/isDouble}}","{{^isDouble}}",'<a target="_blank" data-log="picture" href="{{link}}" class="ad-log"><img src="{{imgurl_single}}" alt="{{name}}" width="240" height="160"></a></li>',"{{/isDouble}}","</li>","{{/list}}"].join(""),templHtml:["{{#list}}",'<li id="commonFriend_{{id}}" data-type="{{data_type}}">','<p class="userhead">','<a target="_blank" stats="recommendfriends-old-profile" href="http://www.renren.com/profile.do?id={{id}}" namecard="{{id}}">','<img src="{{mainimg}}" width="100" height="100"/>','<span class="username">{{name}}</span>',"</a>",'<span class="x-to-hide" data-type="{{data_type}}" data-id={{id}}>','<a title="不再推荐此人" stats="recommendfriends-old-exclude"  class="ui-icon ui-icon-square-close" href="#nogo"></a>',"</span>","</p>",'<p class="friends-num">','<a href="#nogo" stats="recommendfriends-old-add" class="add-btn" data-from="Web_SG_RcdTwo_addFriend" data-id="{{id}}" title="关注好友"></a>','{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-old-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{explanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}","</p>","</li>","{{/list}}"].join(""),templDoubleHtml:["{{#list}}",'<li id="commonFriend_{{id}}" data-type="{{data_type}}">','<p class="userhead">','<img src="{{mainimg}}" width="100" height="100"/>','<a href="#nogo" stats="recommendfriends-old-add" class="add-btn" data-from="Web_SG_RcdTwo_addFriend" data-id="{{id}}" title="关注好友"></a>','<span class="x-to-hide" data-type="{{data_type}}" data-id={{id}}>','<a title="不再推荐此人" stats="recommendfriends-old-exclude" class="ui-icon ui-icon-square-close" href="#nogo"></a>',"</span>","</p>",'<p class="friends-num">','<a target="_blank" stats="recommendfriends-old-profile" class="user-name" href="http://www.renren.com/profile.do?id={{id}}" namecard="{{id}}">{{name}}</a>','{{#hasCommonFri}}<a href="javascript:;" stats="recommendfriends-old-reason" data-common=\'{"uid":{{id}},"name":"{{name}}"}\'>{{/hasCommonFri}}',"{{explanation}}","{{#hasCommonFri}}</a>{{/hasCommonFri}}","</p>","</li>","{{/list}}"].join("")},a={show:"RecFriend_show",remove:"RecFriend_cancle",addFriend:"RecFriend_addFriend",addFriendEnd:"RecFriend_addFriendEnd",name:"RecFriend_nameToPrf",head:"RecFriend_imgToPrf",back:"RecFriend_back",forward:"RecFriend_forward",more:"RecFriend_more"};t.widget("renren.recommendfri",{options:{column:"single",loadUrl:"http://rcd.renren.com/cwf_nget_v7rcd",delUrl:"http://rcd.renren.com/cwf_nremove_home",amount:2,speed:200,area:"#recommendFriBox",ul:"#commonFriends_home_2",box:"#pymk_home_2",btn1:".pager-back",btn2:".pager-forward",btn1dclass:"back-disable",btn2dclass:"forward-disable",more:".more",listWidth:224},_create:function(){this._initData(),this._fetch()},_init:function(){},_destroy:function(){},_events:function(){var e=this;!function(){var i=function(i,n){var a=nx.user.id;t(e.options.area).delegate(i,"click",function(){t.ajax({url:"http://www.renren.com/homeV7Logger/send",type:"post",data:{log:"[{'hostId':'"+a+"','targetTag':'rcd_"+n+"'}]"},dataType:"json",success:function(e){}})})};i(".userhead img","head"),i(".user-name,.username","name"),i(".more","more"),i(".pager-back,.pager-forward","page"),i(".friends-num a[data-common]","common")}(),t(this.options.box).parent().delegate(".ad-log","click",function(){var i=t(this).data("log"),n=e.options.column+"_"+e.type;t.get("http://www.renren.com/homeLog/recommend?type="+n+"&position="+i)}),t(this.options.area).delegate(this.options.btn1,"click",function(){return e._back(),!1}),t(this.options.area).delegate(this.options.btn2,"click",function(){return e._forward(),!1}),t(this.options.box).parent().hover(function(){t(this).find(".pager-back").css({display:"inline-block"}),t(this).find(".pager-forward").css({display:"inline-block"})},function(){t(this).find(".pager-back").css({display:"none"}),t(this).find(".pager-forward").css({display:"none"})}),t(this.options.box).parent().tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(i.vertical).addClass(i.horizontal).appendTo(this)}}}),t(this.options.box).delegate(".add-btn","mouseover",function(){var i=t(this).parent().parent().find(".x-to-hide");t(this).hasClass("loged")||(t(this).addClass("loged"),t(this).on("click",function(){t.ajax({url:"http://www.renren.com/homeV7Logger/send",type:"post",data:{log:"[{'hostId':'"+nx.user.id+"','targetTag':'rcd_add'}]"},dataType:"json",success:function(e){}})})),t(".add-btn").renrenrelationFollow({addAction:function(t){e._remove(i)},friendAction:function(){e._remove(i)}})}),t(this.options.box).delegate(".x-to-hide","click",function(){return e._remove(t(this)),!1}),t(this.options.box).delegate(".userhead","mouseenter",function(i){if(t(this).parent().find(".x-to-hide").show(),"double"==e.options.column){var n=t(this).find(".add-btn");n.css("visibility","visible")}}),t(this.options.box).delegate(".userhead","mouseleave",function(e){t(this).parent().find(".x-to-hide").hide();var i=t(this).find(".add-btn");i.css("visibility","hidden")})},_initData:function(){this.data={},this.req=null,this.cindex=0,this.direction="forward",this._disableForward=!0,this._disableBack=!0,this.slideTimer=null,this.type=null},_setContent:function(e){var i=this._getSomeDom(this.data,this.cindex,this.cindex+this.options.amount),n=t('<div class="group"></div>').append(i);"forward"===this.direction&&t(this.options.ul).append(n),"back"===this.direction&&t(this.options.ul).prepend(n),e||this._slide()},_getSomeDom:function(e,t,i){var n=e.slice(t,i),a=this._createCardHtml(n);return a},_slide:function(){this._disableActions=!0;var e,i=t(this.options.ul),n=this;"forward"===this.direction&&(e=t(n.options.ul).find(".group").eq(0),i.animate({left:-n.options.listWidth},this.options.speed,function(){e.remove(),i.css({left:"0"}),n._disableActions=!1})),"back"===this.direction&&(i.css({left:-n.options.listWidth}),e=t(n.options.ul).find(".group").eq(1),i.animate({left:0},this.options.speed,function(){e.remove(),i.css({left:"0"}),n._disableActions=!1}))},_fetch:function(){var e=this.options.loadUrl,i=this;this.req=t.ajax({url:e+"?t="+Math.random(),type:"get",dataType:"json",success:function(e){
e.data&&(i.data=e.data.list.slice(0,50),i.type=e.type,i.data.length<1||("1"==e.type?t(n.wrapHtml).appendTo(t("#recommendArea")):"2"==e.type?t(n.titleHtml).appendTo(t("#recommendArea")):"3"==e.type&&(i.options.amount=1,t(n.appTitleHtml).appendTo(t("#recommendArea"))),i._setContent(!0),t(i.options.ul).parent().show(),i.data.length>i.options.amount&&i._enableForward(),i._events(),i._sendOnShowLog()))}})},_createCardHtml:function(e){var a={list:e};if("1"==this.type){if(t.each(e,function(e,t){"可能认识的人"===t.explanation?t.hasCommonFri=!1:t.hasCommonFri=!0}),"single"==this.options.column)return i.render(n.templHtml,a);if("double"==this.options.column)return i.render(n.templDoubleHtml,a)}else{if("2"==this.type)return i.render(n.adHtml,a);if("3"==this.type)return a.isDouble="double"===this.options.column,i.render(n.appAdHtml,a)}},_enableForward:function(){this._disableForward&&(t(this.options.area).find(this.options.btn2).removeClass(this.options.btn2dclass),this._disableForward=!1)},_enableBack:function(){this._disableBack&&(t(this.options.area).find(this.options.btn1).removeClass(this.options.btn1dclass),this._disableBack=!1)},_disableForwardAction:function(){t(this.options.area).find(this.options.btn2).addClass(this.options.btn2dclass),this.direction="back",this._disableForward=!0},_disableBackAction:function(){t(this.options.area).find(this.options.btn1).addClass(this.options.btn1dclass),this.direction="forward",this._disableBack=!0},_canForward:function(){return this.cindex<this.data.length-this.options.amount},_canBack:function(){return this.cindex>0||this.data.length>0?!0:!1},_forward:function(e){this._disableActions||this._disableForward||(this.direction="forward",this._checkBeforeForward(),this._setContent(e),this._checkAfterForward(),this._canBack()&&this._enableBack())},_checkBeforeForward:function(){this.cindex+=this.options.amount},_checkAfterForward:function(){this._canForward()||this._disableForwardAction()},_back:function(){this._disableActions||this._disableBack||(this.direction="back",this._checkBeforeBack(),this._setContent(),this._checkAfterBack())},_checkBeforeBack:function(){this.cindex-=this.options.amount,this._canForward()&&this._enableForward(),this.data.length>0&&this._enableForward()},_checkAfterBack:function(){this.cindex<=0&&this._disableBackAction()},_remove:function(e){var i=this,n=e.attr("data-type"),a=e.attr("data-id"),s=t(i._getItem(a)).index();t.ajax({url:i.options.delUrl+"?t="+Math.random(),type:"post",data:"type="+n+"&guest="+a,dataType:"text",success:function(n){try{setTimeout(function(){i._syncData(s),e.parents("li").fadeOut("slow",function(){t(this).remove(),i._checkAfterForward(),i._disableActions=!1,i._patch()})},1e3)}catch(a){}},error:function(){t.dialog.error("服务器异常，请稍候再试。")}})},_patch:function(){if(this.data.length<1)return void t(this.options.box).parent().hide();var e=this.data[this.cindex+this.options.amount-1],i=[];if(i.push(e),e){var n=this._createCardHtml(i);t(this.options.ul).find(".group").append(n)}else if(0===t(this.options.ul).find("li").length)return this._back(),void this._disableForwardAction()},_getItem:function(e){return t("#commonFriend_"+e)},_syncData:function(e){this.data.splice(this.cindex+e,1)},_sendOnShowLog:function(){for(var e=this,i=[],n=[],s=t(e.options.ul).find("li"),o=0,r=s.length;r>o;o++){i.push(s.eq(o).attr("id").split("_")[1]),n.push(s.eq(o).attr("data-type"));var d=e._getLog(s.eq(o).attr("id").split("_")[1],"show")}e._logRcd({action:d||a.show,guest_id:i.join("|"),type:n.join("|")})},_getLog:function(e,i){try{return t("log_"+i+"_"+e).val()}catch(n){return!1}},_logRcd:function(e){var t=[];t.push(e.action),t.push(nx.user.id),e.guest_id&&t.push(e.guest_id),e.recommend_id&&t.push(e.recommend_id),e.all_id&&t.push(e.all_id),e.type&&t.push(e.type),e.pregroup&&t.push(e.pregroup),(new Image).src="http://rcd.renren.com/ajaxHomeReconnectStat?param="+t.join("|")+"&t="+(new Date).getTime()}})}),define("photo/past",function(require,e){var t=require("jquery");require("ui/tooltip");var i={url:Math.floor(10*Math.random())<5?"http://ark.renren.com/photo/photo/data?r="+(new Date).getTime():"http://photo.renren.com/photo/data?r="+(new Date).getTime(),urlType:"http://photo.renren.com/photo/setMode?r="+(new Date).getTime()+"&mode=",tpl:['<div class="side-item photopast">',' <div class="advert-box ad-pic-past">','  <div class="side-item-advert" data-adzone-id="100000100002"></div>'," </div>",'<div class="side-item-header"><h3>过往的今天</h3>','<div class="advert-box advert-box-photo"><div class="side-item-advert" data-adzone-id="100000100001"></div></div>','<div class="option ui-button ui-button-icon-only">','<span class="ui-icon ui-icon-square-setting"></span>','<p class="option-layer">','<a href="javascript:;" mode="1">过往的今天</a>','<a href="javascript:;" mode="0">好友的最新</a>','<a href="javascript:;" mode="2">热门推荐</a>',"</p></div></div>",'<div class="side-item-body"><div class="photopast-image"><img/>','<div class="photopast-notice"><div class="photopast-notice-bg"></div><p class="photopast-notice-text"></p></div>','<a href="javascript:;" class="photopast-btn photopast-prev"></a><a href="javascript:;" class="photopast-btn photopast-next"></a>','<p class="photopast-title"><a class="title"></a><a href="javascript:;" data-tip="赞一个" class="like"></a><a href="javascript:;" data-tip="分享" class="share"></a></p>',"</div>",'<div class="photopast-memo"><a class="photopast-name" target="_blank"></a><b class="photopast-date"></b></div>',"</div>"],cache:[],page:0,errors:0,timer:null};i.init=function(){t("#right-fix-info").append(i.tpl.join("")),i.bind(),i.get(),t(".photopast-title").tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-16",at:"top center",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(i.vertical).addClass(i.horizontal).appendTo(this)}},disabled:!1,content:function(){var e=t(this),i=t(this).data("tip");return e.hasClass("liked")&&(i=""),i},items:"a[data-tip]",hide:!1,openDelay:0})},i.title=function(e){var i="",n=t(".photo-past-ads");n.is(":hidden");switch(e=parseInt(e)){case 0:i="好友的最新";break;case 1:i="过往的今天";break;case 2:i="热门推荐"}t(".photopast h3").text(i),t(".photopast .option-layer a").removeClass("hover"),t(".photopast .option-layer a[mode="+e+"]").addClass("hover")},i.notice=function(e,n){var a="";switch(e=parseInt(e)){case 0:a="你的好友最近没有上传照片";break;case 1:a="好友未在过往的今天上传照片";break;case 3:a="木有新鲜事 赶紧去添加好友";break;default:a="OPPS~最热推荐里边也木有照片"}var s=t(".photopast-notice-text"),o=t(".photopast-notice");n?(s.text(a),o.show()):(i.title(e),s.addClass("photopast-notice-suc").text("设置成功"),o.show()),setTimeout(function(){s.removeClass("photopast-notice-suc"),o.fadeOut()},2e3)},i.get=function(e){var n=i.url;e&&(n=i.urlType+e),t.ajax({url:n,dataType:"json",success:function(t){void 0!=t.mode?t.data.length>0?(i.cache=t.data,i.render(),i.title(t.suggestmode),e&&i.notice(e)):e&&i.notice(3,!0):e&&i.notice(e,!0)},stats:!0})},i.prev=function(){0===i.page?i.page=i.cache.length-1:i.page--,i.render()},i.next=function(e){i.page===i.cache.length-1?i.page=0:i.page++,i.render(e)},i.render=function(e){var n=i.cache[i.page];if(n){var a=0,s=0,o=new Image;o.onerror=function(){i.errors++,i.errors<10&&i.next()},o.onload=function(){var o=240,r=this.width,d=this.height,l=240,c=o;if(100>d)i.errors++,i.errors<10&&i.next();else{var h=240/r*d;h>o?(a=-(h-o)/2,c=h):100>h?(c=100,l=100/d*r,240>l?(i.errors++,i.errors<10&&i.next()):s=-(l-240)/2):c=h,t(".photopast-image img").remove(),t(".photopast-image").append('<img style="margin-left:'+s+"px;margin-top:"+a+'px;" width="'+l+'" height="'+c+'" src="'+this.src+'" data-viewer={"type":"photo","owner":"'+n.userId+'","id":"'+n.photoId+'","url":"'+n.largeUrl+'","width":0,"height":0} />'),0!==a&&t(".photopast-image").css({height:"maxHeight",overflow:"hidden"});var p=nx.stringplus.TSubString(n.originalTitle,"10","...");if(-1!=p.indexOf("@")){var f=p.indexOf("@"),u=n.title.indexOf(">")+1,m=n.title.substring(f,u),g=p.split("@"),v=g[0],b="@"+g[1].split(")")[0],w=g[1].split(")")[1]?")"+g[1].split(")")[1]:"";p=String(v+m+b+"</a>"+w)}t(".photopast-title .title").html(p+"&nbsp;").attr("title",n.originalTitle),t(".photopast-name").text(nx.stringplus.SubString(n.userName,6)).attr({href:"http://www.renren.com/"+n.userId,namecard:n.userId}),3===n.nYear.length?t(".photopast-date").text(["上传于",n.nYear[0],"年",n.nYear[1],"月",n.nYear[2],"日"].join("")):t(".photopast-date").text(["上传于",n.nYear,"年前的今天"].join("")),t(".photopast-title .share").attr("data-share",'{"stype":"create_share_feed","type":"photo","id":"'+n.photoId+'","owner":"'+n.userId+'"}'),t(".photopast-title .like").remove();var y=1===n.like?"取消赞":"赞一个",x=1===n.like?"like liked":"like addLike",C='<a href="javascript:;" data-tip="'+y+'" class="'+x+'" data-like=""></a>';t(t(".photopast-title a")[0]).after(C),t(".photopast-title .like").attr("data-like",'{"stype":"photo","sourceId":"'+n.photoId+'","owner":"'+n.userId+'"}').bind("mouseover",function(){var e=t(this);e.renrenlike({onadd:function(){i.cache[i.page].like=1},onremove:function(){i.cache[i.page].like=0}})}),null===i.timer&&(i.timer=setInterval(function(){i.next(!0)},15e3)),e||(clearInterval(i.timer),i.timer=setInterval(function(){i.next(!0)},15e3))}},o.src=n.largeUrl.replace(/([^\/]+)$/,"p/m3w240h240q100lt_$1").replace(/\.gif$/,".gif.jpg")}},i.bind=function(){var e=t(".photopast .option");e.bind("mouseover",function(){t(this).addClass("hover"),t(".photopast .option-layer").show()}),e.bind("mouseout",function(){t(this).removeClass("hover"),t(".photopast .option-layer").hide()}),t(".photopast .option-layer a").click(function(){var e=t(this);e.hasClass("hover")||(t(".photopast .option-layer").hide(),t(".photopast-notice-text").text("加载中..."),t(".photopast-notice").show(),i.get(e.attr("mode")))}),t(".photopast-next").click(function(){i.next()}),t(".photopast-prev").click(function(){i.prev()}),t(".photopast-title .share").click(function(){t(this).renrenshare(t(this).data().share)});var n=t(".photopast-image");n.bind("mouseenter",function(){t(".photopast-btn").show()}),n.bind("mouseleave",function(){t(".photopast-btn").hide()})},e.init=function(){i.init()}}),define("newsfeed/group",function(require,e){var t=jQuery.noConflict();require("ui/friendManagement"),require("ui/friendSearch");require("ui/scrollbar");var i={addIntoGroup:function(e,i,n,a){t.ajax({url:"http://friend.renren.com/friends/api/editgroups?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'addmultgroups','names':['"+e+"'],'buddys':'"+i+"'}",success:function(e){n.call(a,t.parseJSON(e))}})},addIntoGroupList:function(e,i,n,a){var s={action:"addmultgroups",names:e,buddys:i};t.ajax({url:"http://friend.renren.com/friends/api/editgroups?t="+Math.random(),type:"post",dataType:"text",data:"p="+JSON.stringify(s),success:function(e){n.call(a,t.parseJSON(e))}})},getGroupSuggest:function(e,i,n){t.ajax({url:"http://friend.renren.com/friends/api/suggestaddgroup?t="+Math.random(),type:"post",dataType:"text",data:"gname="+e,success:function(e){i.call(n,t.parseJSON(e))}})},getSpecificData:function(e,i,n){t.ajax({url:"http://friend.renren.com/friendsSelector.do",type:"post",dataType:"text",data:"p={'init':false,'qkey':'friend','uid':true,'uname':true,'uhead':true,'limit':24,'param':{},'query':'','group':'"+e+"','net':'','page':false}",success:function(e){i.call(n,t.parseJSON(e))}})},removeFromGroup:function(e,i,n,a){t.ajax({url:"http://friend.renren.com/friends/api/batchremove?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'batchremove','ids':["+i+"],'groupname':'"+e+"'}",success:function(e){n.call(a,t.parseJSON(e))}})},getGroupList:function(e,i,n){t.ajax({url:"http://www.renren.com/home/getGroupDetail",type:"get",dataType:"text",data:"groupId="+e,success:function(e){i.call(n,e)}})},setNumberNotice:function(e,i,n,a){t.ajax({url:"http://www.renren.com/leftmenu/setNumberNotice",type:"post",dataType:"text",data:"menuId="+e+"&type=2&notice="+i,success:function(e){n.call(a,e)}})}},n=function(e,i){this.groupName=e,this.groupId=i,t(".nf-group-list-container").find(".fd-nav-cur-item").removeClass("fd-nav-cur-item"),t(".nf-group-list-container").find("a[data-gid="+i+"]").parent("li").addClass("fd-nav-cur-item"),this.topPos={1:"85px",2:"125px",3:"165px"},this.bdContent=t(".bd-content"),this.feedList=t("#feed-list"),this.rightMenu=t(".nx-right");var n=t("#friends-filter");this.memberManage=n.find(".member-manage"),this.remindBtn=n.find(".not-remind"),this.toolList=n.find(".tool-menu ul"),this.memberList=n.find(".member-list"),this.suggestorContainer=n.find(".group-suggestor"),this.suggestorList=n.find(".suggestor-list"),this.suggestorGroup=n.find(".suggestor-group"),this.groupScroll=this.suggestorGroup.find("ul"),this.suggestorGName=n.find(".suggestion-group"),this.gName=n.find(".group-name"),this.gCounts=n.find(".user-counts"),this.searchInput=n.find(".ui-friend-search"),this.selectedItem=null,this.userId=null,this.addInGroupList=[],this.initGroupInfo(this.groupName),this.bindEvent();var a=this;this.searchInput.friendSearch({placeholder:"输入好友姓名加入本组",showGroupName:!0,groupName:e,selectEvent:function(e,t,i,n){a.addMember(e,t,i,n)}})};n.prototype={bindEvent:function(){var e=this;this.memberManage.on("click",function(){t.ui.friendManagement({specificGName:e.groupName,onAddFriends:function(t){e.changeGroupInfo(t)},onRemoveFriends:function(t){e.changeGroupInfo(t)}})}),this.suggestorContainer.on("click",".show-group-list",function(){e.selectedItem=t(this).parents("li");var i=e.selectedItem.index();e.userId=e.selectedItem.attr("data-uid"),e.suggestorGroup.show(),e.suggestorGroup.css("top",e.topPos[i+1]),e.suggestorGroup.find(".a-group").length>10&&(e.suggestorGroup.css("height","340px"),e.suggestorGroup.scrollbar(),e.groupScroll.scrollbar())}),this.suggestorContainer.on("click",".add-group",function(){var n=t(this).parents("li"),a=n.attr("data-uid"),s=n.children("img").attr("src"),o=n.children(".suggest-name").html();e.userId=n.attr("data-uid");var r=[];if("block"==e.suggestorGroup.css("display"))for(var d=e.suggestorGroup.find(".selected"),l=0;l<d.length;l++)r.push(t(d[l]).children("span").text());else r.push(e.groupName);i.addIntoGroupList(r,e.userId,function(i){0==i.code&&(n.remove(),12==e.memberList.length&&e.memberList.children().last().remove(),e.memberList.children().first().before(t(e.getMemberContent({id:a,head:s,name:o}))),e.gCounts.text(parseInt(e.gCounts.text())+1),e.isNone(),e.initInput())})}),this.suggestorGroup.on("click",".a-group",function(){var n=[];t(this).toggleClass("selected");for(var a=e.suggestorGroup.find(".selected"),s=0;s<a.length;s++)n.push(t(a[s]).children("span").text());i.addIntoGroupList(n,e.userId,function(t){0==t.code&&e.isNone()})}),this.remindBtn.on("click",function(){var n=this;"不显示更新提醒"==t(this).text()?i.setNumberNotice(e.groupId,!1,function(e){t(n).text("显示更新提醒")}):"显示更新提醒"==t(this).text()&&i.setNumberNotice(e.groupId,!0,function(e){t(n).text("不显示更新提醒")})}),t("body").on("click",function(i){0!=t(i.target).parents(".suggestor-group").length||t(i.target).hasClass("show-group-list")||0!=t(i.target).parents(".show-group-list").length||e.suggestorGroup.hide()})},isNone:function(){0==this.suggestorList.find("li").length&&this.suggestorContainer.remove()},initGroupInfo:function(e){this.groupName=e,this.loadSuggestion(e)},removeFeedTip:function(){t("#toolRefreshFeed").remove(),this.feedList.find(".new-feed-tip").remove()},loadSuggestion:function(e){var t=this;this.suggestorGName.html(e),i.getGroupSuggest(e,function(e){if(e.recommend){for(var i=e.recommend,n="",a=0;a<(i.length>3?3:i.length);a++)n+=t.getSugContent(i[a]);t.suggestorList.html(n),t.suggestorContainer.show()}})},loadGroupInfo:function(e){var t=this;i.getSpecificData(e,function(i){var n=i.candidate;t.gName.html(e),t.gCounts.html(n.length);for(var a="",s=0;s<(n.length>12?12:n.length);s++)a+=t.getMemberContent(n[s]);t.memberList.html(a)})},addMember:function(e,n,a,s){for(var o=this,r=s.split(","),d=[],l=0;l<r.length;l++)""!=r[l]&&d.push(r[l]);for(var c=!0,l=0;l<d.length;l++)this.groupName==d[l]&&(c=!1,t.dialog.success("您所选的好友已经在该组中"));c&&(d.push(o.groupName),i.addIntoGroupList(d,e,function(i){12==o.memberList.children().length&&o.memberList.children().last().remove(),o.memberList.children().first().before(t(o.appendUserTpl(e,n,a))),o.gCounts.html(parseInt(o.gCounts.text())+1),o.suggestorList.find("li[data-uid="+e+"]").length>0&&(o.suggestorList.find("li[data-uid="+e+"]").remove(),0==o.suggestorList.find("li").length&&o.suggestorContainer.remove())}))},appendUserTpl:function(e,t,i){var n=['<a href="http://www.renren.com/profile.do?id='+e+'" namecard="'+e+'" title="'+t+'">','	<img src="'+i+'">',"</a>"].join("");return n},initInput:function(){this.searchInput.val(""),t("#friends-filter .query-result").hide()},getSugContent:function(e){var t=['<li class="clearfix" data-uid = "'+e.id+'">','	<img src="'+e.tinyurl+'">','	<a href="http://www.renren.com/profile.do?id='+e.id+'" class="suggest-name">'+e.name+"</a>",'	<span class="suggest-operation clearfix">','		<a href="javascript:;" class="add-group">加入</a>','		<a href="javascript:;" class="show-group-list"><i></i></a>',"	</span>","</li>"].join("");return t},getMemberContent:function(e){var t=['<a href="http://www.renren.com/profile.do?=id'+e.id+'" namecard="'+e.id+'" title="'+e.name+'">','	<img src="'+e.head+'">',"</a>"].join("");return t},changeGroupInfo:function(e){var i=this;t.ajax({url:"http://www.renren.com/home/getGroupDetail?groupId="+e,dataType:"text",success:function(n){i.feedList.children().not(".new-feed-tip").remove(),t(nx.data.feed).trigger("friendsNewsFeed",e),t("#friends-filter").length>0&&t("#friends-filter").remove(),t(n).prependTo(i.rightMenu)}})}},e.groupFriends=n}),define("ui/friendSearch",function(require,e){var t=jQuery.noConflict();require("ui/placeholder");var i={queryInfor:function(e,i,n){t.ajax({url:"http://friend.renren.com/friends/api/queryinformation",type:"post",dataType:"text",data:"l=5&p="+e,success:function(e){i.call(n,t.parseJSON(e))}})}};t.widget("ui.friendSearch",{options:{placeholder:"",groupName:"",showGroupName:!1,selectEvent:function(){}},_create:function(){this.searchResult="",this.element.placeholder({text:this.options.placeholder}),this.element.after(t('<ul class="query-result"></ul>')),this.resultContainer=t(".query-result"),this.groupName=this.options.groupName||"",this.memberList=t(".member-list"),this.listLength=0,this._events()},_init:function(){},_destroy:function(){},_events:function(){var e=this;this.element.on("keyup",function(n){if(40!=n.keyCode&&38!=n.keyCode||"block"!=e.resultContainer.css("display"))if(13==n.keyCode){var a=e.resultContainer.find(".actived");if(a.length>0){var s=a.attr("data-uid"),o=a.children(".name").html(),r=a.children("img").attr("src"),d=a.find(".groups-name").html();"block"==e.resultContainer.css("display")&&e.options.selectEvent(s,o,r,d),e.initInput()}}else{var l="",c=e.element.val();i.queryInfor(c,function(i){if(0==i.code&&i.data.length>0){for(var n=0;n<i.data.length;n++){var a=i.data[n].id;if(a>1e3&&6e8>a||a>699999999&&780000001>a||a>799999999&&2147479033>a){var s=e.singleQuery(i.data[n]);l+=s}}e.resultContainer.html(t(l)),""!=l?e.resultContainer.show():e.resultContainer.hide()}else e.resultContainer.hide();e.listLength=e.resultContainer.children().length})}else if(40==n.keyCode){var a=e.resultContainer.find(".actived");a.length>0?a.parent("li").index()!=e.listLength-1?(a.parent("li").next().children("a").addClass("actived"),a.removeClass("actived")):(a.removeClass("actived"),e.resultContainer.find("li:eq(0) a").addClass("actived")):e.resultContainer.find("li:eq(0) a").addClass("actived")}else if(38==n.keyCode){var a=e.resultContainer.find(".actived");a.length>0?0!=a.parent("li").index()?(a.parent("li").prev().children("a").addClass("actived"),a.removeClass("actived")):(a.removeClass("actived"),e.resultContainer.find("li:eq("+(e.listLength-1)+") a").addClass("actived")):e.resultContainer.find("li:eq("+(e.listLength-1)+") a").addClass("actived")}}),this.element.on("blur",function(i){var n=this;setTimeout(function(){""==t(n).val()&&e.resultContainer.hide()},100)}),this.element.on("click",function(i){""==t(this).val()&&e.resultContainer.hide()}),this.resultContainer.on("click",".add-into-group",function(){var i=t(this).attr("data-uid"),n=t(this).children(".name").html(),a=t(this).children("img").attr("src"),s=t(this).find(".groups-name").html();e.options.selectEvent(i,n,a,s),e.initInput()}),this.resultContainer.on("mouseenter",".add-into-group",function(){e.resultContainer.find(".actived").removeClass("actived"),t(this).addClass("actived")})},singleQuery:function(e){var t="";if(this.options.showGroupName){for(var i=0;i<e.groups.length;i++)if(this.groupName==e.groups[i])return"";e.groups.length>0&&(t=e.groups.toString())}if(""==t)var n=["<li>",'	<a href="#nogo" onclick="return false;" class="add-into-group clearfix" data-uid="'+e.id+'">','		<img src="'+e.tinyurl+'">','		<span class="name">'+e.name+"</span>",'		<span class="group"><span class="groups-name">'+t+"</span></span>","	</a>","</li>"].join("");else var n=["<li>",'	<a href="#nogo" onclick="return false;" class="add-into-group clearfix" data-uid="'+e.id+'">','		<img src="'+e.tinyurl+'">','		<span class="name">'+e.name+"</span>",'		<span class="group">[<span class="groups-name">'+t+"</span>]</span>","	</a>","</li>"].join("");return n},appendUserTpl:function(e,t,i){var n=['<a href="http://www.renren.com/profile.do?id='+e+'" namecard="'+e+'" title="'+t+'">','	<img src="'+i+'">',"</a>"].join("");return n},initInput:function(){this.element.val(""),this.resultContainer.hide()}})}),define("ui/friendManagement",function(require,e){var t=jQuery.noConflict(),i={getAllData:function(e,i){var n=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:!0,init:!0,param:{}});t.ajax({url:"http://friend.renren.com/friendsSelector.do",type:"post",dataType:"text",data:"p="+n,success:function(n){e.call(i,t.parseJSON(n))}})},getSpecificData:function(e,i,n){var a=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:e,init:"全部好友"===e,param:{}});t.ajax({url:"http://friend.renren.com/recommendSelector.do",type:"post",cache:!0,dataType:"text",data:"p="+a,success:function(e){i.call(n,t.parseJSON(e))},error:function(e){console.log("失败")}})},batchRemove:function(e,i,n,a){t.ajax({url:"http://friend.renren.com/friends/api/batchremove?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'batchremove','ids':["+e+"],'groupname':'"+i+"'}",success:function(e){n.call(a,t.parseJSON(e))}})},searchGroupData:function(e,i,n,a){if("全部好友"===i)var s="all";else var s="normal";t.ajax({url:"http://friend.renren.com/friends/api/searchgroupdata?t="+Math.random(),type:"post",dataType:"text",data:"p=[{'t':'people','data':'"+e+"'},{'t':'gid','data':'"+i+"'},{'t':'gtype','data':'"+s+"'}]",success:function(e){n.call(a,t.parseJSON(e))}})},addIntoGroup:function(e,i,n,a){t.ajax({url:"http://friend.renren.com/friends/api/batchaddgroups?t="+Math.random(),type:"post",dataType:"text",data:"p={'action':'batchadd','keep':'1','groupsname':['"+e+"'],'ids':["+i+"]}",success:function(e){n.call(a,t.parseJSON(e))}})}};t.widget("ui.friendManagement",{options:{specificGName:"",onAddFriends:function(){},onRemoveFriends:function(){}},_create:function(){this.initGroupName=this.options.specificGName,this.otherRequestCount=0,this.dialogContainer=null,this.tabCurrent=null,this.currentContainer=null,this.currentSelectContainer=null,this.currentUserList=null,this.curCountDom=null,this.curTotalDom=null,this.curTotalCount=null,this.curList=null,this.activedUserCount=0,this.curSelectAllBox=null,this.tabOther=null,this.otherContainer=null,this.otherSelectContainer=null,this.otherCount=null,this.groupList=null,this.otherUserList=null,this.searchInput=null,this.activedGroupName=null,this.otherActivedUCont=0,this.otherActList=null,this.otherSelectAllBox=null,this.showDialog()},_init:function(){},_destroy:function(){_self.dialogContainer.remove()},_events:function(){var e=this;this.dialogContainer.on("click",".cls-btn,.cancel",function(){e.dialogContainer.remove(),t(".ui-widget-overlay").hide()}),this.dialogContainer.on("click",".other-group",function(){e.initOtherGroup(),e.showOtherGroup(),e.otherCleanUp(),e.otherCheckBtn(),e.otherCheckAll()}),this.dialogContainer.on("click",".current-group",function(){e.showCurrentGroup(),e.initCurrentGroup(),e.curCleanUp(),e.curCheckBtn(),e.curCheckAll()}),this.currentContainer.on("click",".a-friend",function(){t(this).toggleClass("selected");var i=t(this).children("p").html(),n=t(this).attr("data-uid");t(this).hasClass("selected")?(t(e.getSeletedItem(i,n)).appendTo(e.currentSelectContainer),e.activedUserCount++):(e.currentSelectContainer.find(".a-selected[data-uid="+n+"]").remove(),e.activedUserCount--),e.curCountDom.html(e.activedUserCount),e.curCheckAll(),e.curCheckBtn()}),this.currentContainer.on("click",".a-selected i",function(){var i=t(this).parent().attr("data-uid");t(this).parent().remove(),e.currentUserList.find(".a-friend[data-uid="+i+"]").removeClass("selected"),e.activedUserCount--,e.curCountDom.html(e.activedUserCount),e.curCheckAll(),e.curCheckBtn()}),this.currentContainer.on("click",".select-all a",function(){t(this).hasClass("checked")?e.curCleanUp():e.curSelectAll(),e.curCheckBtn()}),this.currentContainer.on("click",".clear-data",function(){e.curCleanUp(),e.curCheckBtn()}),this.dialogContainer.on("click",".remove",function(){t(this).hasClass("disable")||e.removeMember()}),this.otherContainer.on("click",".a-group",function(){e.activedGroupName=t(this).html();var n=t(this).attr("data-map");i.getSpecificData(e.activedGroupName,function(t){e.renderSpecificGroup(t,n),e.otherCheckBtn(),e.searchFriends()})}),this.otherContainer.on("keyup",".search-friend",function(){e.searchFriends()}),this.otherContainer.on("click",".a-friend",function(){t(this).toggleClass("selected");var i=t(this).children("p").html(),n=t(this).attr("data-uid");t(this).hasClass("selected")?(t(e.getSeletedItem(i,n)).appendTo(e.otherSelectContainer),e.otherActivedUCont++):(e.otherSelectContainer.find(".a-selected[data-uid="+n+"]").remove(),e.otherActivedUCont--),e.otherCheckAll(),e.otherCount.html(e.otherActivedUCont),e.otherCheckBtn()}),this.otherContainer.on("click",".a-selected i",function(){var i=t(this).parent().attr("data-uid");t(this).parent().remove(),e.otherUserList.find(".a-friend[data-uid="+i+"]").removeClass("selected"),e.otherActivedUCont--,e.otherCheckAll(),e.otherCount.html(e.otherActivedUCont),e.otherCheckBtn()}),this.otherContainer.on("click",".select-all a",function(){t(this).hasClass("checked")?e.otherCleanUp():e.otherSelectAll(),e.otherCheckBtn()}),this.otherContainer.on("click",".clear-data",function(){e.otherCleanUp(),e.otherCheckBtn()}),this.otherContainer.on("click",".add",function(){t(this).hasClass("disable")||e.addMember()})},initCurrentGroup:function(){var e=this;i.getSpecificData(e.initGroupName,function(i){for(var n=i.candidate,a="",s=0;s<n.length;s++)a+=e.getUserListItem(i.candidate[s].head,i.candidate[s].name,i.candidate[s].id);e.currentUserList.html(t(a)),e.initCurrentCount()})},initOtherGroup:function(){var e=this;if(0==e.otherRequestCount)i.getAllData(function(t){e.renderGroupList(t),e.activedGroupName=e.groupList.find("li a:first").html(),e.renderSpecificGroup(t,-1),e.otherRequestCount++});else{var t=e.groupList.find(".actived"),n=t.attr("data-map");e.activedGroupName=t.html(),i.getSpecificData(e.activedGroupName,function(t){e.renderSpecificGroup(t,n)})}},createDialog:function(){var e=this;i.getSpecificData(e.initGroupName,function(i){for(var n=i.candidate,a="",s=0;s<n.length;s++)a+=e.getUserListItem(i.candidate[s].head,i.candidate[s].name,i.candidate[s].id);t.ui.dialog({dialogClass:"member-manage-dialog",width:569,buttons:[]}),t(".member-manage-dialog .ui-widget-content").hide(),t(e.getDialog(a,e.initGroupName)).appendTo(t(".member-manage-dialog")),e.setParam(),e.resizePosition(),e.initCurrentCount(),e._events()})},showCurrentGroup:function(){this.tabCurrent.addClass("selected"),this.tabOther.removeClass("selected"),this.otherContainer.hide(),this.currentContainer.show()},showOtherGroup:function(){this.tabOther.addClass("selected"),this.tabCurrent.removeClass("selected"),this.currentContainer.hide(),this.otherContainer.show()},renderGroupList:function(e){for(var t=e.groups,i="",n=0;n<t.length+1;n++)i+=0===n?this.getGroupListItem("全部好友",n):this.getGroupListItem(t[n-1],n);this.groupList.html(i)},setParam:function(){this.dialogContainer=t(".member-manage-dialog"),this.tabCurrent=this.dialogContainer.find(".current-group"),this.tabOther=this.dialogContainer.find(".other-group"),this.currentContainer=this.dialogContainer.find(".dialog-content-current"),this.currentUserList=this.currentContainer.find(".list-detail"),this.currentSelectContainer=this.currentContainer.find(".select-list-container"),this.curCountDom=this.currentContainer.find(".select-tips .selected"),this.curTotalDom=this.currentContainer.find(".select-tips .total"),this.curSelectAllBox=this.currentContainer.find(".select-all a"),this.removeBtn=this.currentContainer.find(".remove"),this.otherContainer=this.dialogContainer.find(".dialog-content-other"),this.otherSelectContainer=this.dialogContainer.find(".dialog-content-other .select-list-container"),this.otherCount=this.otherContainer.find(".select-tips .selected"),this.groupList=this.otherContainer.find(".group-list ul"),this.otherUserList=this.otherContainer.find(".list-detail"),this.searchInput=this.otherContainer.find(".search-friend"),this.otherSelectAllBox=this.otherContainer.find(".select-all a"),this.addBtn=this.otherContainer.find(".add")},showDialog:function(){t(".member-manage-dialog").length>0?(t(".member-manage-dialog").show(),t(".ui-widget-overlay").show(),this.resizePosition()):this.createDialog()},resizePosition:function(){t(".member-manage-dialog").css({left:(t(window).width()-611)/2+"px",top:(t(window).height()-549)/2+"px"})},curCleanUp:function(){this.currentContainer.find(".a-friend").removeClass("selected"),this.currentSelectContainer.html(""),this.initCurrentCount(),this.curCheckAll()},curSelectAll:function(){this.activedUserCount=this.curTotalCount,this.curCountDom.html(this.curTotalCount),this.currentContainer.find(".a-friend").addClass("selected");for(var e=this.currentContainer.find(".a-friend"),i="",n=0;n<e.length;n++)i+=this.getSeletedItem(t(e[n]).children("p").html(),t(e[n]).attr("data-uid"));this.curCheckAll(),this.currentSelectContainer.html(i)},curCheckAll:function(){this.activedUserCount==this.curTotalCount&&0!=this.curTotalCount?this.curSelectAllBox.addClass("checked"):this.curSelectAllBox.removeClass("checked")},curCheckBtn:function(){this.currentSelectContainer.find(".a-selected").length>0?this.removeBtn.removeClass("disable"):this.removeBtn.addClass("disable")},otherCleanUp:function(){this.otherContainer.find(".a-friend").removeClass("selected"),this.otherSelectContainer.html(""),this.initOtherCount(),this.otherCheckAll()},otherSelectAll:function(){for(var e=this.otherContainer.find(".a-friend").not(".hidden").not(".selected").addClass("selected"),i="",n=0;n<e.length;n++)i+=this.getSeletedItem(t(e[n]).children("p").html(),t(e[n]).attr("data-uid"));t(i).appendTo(this.otherSelectContainer),this.otherActivedUCont=this.otherSelectContainer.find(".a-selected").length,this.otherCount.html(this.otherActivedUCont),this.otherCheckAll()},otherCheckAll:function(){this.otherUserList.find(".a-friend").not(".hidden").length==this.otherUserList.find(".selected").length&&this.otherUserList.find(".a-friend").not(".hidden").length>0?this.otherSelectAllBox.addClass("checked"):this.otherSelectAllBox.removeClass("checked")},otherCheckBtn:function(){this.otherSelectContainer.find(".a-selected").length>0?this.addBtn.removeClass("disable"):this.addBtn.addClass("disable")},addMember:function(){for(var e=this,n=[],a=this.otherSelectContainer.find(".a-selected"),s=0;s<a.length;s++)n.push(t(a[s]).attr("data-uid"));i.addIntoGroup(e.initGroupName,n,function(t){e.otherUserList.find(".selected").removeClass("selected"),
e.otherSelectContainer.html(""),e.otherTotalCount=e.otherTotalCount,e.initOtherCount(),e.otherCheckAll(),e.otherCheckBtn(),e.options.onAddFriends(nx.data.feed.feedGId)})},removeMember:function(){for(var e=this,n=this.currentSelectContainer.find(".a-selected"),a=[],s=0;s<n.length;s++)a.push(t(n[s]).attr("data-uid"));i.batchRemove(a,e.initGroupName,function(t){e.currentUserList.find(".selected").remove(),e.currentSelectContainer.html(""),e.initCurrentCount(),e.curCheckBtn(),e.curCheckAll(),e.options.onRemoveFriends(nx.data.feed.feedGId)})},getSeletedItem:function(e,t){var i=['<a data-uid="'+t+'" class = "a-selected">',"	<span>"+e+"</span>","	<i></i>","</a>"].join("");return i},getGroupListItem:function(e,t){var i=["<li>",'	<a class="a-group" data-map="'+t+'">'+e+"</a>","</li>"].join("");return i},getUserListItem:function(e,t,i,n){if(n)var a=['<div class="a-friend selected" data-uid="'+i+'">','	<img src="'+e+'">',"	<p>"+t+"</p>","</div>"].join("");else var a=['<div class="a-friend" data-uid="'+i+'">','	<img src="'+e+'">',"	<p>"+t+"</p>","</div>"].join("");return a},getDialog:function(e,t){var i=['	<div class="header">',"		<h2>"+t+"成员管理</h2>",'		<a class="cls-btn"></a>',"	</div>",'	<div class="dialog-tab clearfix">','		<a class="current-group selected">删除组员</a>','		<a class="other-group">添加组员</a>',"	</div>",'	<div class="dialog-content-current">','		<div class="show-list-container">','			<p class="select-all clearfix">',"				<a></a>","				全选","			</p>",'			<div class="list-detail clearfix">'+e,"			</div>","		</div>",'		<div class="select-tips clearfix">','			<span>选中的好友(<span class="selected"></span>/<span class="total"></span>)</span>','			<a class="clear-data">清空</a>',"		</div>",'		<div class="select-list-container">',"		</div>",'		<div class="footer clearfix">','			<a class="remove disable">移出'+t+"组</a>",'			<a class="cancel">取消</a>',"		</div>","	</div>",'	<div class="dialog-content-other">','		<div class="clearfix">','			<div class="group-list">','				<input class="search-friend" placeholder="搜索好友">',"				<ul>","				</ul>","			</div>",'			<div class="show-list-container">','				<p class="select-all clearfix">',"					<a></a>","					全选","				</p>",'				<div class="list-detail clearfix">',"				</div>","			</div>","		</div>",'		<div class="select-tips clearfix">','			<span>选中的好友(<span class="selected"></span>)</span>','			<a class="clear-data">清空</a>',"		</div>",'		<div class="select-list-container">',"		</div>",'		<div class="footer clearfix">','			<a class="add disable">移入'+t+"组</a>",'			<a class="cancel">取消</a>',"		</div>","	</div>"].join("");return i},initCurrentCount:function(){this.activedUserCount=0,this.curCountDom.html(0),this.curTotalCount=this.currentUserList.find(".a-friend").length,this.curTotalDom.html(this.curTotalCount)},initOtherCount:function(){this.otherActivedUCont=0,this.otherCount.html(0)},renderSpecificGroup:function(e,i){var n=e.candidate;this.otherActList=n;for(var a="",s=[],o=this.otherSelectContainer.find("a"),r=0;r<o.length;r++)s.push(t(o[r]).attr("data-uid"));for(var r=0;r<n.length;r++)a+=-1!=t.inArray(n[r].id.toString(),s)?this.getUserListItem(n[r].head,n[r].name,n[r].id,!0):this.getUserListItem(n[r].head,n[r].name,n[r].id);-1==i?this.groupList.find(".a-group:eq(0)").addClass("actived"):(this.groupList.find(".actived").removeClass("actived"),this.groupList.find("a[data-map="+i+"]").addClass("actived")),this.otherUserList.html(a),this.otherCheckAll()},searchFriends:function(){var e=this;i.searchGroupData(e.searchInput.val(),e.activedGroupName,function(t){e.otherUserList.find(".a-friend").addClass("hidden");var i=t.data;if(i.length>0)for(var n=0;n<i.length;n++)e.otherUserList.find(".a-friend[data-uid="+i[n].fid+"]").removeClass("hidden");""==e.searchInput.val().trim()&&e.otherUserList.find(".a-friend").removeClass("hidden"),e.otherCheckAll(),e.otherCheckBtn()})}})}),define("newsfeed/advert",function(require){var $=require("jquery"),advert={singleCol:!1,_closeEvent:function(e){var t=$(".openAdvert");t.length&&t.on("click",".openAdvert-close",function(i){t.remove(),$("#openAdvert_data").remove(),$.ajax({url:"http://www.renren.com/ajax/v7closeActivity",type:"POST",data:{spreadId:e},dataType:"json",success:function(e){}}),i.stopPropagation()})},_locationEvent:function(){var e=$(".openAdvert");e.length&&e.on("click",".openAdvert-logo, .openAdvert-bottom",function(e){window.open($(this).attr("data-href")),e.stopPropagation()})},_ajax:function(){var This=this,openAdvertData=$("#openAdvert_data");if(openAdvertData.length){var data;eval("data ="+openAdvertData.attr("openAdvert-data"));var iconUrl=data.folImg||"",logoUrl=data.freImg||"",linkUrl=data.link.match("http://")?data.link:"http://"+data.link,slogan=data.content||data.name;$("#toolBackTo").append(This._tpl.openAdvert(logoUrl,iconUrl,linkUrl,slogan)),This._position(),This._closeEvent(data.id),This._locationEvent()}},_tpl:{openAdvert:function(e,t,i,n){n=n.length<=9?n:n.substr(0,9);var a=['<div class="openAdvert">','	<div class="openAdvert-top">','		<img class="openAdvert-logo" src="'+e+'" data-href="'+i+'">','		<span class="openAdvert-close"></span>',"	</div>",'	<a class="openAdvert-bottom" data-href="'+i+'" target="_blank">','		<img class="openAdvert-icon" src="'+t+'">','		<span class="openAdvert-slogan">'+n+"</span>","	</a>","</div>"].join("");return a}},_position:function(){return},renderDom:function(){var e=$(window).width(),t=$("#webpager").hasClass("fold"),i=!nx.data.isDoubleFeed;switch(arguments[1]){case"fold":t=!0;break;case"unfold":t=!1;break;case"single":i=!0;break;case"double":i=!1}e>=1500&&t&&i?$(".openAdvert").length?(this._position(),$(".openAdvert").show()):this._ajax():$(".openAdvert").is(":hidden")||$(".openAdvert").hide()},scroolEvent:function(){$(".openAdvert").length&&$(document).scrollTop()>0?$(".openAdvert-top").show():$(".openAdvert-top").hide()},bindEvent:function(){$(window).scroll(this.scroolEvent),$(document).on("mainframe:reflow",this.renderDom.bind(this))},init:function(){window.location.href.match("matter")||this.bindEvent()}};return advert}),define("newsfeed/doubleCols",function(require,exports){var $=require("jquery"),tools=require("newsfeed/tools"),doubleCols={win:$(window),rootEle:$("html"),bdContainer:$(".bd-container"),doubleImg:function(img,closeWid){var This=$(img),wid=This.attr("data-width"),hei=This.attr("data-height"),data=eval("("+This.attr("data-viewer")+")");if(!wid)return void setTimeout(function(){doubleCols.doubleImg(img,closeWid)},300);if(wid>closeWid){This.css({width:closeWid+"px",height:hei*closeWid/wid+"px"});var vocalPlayer=This.parent().siblings(".vocal-player");vocalPlayer.length&&(vocalPlayer.css({width:closeWid-20+"px"}),vocalPlayer.find(".count").css({left:closeWid-110+"px"}),This.parent().siblings(".vocal-btn").css({left:(closeWid-84)/2+"px"}))}},imgReset:function(){if(!nx.browser.name.toLowerCase().match("ie")){var e=$(".location-left").find("img")||[],t=$(".share-photo").find("img")||[],i=$(".photo-content-1").find("a:not(.location-left)").find(".photo-feed-pic1")||[];if($(".double-cols-feed").length)e.each(function(e,t){var i=$(t).attr("data-width");i?doubleCols.doubleImg(t,410):setTimeout(function(){doubleCols.doubleImg(t,410)},200)}),t.each(function(e,t){var i=$(t).attr("data-width");i?doubleCols.doubleImg(t,410):setTimeout(function(){doubleCols.doubleImg(t,410)},200)}),i.each(function(e,t){var i=$(t).attr("data-width");i?doubleCols.doubleImg(t,440):setTimeout(function(){doubleCols.doubleImg(t,440)},200)});else{var n=function(e,t){var i=$(e),n=i.width(),a=i.height();if(i.attr("style",""),n==t){var s=t+60;i.css({width:s+"px",height:a*s/n+"px"});var o=i.parent().siblings(".vocal-player");o.length&&(o.css({width:s-20+"px"}),o.find(".count").css({left:s-110+"px"}),i.parent().siblings(".vocal-btn").css({left:(s-84)/2+"px"}))}};e.each(function(e,t){n(t,410)}),t.each(function(e,t){n(t,410)}),i.each(function(e,t){n(t,440)})}}},adjustHeight:function(){for(var e,t=$("#feed-list"),i=$("#feed-list-right"),n=t.height(),a=i.height();n>a&&(e=t.children().last(),e.height()+20<n-a);)i.append(e),n=$("#feed-list").height(),a=$("#feed-list-right").height();for(;a>n&&(e=i.children().last(),e.height()+20<a-n);)t.append(e),n=$("#feed-list").height(),a=$("#feed-list-right").height()},_doubleFeed:function(e){var t=this,i=$("#feed-list"),n=$("#feed-list-right");if(setTimeout(function(){t.imgReset()},100),!i.length)return void setTimeout(function(){t._doubleFeed(e)},50);var a=function(){for(var e=i.children(),t=[],n=0;n<e.length;n++)e[n+1]&&(e[n].className.match("linkage-for")||e[n+1].className.match("linkage-for"))||e[n].className.match("a-feed")&&t.push(e[n]);return $(t)}(),s=$(),o=$("#recommendArea"),r=$("#huatiBox");if(n.length)if(e){a.each(function(e,t){$(t).hasClass("similar-feed")||e%2&&(n.append(t),s=s.add(t))}),s.length&&s.eq(Math.min(s.length-2,4)).after(r),s.length?s.eq(Math.min(s.length-1,4)).after(o):$("#mergeModule").after(o),setTimeout(function(){t.adjustHeight()},500);var d=setInterval(function(){$(".advert-banner").length&&($(".advert-banner").parent().parent().hide(),clearInterval(d))},50)}else{for(var l=n.children(),c=[],h=0,p=0;p<l.length;p++){var f=l[p].className;if(f.match("linkage-for"))c.push(l[p]);else if(f.match("a-feed")&&a[h]){if(a[h+1])for(;a[h+1].className.match("linkage-for");)h++;$(a[h]).after(l[p]),h++}}c.length&&$("#"+c[0].className.match(/\d+/)[0]).after(c),n.find(".a-feed").length&&n.find(".a-feed").each(function(e,t){i.append(t)}),$("#merge-side-item-body").append(o);var u=setInterval(function(){$(".advert-banner").length&&($(".advert-banner").parent().parent().show(),clearInterval(u))},50)}},_onFeedChange:function(e,t){var i=this;if(i.bdContainer.hasClass("double-cols-feed")){setTimeout(function(){i.imgReset()},100);var n=$("#feed-list"),a=$("#feed-list-right");if("empty"===t)n.empty(),a.empty();else{var s=function(){for(var e=n.children(),t=[],i=0;i<e.length;i++)e[i+1]&&(e[i].className.match("linkage-for")||e[i+1].className.match("linkage-for"))||t.push(e[i]);return $(t)}(),o=a.find(".a-feed");s.length>o.length?s.slice(o.length).each(function(e,t){$(t).hasClass("similar-feed")||e%2&&a.append(t)}):s.length<o.length&&o.slice(s.length).each(function(e,t){e%2&&n.append(t)}),setTimeout(function(){i.adjustHeight()},500)}}},winHeight:0,winWith:0,changeCols:function(){var e=window.innerHeight||document.documentElement.clientHeight,t=window.innerWidth||document.documentElement.clientWidth;if("single"==arguments[1]||"double"==arguments[1]||e!==this.winHeight||t!==this.winWidth){this.winHeight=e,this.winWidth=t;var i=this,n=i.win.width();if(i.rootEle.hasClass("nx-main760")){if(n>=1260&&nx.data.isDoubleFeed?i.bdContainer.hasClass("double-cols-feed")||(i.bdContainer.addClass("double-cols-feed"),i._doubleFeed(!0)):i.bdContainer.hasClass("double-cols-feed")&&(i.bdContainer.removeClass("double-cols-feed"),$(".bd-publisher").find("div").length?($(".new-feed-tip").length&&!$(".new-feed-tip").hasClass("pubTip")&&$(".new-feed-tip").addClass("pubTip"),$("#missed-feed-tips").length&&!$("#missed-feed-tips").hasClass("pubTip")&&$("#missed-feed-tips").addClass("pubTip")):($(".new-feed-tip").length&&$(".new-feed-tip").removeClass("pubTip"),$("#missed-feed-tips").length&&$("#missed-feed-tips").removeClass("pubTip")),i._doubleFeed(!1)),n>=1260?($(".single-col").show(),$(".double-cols").show()):($(".single-col").hide(),$(".double-cols").hide()),$.event.trigger("newsfeed:"+(i.bdContainer.hasClass("double-cols-feed")?"double":"single")),"single"===arguments[1]||"double"===arguments[1])return;$(".none-feed").length?tools.btnFactory(2):$(".a-feed").length&&(tools.btnFactory(1),$(".setting-btn").is(":hidden")||setTimeout(function(){tools.btnFactory(4)},250))}}},bindEvent:function(){$(window).on("feedchange",this._onFeedChange.bind(this)),$(window).on("adjustheight",this.adjustHeight.bind(this)),$(document).on("mainframe:reflow",this.changeCols.bind(this))},init:function(){this.bindEvent()}};return doubleCols}),define("newsfeed/index",function(require,e){var t=jQuery.noConflict(),i=require("newsfeed/doubleCols"),n=require("newsfeed/initFeed"),a=require("newsfeed/loader"),s=require("newsfeed/feedFilter"),o=require("newsfeed/tips"),r=require("newsfeed/feedSort"),d=require("newsfeed/log"),l=require("newsfeed/advert"),c=function(){void 0==nx.data.feed&&(nx.data.feed={}),nx.data.feed.pvTab="1",new a.FeedLoader,new s.FeedFilter,new r.FeedSort,new o.FeedTips,new d.FeedLoger,i.init(),i.changeCols(),l.init(),n.init(),n.handleData(t(".bd-content").find(".a-feed")),nx.data.page&&t(nx.data.feed).trigger("contentFocus",{type:20})};e.feedIndex=c}),define("newsfeed/feed",["jquery","newsfeed/reply","newsfeed/toolbar","newsfeed/photo","newsfeed/Recommend","newsfeed/voice","newsfeed/mvideo","newsfeed/tools"],function(e,t,i,n,a,s,o,r){e.widget("newsfeed.feed",{options:{source:null},_create:function(){var d=this.element,l=d.attr("id"),c=d.children(".header").children(".user-avatar").attr("data-stype");if(this.feedId=l,!nx.data.matter&&d.find(".reply").length>0&&e("#get-params-for-"+l).length>0)try{var h=e.parseJSON(r.unescapeHTML(e("#get-params-for-"+l).html()));this.feedReply=new t.FeedReply(l,h,c)}catch(p){console.log("新鲜事"+l+"评论参数有问题，新鲜事类型为"+c)}new i.ToolBar(l),d.find(".cursor-all img").length>1&&new n.multiPhoto(l),d.find(".action-4-pics").length>0&&new a.Recommend(l),("103"==c||"701"==c||"2004"==c)&&d.find(".vocal-player").length>0&&new s.Voice(l,c),d.find(".blog-video").length>0&&this.resizeBlogIcon(l),d.find(".link-img img").length>0&&this.resizeLinkImg(l),13===this.options.source&&e("#"+l).find(".feed-hide").hide(),(nx.browser.chrome===!0||nx.browser.mozilla===!0)&&("103"===c||"701"===c||"709"===c||"104"===c)&&this.addShadow(l,c),d.find(".feed-icon-iphone").length>0&&e("#"+l).find(".feed-icon-iphone").html("手机icon<i></i>"),d.find(".feed-icon-android").length>0&&e("#"+l).find(".feed-icon-android").html("手机icon<i></i>"),d.find(".micro-video-content").length>0&&(this.mvideo=new o.MVideo(l))},_destroy:function(){this.feedReply&&this.feedReply.destroy(),this.mvideo&&this.mvideo.destroy()},resizeBlogIcon:function(t){var i=e("#"+t);if(i.find(".blog-video").length>0){var n=i.find(".play-btn"),a=i.find(".blog-video img");a.load(function(){n.css({left:(a.width()-42)/2+"px",top:(a.height()-42)/2+"px"})}),n.css({left:(a.width()-42)/2+"px",top:(a.height()-42)/2+"px"})}},resizeLinkImg:function(t){var i=e("#"+t).find(".link-img img");i.length>0&&r.linkResize(i)},addShadow:function(t,i){var n=e("#"+t);if("103"===i){n.find(".share-photo")}else{var a,s=n.find(".cursor-all");if("701"===i||"709"===i)for(a=0;a<s.length;a++)e("<span class='shadow-div' data-viewer='"+e(s[a]).children("img").attr("data-viewer")+"'></span>").appendTo(s[a]);else for(a=0;a<s.length;a++)e("<span class='shadow-div'></span>").appendTo(s[a])}}})}),define("newsfeed/loader",function(require,e){var t=jQuery.noConflict(),i=require("newsfeed/tools"),n={getAllFeed:function(e,i,n,a,s,o){var r;r=(t(".bd-container").hasClass("double-cols-feed"),"10"),t.ajax({url:"http://www.renren.com/feedretrieve4.do",type:"post",data:"byTime="+e+"&begin="+i+"&limit="+n+"&isjson=0&view="+r+"&type="+a,dataType:"text",success:function(e){s.call(o,e)}})},getGroupFeed:function(e,i,n,a,s,o){t.ajax({url:"http://www.renren.com/feedgroup.do",type:"post",data:"p="+e+"&begin="+i+"&limit="+n+"&gid="+a+"&view=10",dataType:"text",success:function(e){s.call(o,e)}})},getOriginalFeed:function(e,i,n,a,s){t.ajax({url:"http://www.renren.com/feedretrieve4.do",type:"post",data:"byTime="+e+"&begin="+i+"&limit="+n+"&isjson=0&view=10&type=1",dataType:"text",success:function(e){a.call(s,e)}})},getFocusFeed:function(e,i,n){t.ajax({url:"http://www.renren.com/feedfavorite2.do",type:"post",data:"p="+e+"&view=10",dataType:"text",success:function(e){i.call(n,e)}})},getContentFocus:function(e,i,n,a){var s;s=(t(".bd-container").hasClass("double-cols-feed"),"10"),t.ajax({url:"http://www.renren.com/feedsubscribe.do",type:"post",data:"feedid="+e+"&limit=20&view="+s+"&sub="+i,dataType:"text",success:function(e){n.call(a,e)}})},getMissedFeedData:function(e,i,n,a){t.ajax({url:"http://www.renren.com/feedmissgetdata.do",type:"post",data:"begin="+e+"&limit="+i+"&view=10",dataType:"text",success:function(e){n.call(a,e)}})}},a=function(e){this.AUTO_LOAD=2,this.has_loaded=0,this.pageNum=0,this.nomoredata=!1,this.feedList=t("#feed-list"),this.bdContent=t(".bd-content"),this.feedLoadedFlag=!0,this.dataLength=0,this.getFeedType=0,this.sortType=t("#frameFixedNav .feed-sort .by-time"),this.gId=0,this.loadingTips="<p id='feed-loading-tips'>新鲜事读取中...</p>",this.initialize()};a.prototype={initialize:function(){this.bindEvents()},getData:function(){var e,i,a,s=this;if(t(nx.data.feed).trigger("feedLoading"),0==this.has_loaded?(e=0,i=10,a=0):1==this.has_loaded?(e=10,i=30,a=1):2==this.has_loaded?(e=40,i=20,a=2):(e=20*this.has_loaded,i=20,a=this.has_loaded),0==this.getFeedType){var o;o=this.sortType.hasClass("checked")?1:0,n.getAllFeed(o,e,i,-1,function(e){nx.data.feed.ifloadTime=!0,nx.data.feed.loadTime=new Date,s.handleFeedData(e)})}else if(11==this.getFeedType)n.getGroupFeed(a,e,i,s.gId,function(e){s.handleFeedData(e)});else if(12==this.getFeedType)nx.data.feed.focusContent&&(this.focusId="INF",nx.data.feed.focusContent=!1),n.getContentFocus(s.focusId,s.focusType,function(e){s.handleFeedData(e)});else if(13==this.getFeedType)n.getFocusFeed(a,function(e){s.handleFeedData(e)});else if(14==this.getFeedType)n.getMissedFeedData(e,i,function(e){s.handleFeedData(e)});else if(1==this.getFeedType)n.getOriginalFeed(0,e,i,function(e){s.handleFeedData(e)});else{var r;r=9==this.getFeedType?1:0,n.getAllFeed(r,e,i,s.getFeedType,function(e){s.handleFeedData(e)})}this.bindScrollEvent()},handleFeedData:function(e){var i=this,n=e.split("##@L#");this.focusId=n[1],i.missedFeedFlag&&(i.missedFeedFlag=!1,"1"==n[4]&&(nx.data.feed.getMissedFeed=!0)),"0"==n[3]&&""==n[0].trim()?t(nx.data.feed).trigger("nomoredata"):t(nx.data.feed).trigger("feedRecieved",{data:e,loaded:i.has_loaded,type:i.getFeedType})},bindScrollEvent:function(){var e=this;0==this.has_loaded&&t(window).bind("scroll/200",e.scrollEvent)},scrollEvent:function(){var e=t("#feed-list");t(document).scrollTop()>=.7*e.height()&&t(nx.data.feed).trigger("feedLoadingStart")},bindEvents:function(){var e=this;nx.data.matter||(this.bindScrollEvent(),t(nx.data.feed).on("feedLoadingStart",function(){e.feedLoadedFlag&&(e.has_loaded<=e.AUTO_LOAD-1?(e.has_loaded=e.has_loaded+1,e.feedLoadedFlag=!1,e.getData()):e.has_loaded>e.AUTO_LOAD?t(window).unbind("scroll",e.scrollEvent):t(window).unbind("scroll",e.scrollEvent))}),t(nx.data.feed).on("nomoredata",function(n){e.nomoredata=!0,t("#feed-loading-tips").hide(),nx.data.feed.focusContent?0==e.feedList.find(".none-feed").length&&i.btnFactory(3):0==e.feedList.find(".none-feed").length&&i.btnFactory(2),t(".setting-btn").is(":hidden")||i.btnFactory(4)}),t(nx.data.feed).on("feedLoading",function(t){e.feedList.find(".get-more-feed").length>0}),t(nx.data.feed).on("feedRendered",function(n){e.feedLoadedFlag=!0,0==e.nomoredata&&(i.btnFactory(1),setTimeout(function(){t(".setting-btn").is(":hidden")||i.btnFactory(4)},100))}),t(nx.data.feed).on("groupFocus",function(t,i){nx.data.feed.focus=!0,nx.data.feed.focusContent=!1,e.getFeedType=13,i||e.initFeedList()}),t(nx.data.feed).on("contentFocus",function(t,i,n){nx.data.feed.focusContent=!0,e.getFeedType=12,e.focusType=i.type,"1"==e.focusType?nx.data.feed.pvTab="5":"0"==e.focusType?nx.data.feed.pvTab="6":"20"==e.focusType&&(nx.data.feed.pvTab="7"),n||e.initFeedList()}),t(nx.data.feed).on("friendsNewsFeed",function(t,i){nx.data.feed.focusContent=!1,e.getFeedType=11,e.gId=i,e.initFeedList()}),t(nx.data.feed).on("newsfeedFilter",function(t,i,n){e.getFeedType=parseInt(i.type),n||e.initFeedList()}),t(nx.data.feed).on("friendsOriginal",function(t,i){nx.data.feed.focusContent=!1,nx.data.feed.pvTab="4",e.getFeedType=1,i||e.initFeedList()}),t(nx.data.feed).on("sortBySmart",function(){e.missedFeedFlag=!0,nx.data.feed.focusContent=!1,nx.data.feed.pvTab="3",e.getFeedType=0,e.initFeedList()}),t(nx.data.feed).on("sortByTime",function(){nx.data.feed.focusContent=!1,e.missedFeedFlag=!0,nx.data.feed.pvTab="2",e.getFeedType=0,e.initFeedList()}),t(nx.data.feed).on("getMissedFeedData",function(){nx.data.feed.focusContent=!1,e.getFeedType=14,e.initFeedList(),i.btnFactory(4)}),this.bdContent.on("click",".get-more-feed",function(i){e.has_loaded=e.has_loaded+1,t(".double-cols-feed").length?t(this).replaceWith(t('<img style="display:block; float: left;margin: 0 45px;" src="http://s.xnimg.cn/nx/core/theme/images/loading.gif">')):t(this).parents(".get-more-feed-con").remove(),e.getData(),i.preventDefault()}))},initFeedList:function(){this.has_loaded=0,this.nomoredata=!1,this.bdContent.find(".a-feed").remove(),this.bdContent.find(".none-feed").remove(),this.bdContent.find(".similar-feed-link").remove(),this.bdContent.find(".get-more-feed").remove(),this.bdContent.find(".get-more-feed-con").remove(),t("#return-all-tips").remove(),t("#feed-continue-tips").remove(),t("#toolRefreshFeed .feed-continue-read").hide(),t(window).trigger("feedchange","empty"),t("#feed-loading-tips").length>0?t("#feed-loading-tips").show():t(this.loadingTips).appendTo(this.feedList),this.getData()}},e.FeedLoader=a}),define("newsfeed/initFeed",function(require,e){var t=require("jquery"),i=require("newsfeed/feedOptions"),n=require("newsfeed/similarFeed");require("ui/renren/like"),require("ui/renren/share"),require("ui/renren/vocal"),require("ui/renren/follow"),require("newsfeed/feed");var a={feedList:t("#feed-list"),bdContent:t(".bd-content"),fdNav:t(".fd-nav-list"),isCloseKeyOp:!1,isCloseKeyOp:!1,render:function(e){var i,n="",a=t(e.data);for(i=0;i<a.length;i++)t("#"+a.eq(i).attr("id")).length<=0&&-1==n.indexOf(a.eq(i).attr("id"))&&(n+=a.eq(i).get(0).outerHTML);if(n=t(n),this.feedList.find(".none-feed").length>0&&this.feedList.find(".none-feed").remove(),"before"==e.insertType){var s="";for(i=a.length-1;i>=0;i--)t("#"+a.eq(i).attr("id")).length<=0&&-1==s.indexOf(a.eq(i).attr("id"))&&(s+=a.eq(i).get(0).outerHTML);t("#feed-list").find(".a-feed").length>0?t(s).insertBefore(t("#feed-list .a-feed:eq(0)")):t(s).appendTo(t("#feed-list"))}else{if("similarReplace"==e.insertType)return this.bdContent.find("img[data-src]").lazyload({instantly:!0}),void this.handleData(a.get(0),"similarFeed");if("similarAppend"==e.insertType){var o,r="";for(i=0;i<t(n).length;i++)r+='<div class="similar-feed-link linkage-for-'+e.selfFid+'"><i class="left-icon"></i><i class="right-icon"></i></div>',o=t(n).eq(i).addClass("similar-feed").addClass("linkage-for-"+e.selfFid),o.find(".header").addClass("hidden"),r+=o.get(0).outerHTML;return r=t(r),r.insertAfter(t("#"+e.selfFid)),this.bdContent.find("img[data-src]").lazyload({instantly:!0}),void this.handleData(r,"similarFeed")}n.appendTo(this.feedList),t(window).trigger("feedchange")}this.bdContent.find("img[data-src]:not(.footprint-thumb)").lazyload({instantly:!0}),this.handleData(n,e.type)},handleData:function(e,i){var n=t(e),a=n.length;if(a>10&&!nx.browser.name.toLowerCase().match("ie")){var s=Math.floor(a/2),o=n.slice(0,s),r=n.slice(s);this.packHandle(o,i),this.packHandle(r,i)}else this.packHandle(n,i)},packHandle:function(e,n){for(var a=[],s=0;s<e.length;s++){var o=e.eq(s);o.hasClass("a-feed")&&(a.push(o.attr("id")),o.newsfeedfeed({source:n}))}if(new i.FeedOptions(a),t(nx.data.feed).trigger("feedRendered",{ids:a,type:n}),nx.data.feed.ifloadTime){var r;if(nx.data.feed.ifloadTime=!1,"msie"==nx.browser.name.toLowerCase()&&7==nx.browser.versionNumber)r="feedload-home|ie7";else if("msie"==nx.browser.name.toLowerCase()&&8==nx.browser.versionNumber)r="feedload-home|ie8";else if("chrome"==nx.browser.name.toLowerCase())r="feedload-home|chrome";else{if("mozilla"!=nx.browser.name.toLowerCase())return;r="feedload-home|firefox"}nx.stats.ps.add(r,new Date-nx.data.feed.loadTime)}},handlePhoto:function(e){var i=t("#"+e).find(".cursor-all img").not(".photo-content-1 img");tools.imgRelocation(e,i)},handleLike:function(e,i){if(e.likeCount>0)if(e.ownerLike){var n,a,s,o;if(i.find("img[data-uid="+nx.user.id+"]").length>0)return;var r=this.likeAvatar();if(i.find("a").length>0){a=i.find(".list-like-tip");"我和"+a.text();for(t(r).insertBefore(i.find("a:first")),i.find("a").length>4&&i.find("a:last").addClass("hidden-avatar").hide(),s=i.find(".list-like-tip .like-name"),o="",n=0;n<s.length;n++)o+=s.get(n).outerHTML;a.html('<i class="list-like-tip-arr"></i>我和'+o+'等<span class="tip-counts">'+e.likeCount+"</span>人赞过此内容")}else a=i.find(".list-like-tip"),t(r+'<div class="list-like-tip"><i class="list-like-tip-arr"></i>我赞过此内容</div>').appendTo(i)}else{for(a=i.find(".list-like-tip"),i.find(".hidden-avatar").removeClass("hidden-avatar").show(),i.find("a img[data-uid="+nx.user.id+"]").parent("a").remove(),s=i.find(".list-like-tip .like-name"),o="",n=0;n<s.length;n++)o+=s.get(n).outerHTML;a.html('<i class="list-like-tip-arr"></i>'+o+'等<span class="tip-counts">'+e.likeCount+"</span>人赞过此内容")}else i.html("")},likeAvatar:function(){var e=["<a>",'<img src="'+nx.user.tinyPic+'" title="'+nx.user.name+'" data-uid="'+nx.user.id+'">',"</a>"].join("");return e},likeTips:function(e,t,i){var n=['<div class="list-like-tip">','   <i class="list-like-tip-arr"></i>'+e+t+"等"+i+"人赞过此内容","</div>"].join("");return n},likeOperation:function(e){var t=this,i=e.parent().find(".like-friend-list");e.renrenlike({onadd:function(n,a){e.html("<i></i>"+a.likeCount),e.attr("title",""),t.handleLike(a,i),t.fixLikeListWidth(i.find("a").length,i)},onremove:function(n,a){0!=a.likeCount?e.html("<i></i>"+a.likeCount):e.html("<i></i>"),e.attr("title","赞"),t.fixLikeListWidth(i.find("a").length,i),t.handleLike(a,i)}})},removeLikeOperation:function(e){var i,n=this,a=e.parents(".header").nextAll(".appendix").find(".like"),s=a.parent().find(".like-friend-list"),o="http://like.renren.com/removelike",r=o.indexOf("?")>-1?"&":"?",d=e.data("like"),l=["gid","type","owner","uid","name","sourceId","stype","resource","resourceownerid","url","meta"],c={};for(i in d)l.indexOf(i)>-1&&(c[i]=d[i]);c.gid=c.gid||c.stype+"_"+c.sourceId,c.uid=c.uid||nx.user.id,c.name=c.name||nx.user.name,function(){var e=a.hasClass("liked");e&&t.dialog.confirm("真的要撤销对此新鲜事的全部点赞吗?",function(){t.ajax({url:o+r+t.param(c),type:"get",dataType:"json",jsonp:"_jcb",success:function(e){0==e.code?(0!=e.likeCount?a.html("<i></i>"+e.likeCount):a.html("<i></i>"),a.removeClass("liked"),a.attr("title","赞"),n.fixLikeListWidth(s.find("a").length,s),n.handleLike(e,s)):t.dialog.error(e.msg)}})})}()},fixLikeListWidth:function(e,t){e>4?t.css("width",140):t.css("width",35*e)},bindEvent:function(){var e=this;this.bdContent.on("click",".show-all",function(){t(this).parent(".status").html(t(this).next().html())}),this.bdContent.on("mouseover",".vocal-reply",function(){if(!this.playerInited){this.playerInited=!0;var e=t(this).data("vocal");t.renren.vocalPlayer(e,t(this))}}),this.bdContent.on("mouseover",".status-vocal-player",function(){if(!this.playerInited){this.playerInited=!0;var e=t(this).data("vocal");t.renren.vocalPlayer(e,t(this))}}),this.bdContent.on("click",".share",function(){var e={};return e=t.extend(e,t(this).data().share),t(this).renrenshare(e),!1}),this.bdContent.on("mouseover",".like",function(){e.likeOperation(t(this))}),this.bdContent.on("click",".removeLike",function(){e.removeLikeOperation(t(this))}),this.bdContent.on("mouseenter",".like-friend-list",function(){e.fixLikeListWidth(t(this).find("a").length,t(this))}),t(document).on("keyup",function(i){if(!e.isCloseKeyOp&&i.target==t("body").get(0)){var n,a,s;if(75===i.keyCode)for(n=e.feedList.find(".a-feed"),a=n.length-1;a>=0;a--){if(0===a){t(document).scrollTop(0);break}if(s=n.eq(a).offset().top,s-50<t(document).scrollTop()){t(document).scrollTop(s-60);break}}else if(74===i.keyCode)for(n=e.feedList.find(".a-feed"),a=0;a<n.length;a++)if(s=n.eq(a).offset().top,s-70>t(document).scrollTop()){t(document).scrollTop(s-60);break}}}),this.bdContent.on("click",".similar-title",function(e){e.preventDefault(),t(this).prev().hide(),t(this).hide(),new n.SimilarFeed({feedId:t(this).parents(".a-feed").attr("id"),moreData:t.parseJSON(t(this).attr("data-similar-feeds"))})}),this.bdContent.on("click",".more-similar-feeds a",function(){new n.SameActorFeed({otherIds:t(this).attr("data-similar-feeds"),defaultId:t(this).parents(".a-feed").attr("id")}),t(this).parents(".more-similar-feeds").remove()}),this.bdContent.on("mouseenter",".feed-icon-iphone,.feed-icon-android",function(){t(this).attr("data-title",t(this).attr("title")),t(this).attr("title","");var e=['<div class="feed-icon-tips">',"	来自人人"+t(this).attr("data-title"),"	<i></i>","</div>"].join("");t(e).appendTo(t(this))}).on("mouseleave",".feed-icon-iphone,.feed-icon-android",function(){t(this).find(".feed-icon-tips").remove(),t(this).attr("title",t(this).attr("data-title"))}),t(nx.data.feed).on("openViewer",function(){e.isCloseKeyOp=!0}),t(nx.data.feed).on("closeViewer",function(){e.isCloseKeyOp=!1}),t(nx.data.feed).on("feedRecieved",function(i,n){t("#feed-loading-tips").hide(),e.render(n)})},init:function(){this.feedList.find(".feed-btn.liked").attr("title",""),this.bindEvent()}};return a}),define("newsfeed/tools",function(require,e){var t=jQuery.noConflict(),i=function(e,n){var a=t("#"+e);a.on("lazyload:load","img",function(){i.prototype.setImg(t(this))});for(var s=0;s<n.length;s++)n.eq(s).get(0).complete?i.prototype.setImg(n.eq(s)):n.eq(s).load(function(){i.prototype.setImg(n.eq(s))})};i.prototype={setImg:function(e){var t=e.width(),i=e.height();e.parent("a").width(),e.parent("a").height();0===e.width()&&(t=e.width,i=e.height)}};var n=function(e,t,i,a,s){e.get(0).complete?(n.prototype.setImg(e,t,i,a,s),e.css("display","block"),a.show()):e.load(function(){n.prototype.setImg(e,t,i,a,s),e.css("display","block"),a.show()})};n.prototype={setImg:function(e,t,i,n,a){var s=e.width(),o=e.height();s>=200&&o>=100?(t.css({width:s-20+"px"}),i.css({left:s-300+190+"px"})):(200>s||100>o)&&t.css({width:"280px",position:"relative","margin-right":"150px","float":"left"}),"103"===a?n.css({left:(s-84)/2+"px",top:(o-42)/2+e.parents(".share-content").find(".source-desc").height()+18+"px"}):n.css({left:(s-84)/2+"px",top:(o-42)/2+"px"}),e.parent("a").hasClass("location-left")||t.css({left:"0"})}};var a=function(e){var t=e.get(0);t.complete&&t.width?(t.width>150&&t.height>150&&(t.width>t.height?(e.height(150*t.height/t.width),e.width(150)):t.width<t.height?(e.width(150*t.width/t.height),e.height(150)):(e.width(150),e.height(150))),t.height<150&&e.css("margin-top",(150-t.height)/2+"px")):e.load(function(){e.width()>150&&e.height()>150&&(e.width()>e.height()?(e.height(150*e.height()/e.width()),e.width(150)):e.width()<e.height()?(e.width(150*e.width()/e.height()),e.height(150)):(e.width(150),e.height(150))),e.height()<150&&e.css("margin-top",(150-e.height())/2+"px")})},s=function(e){e.complete?s.prototype.resizeImg(e):t(e).load(function(){s.prototype.resizeImg(e)})};s.prototype={resizeImg:function(e){var i=e.width,n=e.height,a=t(e).parent("a").width(),s=t(e).parent("a").height();t(e).css({"margin-top":(s-n)/2+"px","margin-left":(a-i)/2+"px"})}};var o=function(e){var i=parseInt(e);if(!((1===i||2===i)&&(t(".get-more-feed").remove(),t(".newsfeed-empty").length>0)||t("#return-all-tips").length>0&&4===i)){var n={1:{className:"get-more-feed",appendTo:"#feed-list",text:"显示更多新鲜事"},2:{className:"none-feed",appendTo:"#feed-list",text:"<span class='tips-split tips-split-left'></span><span class='none-feed-span'>没有更多新鲜事了，<a href='http://share.renren.com/share/hot/v7'>去分享频道</a>看看更多精彩内容</span><span class='tips-split tips-split-right'></span>"},3:{className:"none-feed",appendTo:"#feed-list",text:"没有关注新鲜事了，<a href='http://follow.renren.com/recommend/v7'>发现更多感兴趣的人</a>"},4:{className:"read-all-feed",appendTo:"#feed-list",text:"全部标记为已读"}};if(4!==i)t(".get-more-feed-con").length>0&&t(".get-more-feed-con").remove(),t("."+n[i].className).length>0&&t("."+n[i].className).remove();else if(t(".read-all-feed").length>0&&t(".read-all-feed").remove(),
!t(".a-feed").length)return;var a=(t(".double-cols").hasClass("checked")>0||nx.data.isDoubleFeed)&&t(window).width()>=1260;a&&(n[1].appendTo=".bd-content",n[2].appendTo=".bd-content",n[3].appendTo=".bd-content",n[4].appendTo=".bd-content");var s=t("<a></a>");(2===i||3===i)&&(s=t("<p></p>"),t(".read-all-feed").length>0&&t(".read-all-feed").remove()),1===i&&a&&(s=t('<div class="clearfix"></div>'),n[1].className="get-more-feed-con",n[1].text='<span class="tips-split tips-split-left"></span><a class="get-more-feed" href="javascript:;">显示更多新鲜事</a><span class="tips-split tips-split-right"></span>'),t(s).addClass(n[i].className).appendTo(n[i].appendTo).attr("href","#nogo").html(n[i].text)}},r=function(e){var t,i;e.focus(),document.createRange?(t=document.createRange(),t.selectNodeContents(e),t.collapse(!1),i=window.getSelection(),i.removeAllRanges(),i.addRange(t)):document.selection&&(t=document.body.createTextRange(),t.moveToElementText(e),t.collapse(!1),t.select())},d=function(e){return e.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&nbsp;/g," ").replace(/&quot;/g,'"').replace(/&amp;/g,"&")},l=function(e){for(var i=t("#feed-list"),n=i.find(".a-feed"),a=0;a<n.length;a++)if(t(n[a]).position().top+35>t(document).scrollTop()){var s,o=0===a?0:a-1,r=i.find(".a-feed:eq("+o+")");if((t(document).scrollTop()-r.position().top)/r.height()>.5)switch(e){case"like":s=r.next().find(".like");break;case"share":s=r.next().find(".share");break;case"reply":s=r.next().find(".reply-input");break;case"continue":s=r.next()}else switch(e){case"like":s=r.find(".like");break;case"share":s=r.find(".share");break;case"reply":s=r.find(".reply-input");break;case"continue":s=r}return s}},c=function(e,t){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var i="[\\?&]"+e+"=([^&#]*)",n=new RegExp(i),a=n.exec(t);return a?decodeURIComponent(a[1].replace(/\+/g," ")):""},h=function(e){var t=e.match(/@[^@\s\)]+\)/g),i=[],n="";if(t){for(var a="",s=0;s<t.length;s++)a=t[s].match(/\((\d+)\)/)?t[s].match(/\((\d+)\)/)[1]:"",i.push(a);n=i.join("_")}return n};e.getAtlog=h,e.queryByName=c,e.fixDom=l,e.unescapeHTML=d,e.setEndOfContenteditable=r,e.btnFactory=o,e.imgRelocation=i,e.vocalResize=n,e.linkResize=a,e.recommandResize=s}),define("newsfeed/reply",function(require,e){var t=jQuery.noConflict();require("ui/Reply"),require("ui/scrollbar");var i={getAllComments:function(e,i,n,a,s){t.ajax({url:e,type:n,dataType:"text",data:i,success:function(e){"0"==t.parseJSON(e).code?a.call(s,t.parseJSON(e)):console.log(t.parseJSON(e).msg)}})}},n=function(e,i,n){var a=this;this.feedId=e,this.article=t("#"+e),this.replyBtn=this.article.find(".reply"),this.replyInfo=i,this.replyListContainer=this.article.find(".feed-reply-container"),this.getAllCommentFlag=!1,this.replyList=this.article.find(".feed-replies"),this.packAllReBtn="<div class='pack-replies clearfix'><span>收起评论</span><i></i></div>",this.showAllReBtn=this.article.find(".more-replies"),this.feedType=parseInt(n),this.initAvatar(),this.article.find(".feed-reply-container").length>0?this.replyUI=new jQuery.ui.Reply({replyData:i,defaultTextarea:!1,replyAdded:function(){a.insertComment()}},t("#"+e)):this.bindNoReplyEvent(),this.bindEvents()};n.prototype={destroy:function(){this.replyUI&&(this.replyUI.destroy(),this.replyUI=null)},bindEvents:function(){var e=this;this.article.on("click",".more-replies span,.more-replies i",function(i){nx.data.matter&&"更多评论"==t(this).parent(".more-replies").children("span").html()?t(this).parent(".more-replies").hide():/\d+/.exec(t(this).html())&&parseInt(/\d+/.exec(t(this).html())[0])<2?t(this).parent(".more-replies").remove():t(this).parent(".more-replies").removeClass("more-replies").addClass("pack-replies clearfix").find("span").html("收起评论"),0==e.getAllCommentFlag&&(e.insertAllComment(!1),e.getAllCommentFlag=!0)}),this.article.on("click",".pack-replies span,.pack-replies i",function(){var i=this;if(e.getAllCommentFlag=!1,e.isPageOrZhan()===!0)t(this).parent(".pack-replies").hide(),e.article.find(".a-reply").remove(),e.article.find(".feed-reply-container").remove(),e.article.find(".own-reply").remove(),e.destroyScrollBar(),setTimeout(function(){t(i).parent(".pack-replies").remove()},200);else{var n=e.article.find(".a-reply").length;3>n?t(this).parent(".pack-replies").remove():t(this).parent(".pack-replies").removeClass("pack-replies").addClass("more-replies").find("span").html("还有"+(n-2)+"条评论"),e.insertShowBtn(),e.destroyScrollBar()}})},bindNoReplyEvent:function(){var e=this;this.replyBtn.on("click",function(){0==e.getAllCommentFlag?(t("<div class='feed-reply-container'><div class='feed-replies'></div></div>").appendTo(e.article),e.replyList=e.article.find(".feed-replies"),e.replyListContainer=e.article.find(".feed-reply-container"),e.replyUI=new jQuery.ui.Reply({replyData:e.replyInfo,defaultTextarea:!0,replyAdded:function(){e.insertComment()}},t("#"+e.feedId)),0==e.getAllCommentFlag&&(e.insertAllComment(!1),e.getAllCommentFlag=!0)):(e.getAllCommentFlag=!1,e.article.find(".pack-replies").remove(),e.article.find(".a-reply").remove(),e.article.find(".feed-reply-container").remove(),e.article.find(".own-reply").remove(),e.destroyScrollBar())})},insertComment:function(){(this.article.find(".a-reply").length>6||this.article.find(".more-replies").length>0)&&(0==this.getAllCommentFlag?(this.insertAllComment(!0),this.getAllCommentFlag=!0):(this.insertPackBtn(),this.destroyScrollBar(),this.addScrollBar(!0)))},destroyScrollBar:function(){this.replyListContainer.css({height:"auto",overflow:"hidden"}),this.replyListContainer.scrollbar({destroy:"destroy"}),this.replyListContainer.find(".ui-scrollbar-bar").css("height","auto")},insertAllComment:function(e){var n=this,a=this.buildParams();i.getAllComments(this.replyInfo.loadURI,a,this.sendMethod,function(i){var a="",s=0;if(void 0!=i.comments){for(var o=0;o<i.commentCount;o++)i.comments[o].isWhisper===!1&&(a+=n.replyUI.singleReplyHTML(i.comments[o],!0),s++);void 0!==nx.data.matter?s>=3?n.article.find(".more-replies").show().removeClass("more-replies").addClass("pack-replies clearfix").find("span").html("收起评论"):n.article.find(".more-replies").remove():s>=3&&n.article.find(".more-replies").show().removeClass("more-replies").addClass("pack-replies clearfix").find("span").html("收起评论"),n.replyList.find(".a-reply").remove(),t(a).appendTo(n.replyList)}else{for(var r=0;r<i.replyList.length;r++)a+=n.singleReplyHTML(i.replyList[r],"page");n.replyList.html(""),t(a).appendTo(n.replyList),n.article.find(".a-reply").length>5&&n.insertPackBtn()}n.addScrollBar(e)})},buildParams:function(){var e="";return"true"===this.replyInfo.cSection||"edm"===this.replyInfo.type?(e="type="+this.replyInfo.type+"&entryId="+this.replyInfo.cid+"&entryOwnerId="+this.replyInfo.oid,this.sendMethod="get"):void 0!=nx.data.matter&&"true"===nx.data.matter.isFriendComment&&502!=this.feedType&&505!=this.feedType&&107!=this.feedType?this.loadURI="http://comment.renren.com/comment/xoa2/friends":(e="doingId="+this.replyInfo.cid+"&owner="+this.replyInfo.oid+"&source="+this.replyInfo.cid+"&t="+this.replyInfo.typeNum,"zhan"==this.replyInfo.type?this.sendMethod="get":this.sendMethod="post"),e},addScrollBar:function(e){this.isPageOrZhan()===!0?this.replyList.height()>=400&&(this.replyListContainer.addClass("shadow-inset"),this.replyListContainer.css({height:"400px",overflow:"hidden"}),this.replyListContainer.scrollbar({minScrollbarLength:1,wheelSpeed:20,stopBubble:!0}),e&&(this.replyListContainer.scrollTop(this.replyList.height()-400),this.replyListContainer.scrollbar({update:"update"}))):this.replyListContainer.find(".a-reply").length>20&&(this.replyListContainer.addClass("shadow-inset"),this.replyListContainer.css({height:"400px",overflow:"hidden"}),this.replyListContainer.scrollbar({minScrollbarLength:1,wheelSpeed:20,stopBubble:!0}),e&&(this.replyListContainer.scrollTop(this.replyList.height()-400),this.replyListContainer.scrollbar({update:"update"})))},insertShowBtn:function(){this.article.find(".a-reply").length;this.article.find(".a-reply").not(".a-reply:eq(0)").not(".a-reply:last").remove()},insertPackBtn:function(){this.getAllCommentFlag=!0,this.article.find(".more-replies").length>0&&this.article.find(".more-replies").remove(),0==this.article.find(".pack-replies").length&&t(this.packAllReBtn).prependTo(this.article.find(".feed-replies"))},showAllBtn:function(e){var t="<div class='more-replies'><span>还有"+e+"条评论</span><i></i></div>";return t},isPageOrZhan:function(){return"0"==this.replyInfo.isUserFeed?!0:!1},initAvatar:function(){var e=this.article.find(".own-reply .avatar");e.attr({namecard:nx.user.id,href:"http://www.renren.com/profile.do?id="+nx.user.id,target:"_blank"}).children("img").attr("src",nx.user.tinyPic)},singleReplyHTML:function(e,t){var i="";e.replyerName&&(e.ubname=e.replyerName,e.ubid=e.replyerId,e.replyer_tinyurl=e.replyerHead),i=this.replyInfo.oid==nx.user.id?e.ubid==nx.user.id?'<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">删除</a>':'<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">删除</a><a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">回复</a>':e.ubid==nx.user.id?'<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">删除</a>':'<a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.id+'" data-uname="'+e.ubname+'" data-uid="'+e.ubid+'">回复</a>';var n;n=e.vocal_url?['<a href="javascript:;" data-vocal=\'{"voiceId":'+parseInt(e.id)+',"url": "'+e.vocal_url+'", "time":'+e.vocal_length+', "ownerId":'+e.ownerId+', "count":0}\' class="vocal-player  vocal-reply ">','<span class="count">0</span>','<span class="time">'+e.vocal_length+'"</span>','<span class="icon"></span>','<span class="bg-progress">','<span class="count">0</span>','<span class="time">'+e.vocal_length+'"</span>','<span class="icon"></span>',"</span>","</a>"].join(""):'<span class = "text">'+e.replyContent+"</span>";var a=['<div class = "a-reply clearfix">','	<a href="http://www.renren.com/'+e.ubid+'/profile" class = "avatar" target="_blank" namecard="'+e.ubid+'">','		<img src="'+e.replyer_tinyurl+'" class="user-avatar">',"	</a>",'	<div class = "reply-content">','		<p class="reply-info clearfix">','		<a href="http://www.renren.com/'+e.ubid+'/profile" class = "user-name" target="_blank" namecard="'+e.ubid+'">'+e.ubname+"</a>",'		<span class="reply-time">'+e.replyTime+"</span>",'		<span class="reply-tool clearfix">'+i,"		</span>","		</p>"+n,"	</div>","</div>"].join("");return a}},e.FeedReply=n}),define("ui/Reply",function(require,e){var t=require("jquery"),i=require("mustache.js"),n=require("newsfeed/tools");require("ui/renren/textbox"),require("ui/scrollbar"),require("ui/renren/replyOption");var a=['<div class="own-reply clearfix">','    <a class="avatar">','        <img src="'+nx.user.tinyPic+'">',"    </a>",'    <div class="own-reply-content">','        <div class="input-container">','            <div contenteditable="true" class="reply-input"></div>','            <div class="tool-bar clearfix">','                <a class="emotion" href="#nogo">表情</a>',"                <p>",'                    <span class="rest-count">0</span>',"                    /","                    <span>{{maxCount}}</span>",'                    <span class="tips-text">Ctrl+Enter发送</span>',"                </p>","            </div>","        </div>",'        <div class="reply-btns clearfix">','            <a href="#nogo" class="add-comment">发布评论</a>','            <a href="#nogo" class="cancel-comment">取消</a>',"        </div>","    </div>","</div>"].join(""),s={deleteComment:function(e,i,n,a){t.ajax({url:e,type:"post",dataType:"text",data:i,context:a,success:n})},addComment:function(e,i,n,a){t.ajax({url:e,type:"post",dataType:"json",data:i,success:function(e){0==e.code?n.call(a,e):require(["ui/dialog"],function(){t.dialog.error(e.msg)})}})}};t.widget("ui.Reply",{options:{replyData:null,defaultTextarea:!0,replyAdded:t.noop},_create:function(){this.replyListContainer=this.element.find(".feed-reply-container"),this.replyList=this.replyListContainer.find(".feed-replies"),this.replyData=this.options.replyData,this.feedId=this.element.attr("id"),this.feedType=parseInt(this.element.find(".user-avatar").attr("data-stype")),502==this.feedType||505==this.feedType?this.maxCount=240:this.maxCount=140,this.options.defaultTextarea&&this.createTextarea(),this.initTextarea(),this.hasShowAllRe=!1,this.enableFlag=!1,this.copyFlag=!1,this.replyToName="",this.replyToId="",this.replyId="",this.text="",this._events(),t.ui.Reply.instances+=1},_destroy:function(){t.ui.Reply.instances-=1,0===t.ui.Reply.instances&&t(document).off("."+this.widgetEventPrefix)},createTextarea:function(){t(i.render(a,{maxCount:this.maxCount})).insertAfter(this.replyListContainer)},initTextarea:function(){this.inputContainer=this.element.find(".input-container"),this.replyTextarea=this.element.find(".reply-input"),this.textCount=this.element.find(".rest-count"),this.toolBar=this.element.find(".tool-bar"),this.subBtn=this.element.find(".add-comment"),this.cancelBtn=this.element.find(".cancel-comment"),this.replyOptionBtn=this.element.find(".tips-text"),this.subBtn.addClass("disabled"),this.replyTextarea.html("评论...")},_events:function(){this._on(this.replyTextarea,{textboxchange:"checkTextCount",focus:function(){this.activeCommentArea()},keydown:function(e){(nx.data.reply.isEnterSend||e.ctrlKey||e.metaKey)&&13===e.keyCode&&(this.sendComment(),e.preventDefault())}}),this._on(this.subBtn,{click:"sendComment"}),this._on(this.cancelBtn,{click:"deactiveCommentArea"}),this._on(this.replyList,{"click .to-reply":function(e){e.preventDefault(),e.stopImmediatePropagation();var i=t(e.target);this.replyToName=i.attr("data-uname"),this.replyToId=i.attr("data-uid"),this.replyId=i.attr("data-rid"),this.activeCommentArea(this.replyToName,this.replyToId,this.replyId)},"click .delete":function(e){e.preventDefault(),e.stopImmediatePropagation();var i=t(e.target),n=i.attr("data-rid"),a=i.attr("data-uid"),o=(i.attr("data-uname"),this.buildDelParams(n,a));t.dialog.confirm("确定删除此评论吗？",function(){s.deleteComment(o.delURI,o.params,function(){var e=i.parents(".feed-reply-container"),t=i.parents(".feed-replies");i.parents(".a-reply").remove(),t.find(".pack-replies").length&&t.find(".a-reply").length<3&&t.find(".pack-replies").remove(),t.find(".more-replies").length&&t.find(".a-reply").length<=1&&t.find(".more-replies").find("span").click(),this.isPageOrZhan()===!0?t.height()>400?(e.scrollTop(t.height()-400),e.scrollbar({update:"update"})):(e.css("height","auto"),e.scrollbar({destroy:"destroy"})):t.find(".a-reply").length>20?(e.scrollTop(t.height()-400),e.scrollbar({update:"update"})):(e.css("height","auto"),e.scrollbar({destroy:"destroy"}))}.bind(this))}.bind(this))},click:function(e){var i=t(e.target),n=i.closest(".a-reply");0===i.closest("a",n).length&&n.find(".to-reply").trigger("click")},"mouseover .trigger-like-comment":function(e){var i=t(e.target);"已赞"===i.html()&&i.html("取消")},"mouseout .trigger-like-comment":function(e){var i=t(e.target);"取消"===i.html()&&i.html("已赞")},"mouseenter .a-reply":function(e){var i=t(e.target).closest(".a-reply");i.find(".trigger-like-comment").renrenlike({isComment:!0,elmComment:i,onadd:function(e,i){var n;e.element.addClass("liked"),e.element.text("已赞"),i.likeCount>0&&0===e.element.parents(".reply-info").find(".reply-like").length?(n=t("<a href='#nogo' class='reply-like'>"+i.likeCount+"</a>"),e.element.parents(".reply-info").find(".reply-time").length>0?n.insertAfter(e.element.parents(".reply-info").find(".reply-time")):n.insertAfter(e.element.parents(".reply-info").find(".time"))):(n=e.element.parents(".reply-info").find(".reply-like"),n.html(i.likeCount)),n.addClass("reply-liked")},onremove:function(e,t){t.likeCount>0?t.likeCount:"";e.element.removeClass("liked"),e.element.text("赞"),0===t.likeCount?e.element.parents(".reply-info").find(".reply-like").remove():e.element.parents(".reply-info").find(".reply-like").removeClass("reply-liked").html(t.likeCount)}.bind(this)})}}),0===t.ui.Reply.instances&&t(document).on("click."+this.widgetEventPrefix+" focus."+this.widgetEventPrefix,function(e){t(".input-container.active-textarea").each(function(i,n){if(n=t(n),0===n.find(e.target).length){var a=n.closest(".a-feed").Reply("instance");a.text||a.deactiveCommentArea()}})})},activeCommentArea:function(e,t,i){if(this.inputContainer.hasClass("active-textarea")||(this.inputContainer.addClass("active-textarea"),this.replyTextarea.apptextbox(),this.toolBar.children("a").remove().end().prepend(this.replyTextarea.apptextbox("getButtonPane")),this.toolBar.show(),this.subBtn.show(),this.cancelBtn.show(),nx.data.reply=nx.data.reply||{},this.replyOptionBtn.renrenreplyOption()),3===arguments.length&&(this.replyToName=e,this.replyToId=t,this.replyId=i),e){var n=this.replyTextarea.apptextbox("getContents");0==n.indexOf(this.replyUser)&&(n=n.replace(this.replyUser,"")),this.replyUser="回复"+this.replyToName+"：",this.replyTextarea.apptextbox("setContents",""),this.replyTextarea.apptextbox("insertAtCaret",this.replyUser+n)}this.checkTextCount()},deactiveCommentArea:function(){if(this.replyTextarea.data("app-textbox")&&this.replyTextarea.apptextbox("destroy"),this.replyTextarea.prop("contenteditable",!0),this.inputContainer.removeClass("active-textarea"),this.subBtn.hide(),this.cancelBtn.hide(),this.toolBar.hide(),this.textCount.html(0),this.replyTextarea.blur(),nx.browser.webkit){var e=t("#feed-reply-focus");0==e.length&&(e=t('<input id="feed-reply-focus" style="width:1px;height:1px;border:none;margin:0;padding:0;" tabIndex="-1">').appendTo(t(".nx-content"))),e[0].setSelectionRange(0,0),e.blur()}},checkTextCount:function(){this.text=this.replyTextarea.apptextbox("getRawContents");var e=this.text.length;this.textCount.html(e),e>this.maxCount?(this.subBtn.addClass("disabled"),this.enableFlag=!1,this.toolBar.find("p").addClass("error-c")):0==e?(this.subBtn.addClass("disabled"),this.enableFlag=!1,this.toolBar.find("p").removeClass("error-c")):(this.subBtn.removeClass("disabled"),this.enableFlag=!0,this.toolBar.find("p").removeClass("error-c"))},getComment:function(){var e=this.text;if(0===e.length)return void require(["ui/dialog"],function(){t.dialog.error("输入不能为空")});if(-1===e.indexOf("回复"+this.replyToName+"：")&&(this.replyToName="",this.replyToId="",this.replyId=""),this.enableFlag){var i={ownerId:nx.user.id,replyer_tinyurl:nx.user.tinyPic,ubname:nx.user.name,replyContent:encodeURIComponent(e),replyToId:this.replyToId,replyTime:(new Date).toLocaleString(),like:{liked:!1,count:0}};return this.deactiveCommentArea(),i}},sendComment:function(){var e=this.getComment();if(e){var i=this.buildParams(e);s.addComment(this.replyData.sendURI,i,function(i){var a;a="true"===this.replyData.cSection||"edm"===this.replyData.type?this.singleReplyHTML(i.comment,!0):this.singleReplyHTML(i,!1),t(a).appendTo(this.replyList),t(nx.data.feed).trigger("replyAdded",{stype:this.feedType,atlog:n.getAtlog(decodeURIComponent(e.replyContent)),feedId:this.feedId,replyTo:this.replyToId}),this.options.replyAdded()},this)}},buildParams:function(e){var t="";if("true"===this.replyData.cSection||"edm"===this.replyData.type)t="content="+e.replyContent+"&type="+this.replyData.type+"&entryId="+this.replyData.cid+"&entryOwnerId="+this.replyData.oid+"&stype="+this.replyData.stype+"&sourceId="+this.replyData.cid,709==this.feedType&&(t+="&isLinked=true");else{if("zhan"===this.replyData.type)return t="content="+e.replyContent+"&type=nf&toId="+e.replyToId;t="c="+e.replyContent+"&owner="+this.replyData.oid+"&source="+this.replyData.cid+"&t="+this.replyData.typeNum}return t+=""!==e.replyToId?"&rpLayer=1&replyTo="+e.replyToId+"&toCommentId="+this.replyId:"&rpLayer=0"},buildDelParams:function(e,t){var i={};return"true"===this.replyData.cSection||"edm"===this.replyData.type?(i.params="type="+this.replyData.type+"&entryId="+this.replyData.cid+"&entryOwnerId="+this.replyData.oid+"&stype="+this.replyData.stype+"&sourceId="+this.replyData.cid,i.delURI=this.replyData.delURI.replace("commentId",e)):("zhan"===this.replyData.type?i.delURI=this.replyData.delURI.replace("{{commentId}}",e):i.delURI=this.replyData.delURI,i.params="createId="+t+"&doingId="+this.replyData.cid+"&owner="+this.replyData.oid+"&replyId="+e+"&source="+this.replyData.cid+"&t="+this.replyData.typeNum),i},isPageOrZhan:function(){return"0"==this.replyData.isUserFeed?!0:!1},singleReplyHTML:function(e,t){var i="";t||(e.commentId=e.id,e.authorName=e.replyerName,e.authorId=e.replyerId,e.content=e.replyContent,e.authorHeadUrl=e.replyerHead,e.time=e.replyTime,e.vocal_url&&(e.authorId=e.ownerId)),i=this.replyData.oid==nx.user.id?e.authorId==nx.user.id?'<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">删除</a>':'<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">删除</a><a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">回复</a>':e.authorId==nx.user.id?'<a href="#nogo" class="delete" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">删除</a>':'<a href="#nogo" class="to-reply" data-fid="'+this.feedId+'" data-rid="'+e.commentId+'" data-uname="'+e.authorName+'" data-uid="'+e.authorId+'">回复</a>';var n;n=e.vocal_url?['<a href="javascript:;" data-vocal=\'{"voiceId":'+parseInt(e.id)+',"url": "'+e.vocal_url+'", "time":'+e.vocal_length+', "ownerId":'+e.authorId+', "count":0}\' class="vocal-player  vocal-reply ">','    <span class="count">0</span>','    <span class="time">'+e.vocal_length+'"</span>','    <span class="icon"></span>','    <span class="bg-progress">','        <span class="count">0</span>','        <span class="time">'+e.vocal_length+'"</span>','        <span class="icon"></span>',"    </span>","</a>"].join(""):'<span class = "text">'+e.content+"</span>";var a;if(this.replyData.type)switch(this.replyData.type){case"status":a="http://status.renren.com/getdoing.do?id="+this.replyData.oid+"&doingId="+this.replyData.cid;break;case"share":a="http://share.renren.com/share/"+this.replyData.oid+"/"+this.replyData.cid;break;case"blog":a="http://blog.renren.com/blog/"+this.replyData.oid+"/"+this.replyData.cid;break;case"photo":a="http://photo.renren.com/photo/"+this.replyData.oid+"/photo-"+this.replyData.cid;break;case"album":a="http://photo.renren.com/photo/"+this.replyData.oid+"/album-"+this.replyData.cid}var s="",o="";void 0!==e.like&&(e.like.liked?(s='<a href="#nogo" class="trigger-like-comment liked" data-like=\'{"stype":"'+this.replyData.type+'","sourceId":"'+e.commentId+'","resource":"'+this.replyData.cid+'","owner":"'+e.authorId+'","resourceownerid":"'+this.replyData.oid+'","url":"'+a+'","liked":'+e.like.liked+"}'>已赞</a>",o='<span class="reply-like reply-liked" >'+e.like.count+"</span>"):0==e.like.count?s='<a href="#nogo" class="trigger-like-comment" data-like=\'{"stype":"'+this.replyData.type+'","sourceId":"'+e.commentId+'","resource":"'+this.replyData.cid+'","owner":"'+e.authorId+'","resourceownerid":"'+this.replyData.oid+'","url":"'+a+'","liked":'+e.like.liked+"}'>赞</a>":(s='<a href="#nogo" class="trigger-like-comment" data-like=\'{"stype":"'+this.replyData.type+'","sourceId":"'+e.commentId+'","resource":"'+this.replyData.cid+'","owner":"'+e.authorId+'","resourceownerid":"'+this.replyData.oid+'","url":"'+a+'","liked":'+e.like.liked+"}'>赞</a>",o='<span class="reply-like" >'+e.like.count+"</span>"));var r=['<div class = "a-reply clearfix">','    <a href="http://www.renren.com/'+e.authorId+'/profile" class = "avatar" target="_blank" namecard="'+e.authorId+'">','        <img src="'+e.authorHeadUrl+'" class="user-avatar">',"    </a>",'    <div class = "reply-content">','        <p class="reply-info clearfix">','        <a href="http://www.renren.com/'+e.authorId+'/profile" class = "user-name" target="_blank" namecard="'+e.authorId+'">'+e.authorName+"</a>",'        <span class="reply-time">'+e.time+"</span>"+o,'        <span class="reply-tool clearfix">'+i+s,"        </span>","        </p>"+n,"    </div>","</div>"].join("");return r}}),t.ui.Reply.instances=0}),define("newsfeed/toolbar",function(require,e){require("ui/tooltip"),require("ui/feedSetting");var t=jQuery.noConflict(),i={setFocus:function(e,i,n,a){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action="+e,type:"post",data:"id="+i,dataType:"text",success:function(i){0===t.parseJSON(i).code?n.call(a):3===t.parseJSON(i).code?"addHigh"===e?t.dialog.success("该用户已经添加至特别关注名单中"):t.dialog.success("该用户已经添加至屏蔽名单中"):2===t.parseJSON(i).code?t.dialog.error("特别关注已经达到20个好友上限"):4===t.parseJSON(i).code&&t.dialog.error("请先加好友")}})},readNews:function(e,i,n){t.ajax({url:"http://www.renren.com/readNews.do",type:"post",dataType:"text",data:"t=s&i="+e,success:function(){i.call(n)}})},removeFeed:function(e,i,n,a){t.ajax({url:"http://www.renren.com/removefeed.do",type:"post",dataType:"text",data:"uid="+nx.user.id+"&feedid="+e+"&actor="+i,success:function(e){n.call(a)},error:function(e){throw new Error("删除失败！")}})}},n=function(e){this.feedList=t("#feed-list"),this.initialize(e)};n.prototype={initialize:function(e){this.initParam(e),this.bindEvent(e)},initParam:function(e){var i=this.article=t("#"+e);this.clsFeedBtn=i.find(".feed-hide"),this.clsFeedBtn.attr("title","标记为已读"),this.clsFeedBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(i.vertical).addClass(i.horizontal).appendTo(this)}}}),this.feedMenu=i.find(".feed-menu"),this.feedMenu.length>0&&(this.ownerId=i.find(".feed-user-name").attr("namecard")||i.find(".user-avatar").attr("data-id"),this.bindMenuEvent(e)),this.feedTool=i.find(".feed-tool"),this.feedTool.length>0&&this.bindToolEvent()},double_cols:function(){t(".double-cols-feed").length&&setTimeout(function(){for(var e,i=t("#feed-list").height(),n=t("#feed-list-right").height();i>n&&(e=t("#feed-list").children().last(),e.height()+20<i-n);)t("#feed-list-right").append(e),i=t("#feed-list").height(),n=t("#feed-list-right").height();for(;n>i&&(e=t("#feed-list-right").children().last(),e.height()+20<n-i);)t("#feed-list").append(e),i=t("#feed-list").height(),n=t("#feed-list-right").height()},100)},bindToolEvent:function(){var e=this;this.feedTool.on("mouseenter",function(){e.feedMenu.show()}),this.feedTool.on("mouseleave",function(){e.feedMenu.hide()})},bindMenuEvent:function(e){var n=this;this.feedMenu.on("mouseenter",function(){n.feedMenu.show()}),this.feedMenu.on("mouseleave",function(){n.feedMenu.hide()}),this.feedMenu.on("click",".feed-focus-user",function(){i.setFocus("addHigh",n.ownerId,function(){require(["ui/dialog"],function(){t.dialog.success("成功添加")})})}),this.feedMenu.on("click",".feed-block-user",function(){t.dialog.confirm("确定要屏蔽该用户的新鲜事么？",function(){i.setFocus("addLow",n.ownerId,function(){t.dialog.success("成功屏蔽")})},function(){})}),this.feedMenu.on("click",".feed-setting-item",function(){new jQuery.ui.feedSetting}),this.feedMenu.on("click",".hide-feed",function(){console.log(n.ownerId),i.removeFeed(e,n.ownerId,function(){n.article.remove(),n.double_cols()})})},bindEvent:function(e){var n=this;this.clsFeedBtn.click(function(){i.readNews(e,function(){n.article.hasClass("similar-feed")?n.article.prev().remove():n.article.next().hasClass("similar-feed-link")&&(n.article.next().remove(),n.article.next().removeClass("similar-feed").find(".header").removeClass("hidden")),n.article.remove(),n.double_cols(),t(document).trigger("scroll"),0==n.feedList.find(".a-feed").length&&t(".get-more-feed").addClass("border-top")})})}},e.ToolBar=n}),define("newsfeed/groupFeed",["jquery","backbone","exports"],function(e,t,i){var n={getAllFeedCount:function(t,i,n){e.ajax({url:"http://www.renren.com/leftmenu/getAllFeedCount",type:"post",data:"group="+t,dataType:"text",success:function(t){i.call(n,e.parseJSON(t))}})},clearCount:function(t,i,n){e.ajax({url:"http://www.renren.com/leftmenu/clearFeedCount",type:"post",data:"groupId="+t,dataType:"text",success:function(){i.call(n)}})},getSpecificGInfo:function(t,i,n){e.ajax({url:t,type:"get",dataType:"text",success:function(e){i.call(n,e)}})}},a=function(){this.feedList=e("#feed-list"),this.rightMenu=e(".nx-right"),this.bannerMoreGroupCon=e(".nx-main .nf-group-list-container"),this.bannerMoreGroup=e(".nx-main .nf-group-list"),this.bannerGroup=e(".nx-main .fd-nav-list"),this.gidList=this.bannerGroup.find("a[data-gid]"),this.moreBtn=this.bannerGroup.find(".fd-nav-showmore a"),this.navGName=this.bannerGroup.find(".fd-nav-gName"),this.navGNameLabel=this.bannerGroup.find(".fd-nav-gName-label"),this.router=new t.Router,this.router.route("newsfeed/group/:groupId",this.filterByGroup.bind(this)),this.initFeedCount(),this.initGroupMenu(),this.events()};a.prototype={events:function(){var t=this;this.navGName.on("click",function(e){t.bannerMoreGroup.find("a[data-gid="+this.getAttribute("data-gid")+"]").trigger("click")}),this.bannerGroup.on("click",".nf-group-list a",function(i){e(document).scrollTop(0),i.stopPropagation(),i.preventDefault(),t.bannerGroup.find(".fd-nav-cur-item").removeClass("fd-nav-cur-item");var a=this;t.bannerGroup.find(".fd-nav-showmore").addClass("fd-nav-cur-item");var s=e(this).attr("data-gid");n.getSpecificGInfo(e(this).attr("href"),function(i){t.navGName.css("display","inline-block"),t.navGNameLabel.hide(),t.initRightMenu(),t.initFeedList(s),e(i).prependTo(t.rightMenu),t.changeLocation(e(a)),t.cleanCount(s)}),e(".read-all-feed").remove(),t.router.navigate("newsfeed/group/"+s)})},filterByGroup:function(e){this.bannerGroup.find('a[data-gid="'+e+'"]').trigger("click")},initRightMenu:function(){e("#friends-filter").length>0&&e("#friends-filter").remove(),e("#recommendFriBox").show(),e(".ui-renren-publisher").show(),e("#mergeModule").hide(),e(".nx-right .photopast").hide(),e("#focus-filter").hide(),e("#follow_right").hide(),e("#footprintArea").hide(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#special-focus").remove()},initFeedList:function(t){this.feedList.children().not(".new-feed-tip").remove(),e(nx.data.feed).trigger("friendsNewsFeed",t)},initScrollBar:function(){},cleanCount:function(e){var t=this;n.clearCount(e,function(){t.bannerGroup.find("a[data-gid="+e+"]").children(".fd-nav-num").text("")})},initFeedCount:function(){for(var t=this,i=[],a=0;a<this.gidList.length;a++)i.push(e(this.gidList[a]).attr("data-gid"));n.getAllFeedCount(i.toString(),function(e){for(var i=0;i<e.length;i++)parseInt(e[i].count)>20?t.bannerGroup.find("a[data-gid="+e[i].groupId+"]").children(".fd-nav-num").text("20+"):parseInt(e[i].count)<=0?t.bannerGroup.find("a[data-gid="+e[i].groupId+"]").children(".fd-nav-num").text(""):t.bannerGroup.find("a[data-gid="+e[i].groupId+"]").children(".fd-nav-num").text(e[i].count)})},changeLocation:function(e){var t=e.children(".nf-item-gname").text();this.navGName.html(t),this.navGName.attr("data-gid",e.attr("data-gid")),this.bannerMoreGroup.find(".actived").removeClass("actived"),e.addClass("actived")},groupMoreList:function(e){var t=['<li class="nf-group-item">','	<a href="http://www.renren.com/home/getGroupDetail?groupId='+e.id+'" data-gid="'+e.id+'" class="clearfix duplicate">','		<span class="nf-item-gname">'+e.name+"</span>",'		<span class="feeds-count fd-nav-num">'+e.count+"</span>","	</a>","</li>"].join("");return t},navListItem:function(e){var t=['<a href="'+e.href+'" data-gid="'+e.id+'">'+e.name,'	<span class="fd-nav-num">'+e.count+"</span>","</a>"].join("");return t},initGroupMenu:function(){var e=this.bannerGroup.find(".fd-nav-item:eq(4) a"),t=e.attr("data-gid");this.bannerGroup.find("a[data-gid="+t+"]").length>1&&(this.bannerMoreGroup.find("li:eq(0) a").addClass("duplicate"),
this.bannerMoreGroup.find("a[data-gid="+t+"]").addClass("actived"))}},i.groupFeed=a}),define("newsfeed/feedFilter",["jquery","backbone","follow/feed/focusFilter","newsfeed/specialFocus","follow/feed/recommend","newsfeed/groupFeed","exports"],function(e,t,i,n,a,s,o){var r=/(?:newsfeed\/([a-z]+)){1}$/,d=["photo","video","status","blog","share"],l=function(){this.firstLoad=!0,this.nav=e("#frameFixedNav .fd-nav-list"),this.filterText=this.nav.find(".fd-nav-filter"),this.filterList=this.nav.find(".newsfeed-filter-list"),this.navSplitIcon=this.nav.find(".split-icon"),this.navFeedSort=this.nav.find(".sort-setting"),this.feedList=e("#feed-list"),this.bindEvents(),this.router=new t.Router,this.router.route("(newsfeed/:tag)",this.filterByTag.bind(this)),new s.groupFeed,t.history.start({pushState:!0,hashChange:!1,silent:!1,preventDefault:!0,root:window.location.pathname.slice(1).replace(/(?:^|\/)newsfeed\/.*$/,"")}),this.firstLoad=!1};l.prototype={bindEvents:function(){this.nav.on("click",".fd-nav-item>a",function(t){var i=e(t.target),n=(i.attr("href")||"").match(r)||("新鲜事"===i.html().trim()?["",""]:null);n&&(i=i.parent(),n=n[1],e(document).scrollTop(0),i.siblings(".fd-nav-cur-item").removeClass("fd-nav-cur-item"),i.addClass("fd-nav-cur-item"),i.find(".fd-nav-num").remove(),this["tag2"+n]?(this["tag2"+n](),this.router.navigate("newsfeed/"+n)):(this.tag2all(),n?this.router.navigate("newsfeed/"+n):this.router.navigate("")),t.preventDefault())}.bind(this));this.filterList.on("click","li",function(t){e(document).scrollTop(0);var i=e(t.target),n=i.attr("data-feed-type");i.hasClass("actived")||(i.siblings(".actived").removeClass("actived"),i.addClass("actived"),"0"===n?(this.filterText.text("新鲜事"),this.filterText.attr("href",nx.user.id),this.navSplitIcon.show(),this.navFeedSort.show()):(this.filterText.text(i.text()),this.filterText.attr("href",nx.user.id+"/newsfeed/"+i.attr("data-feed-type-label")),this.navSplitIcon.hide(),this.navFeedSort.hide()),this.filterText.attr("data-feed-type",n)),this.filterText.trigger("click")}.bind(this))},filterByTag:function(e){this.firstLoad?e&&(this["tag2"+e]?this["tag2"+e](!0):d.indexOf(e)>-1&&this.tag2all(!0)):e?d.indexOf(e)>-1?this.filterList.find('li[data-feed-type-label="'+e+'"]').trigger("click"):this.nav.find('.fd-nav-item a[href$="newsfeed/'+e+'"]').trigger("click"):this.filterList.find("li:first").trigger("click")},tag2all:function(t){var i=this.filterText.attr("data-feed-type")||"0";e(document).scrollTop(0),e(".ui-renren-publisher").show(),e(".double-cols-feed").length||e(".photopast").show(),e("#mergeModule").show(),e("#focus-filter").remove(),e("#follow_right").remove(),e("#friends-filter").remove(),e("#special-focus").remove(),e("#toolRefreshFeed").attr("data-isShow","true"),"0"===i?(this.navSplitIcon.show(),e("#frameFixedNav .feed-sort a").show()):(this.navSplitIcon.hide(),e("#frameFixedNav .feed-sort a").hide()),t?e(nx.data.feed).trigger("newsfeedFilter",[{type:i},!0]):(this.feedList.children().not(".new-feed-tip").remove(),e(".read-all-feed").remove(),e(nx.data.feed).trigger("newsfeedFilter",{type:i}))},tag2origin:function(t){e(".ui-renren-publisher").show(),e("#mergeModule").show(),e(".photopast").show(),e("#focus-filter").remove(),e("#special-focus").remove(),e("#follow_right").remove(),e("#friends-filter").remove(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#frameFixedNav .feed-sort a").hide(),this.nav.find(".nf-group-list-container .actived").removeClass("actived"),t?e(nx.data.feed).trigger("friendsOriginal",!0):(this.feedList.children().not(".new-feed-tip").remove(),e(".read-all-feed").remove(),e(nx.data.feed).trigger("friendsOriginal"))},tag2focus:function(t){e(".ui-renren-publisher").show(),e("#right-menu").hide(),e(".photopast").hide(),e("#friends-filter").remove(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#special-focus").remove(),e("#mergeModule").hide(),e("#follow_right").length>0&&e("#follow_right").remove(),this.nav.find(".fd-nav-gName-box").hide(),this.nav.find(".nf-group-list-container .actived").removeClass("actived"),new i.focusFilter,a.init(),e.renren.follow._delegated||(e.renren.follow._delegated=!0,e("body").delegate(".btn_follow","mouseover",function(){e(this).renrenfollow()})),t?e(nx.data.feed).trigger("contentFocus",[{type:"1"},!0]):(e(".read-all-feed").remove(),this.feedList.children().not(".new-feed-tip").remove(),e(nx.data.feed).trigger("contentFocus",{type:"1"}))},tag2specialfocus:function(t){e(".ui-renren-publisher").show(),e(".photopast").hide(),e("#mergeModule").hide(),e("#focus-filter").remove(),e("#follow_right").remove(),e("#friends-filter").remove(),e("#toolRefreshFeed").hide().attr("data-isShow","false"),e("#footprintArea .side-item").css("margin-top","0"),this.nav.find(".fd-nav-gName-box").hide(),this.nav.find(".nf-group-list-container .actived").removeClass("actived"),new n.SpecialFocus,t?e(nx.data.feed).trigger("groupFocus",!0):(this.feedList.children().not(".new-feed-tip").remove(),e(".read-all-feed").remove(),e(nx.data.feed).trigger("groupFocus"))}},o.FeedFilter=l}),define("ui/feedSetting",function(require,e){var t=jQuery.noConflict();require("ui/friendSearch");var i={getBanList:function(e,i){t.ajax({url:"http://www.renren.com/fetchRelationFeed.do",type:"get",dataType:"text",data:"action=ban",success:function(n){e.call(i,t.parseJSON(n))}})},relationAction:function(e,i,n,a){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action="+e,type:"post",dataType:"text",data:"id="+i,success:function(e){0==t.parseJSON(e).code&&n.call(a)}})}};t.widget("ui.feedSetting",{options:{},_create:function(){var e=this;this.banFriendData=[],this.banPageData=[],i.getBanList(function(i){for(var n="",a="",s=i.candidate,o=0;o<s.length;o++){var r=parseInt(s[o].id);r>1e3&&6e8>r||r>699999999&&780000001>r||r>799999999&&2147479033>r?n+=e.singleUserItem(s[o],"single-user"):a+=e.singleUserItem(s[o],"single-page")}t.ui.dialog({dialogClass:"feed-setting",width:569,buttons:[]}),t(".feed-setting .ui-widget-content").hide(),t(".feed-setting .ui-widget-header").hide(),t(".feed-setting .ui-widget-footer").hide(),""==n&&(n='<p class="none-item">无屏蔽的好友</p>'),""==a&&(a='<p class="none-item">无屏蔽的公共主页或小站</p>'),t(e.getSettingDialog(n,a)).appendTo(t(".feed-setting")),e.dialog=t(".feed-setting"),e.searchInput=e.dialog.find(".ui-friend-search"),e.friendContent=e.dialog.find(".friend-content"),e.friendTab=e.dialog.find(".friend-tab"),e.friendArea=e.friendContent.find(".select-area"),e.pageContent=e.dialog.find(".page-content"),e.pageTab=e.dialog.find(".page-tab"),e.dialogClsBtn=e.dialog.find(".cls-btn"),e.dialogCnclBtn=e.dialog.find(".cancel-btn"),e.searchInput.friendSearch({inputClass:e.searchInput,placeholder:"输入想屏蔽好友",showGroupName:!1,groupName:"",selectEvent:function(t,i,n){var a={id:t,name:i,head:n};e.addLow(a)}}),t("body").css("overflow","hidden"),e.reloPosition(),e._events()})},_init:function(){},_destroy:function(){},_events:function(){var e=this;this.friendTab.on("click",function(){t(this).hasClass("actived")||(t(this).addClass("actived"),e.pageTab.removeClass("actived"),e.pageContent.hide(),e.friendContent.show())}),this.pageTab.on("click",function(){t(this).hasClass("actived")||(t(this).addClass("actived"),e.friendTab.removeClass("actived"),e.friendContent.hide(),e.pageContent.show())}),this.dialogClsBtn.on("click",function(){e.dialog.remove(),t("body").css("overflow","auto")}),this.dialogCnclBtn.on("click",function(){e.dialog.remove(),t("body").css("overflow","auto")}),this.dialog.on("click",".ban-item",function(){e.delLow(t(this).attr("data-uid"),t(this))})},reloPosition:function(){t(".feed-setting").css({left:(t(window).width()-611)/2+"px",top:(t(window).height()-549)/2+t(document).scrollTop()+"px"})},addLow:function(e){var n=this;this.friendArea.find(".ban-item[data-uid="+e.id+"]").length>0?t.dialog.success("您所选择的的用户已经在屏蔽列表中了"):i.relationAction("addLow",e.id,function(){n.friendArea.children(".none-item").length>0&&t(".feed-setting .none-item").remove(),n.friendArea.find(".single-user").length>0?t(n.singleUserItem(e,"single-user")).insertBefore(n.friendArea.find(".single-user:eq(0)")):t(n.singleUserItem(e,"single-user")).appendTo(n.friendArea)})},delLow:function(e,n){var a=this;i.relationAction("delLow",e,function(){n.remove(),0==a.friendArea.find(".single-user").length&&t('<p class="none-item">无屏蔽的好友</p>').appendTo(a.friendArea)})},getSettingDialog:function(e,t){var i=['	<div class="header">',"		<h2>新鲜事设置</h2>",'		<a href="#nogo" class="cls-btn" title="关闭"></a>',"	</div>",'	<div class="content">','		<div class="content-tab clearfix">','			<a href="#nogo" class="friend-tab actived">已屏蔽的好友</a>','			<a href="#nogo" class="page-tab">已屏蔽的公共主页或小站</a>',"		</div>",'		<div class="friend-content">','			<input class="ui-friend-search" placeholder="输入想屏蔽好友">','			<div class="select-area clearfix">'+e,"			</div>","		</div>",'		<div class="page-content">',"			<p>以下是你已屏蔽的所有公共主页或者小站</p>",'			<div class="select-area clearfix">'+t,"			</div>","		</div>","	</div>",'	<div class="footer">','		<a href="#nogo" class="cancel-btn">关闭</a>',"	</div>"].join("");return i},singleUserItem:function(e,t){var i=['<a href="#nogo" class="ban-item '+t+' clearfix" data-uid="'+e.id+'">','	<img src="'+e.head+'">','	<div class="info">','		<p class="uname">'+e.name+"</p>",'		<p class="operation">解除屏蔽</p>',"		<i></i>","	</div>","</a>"].join("");return i}})}),define("newsfeed/feedOptions",function(require,e){var t=jQuery.noConflict(),i=function(e){this.feedIds=e,this.init()};i.prototype={init:function(){var e=this.getShareData(),t=this.getLikeData(),i=this.getUserData();this.initReplyStyel(),this.allData={share:{shareIds:e.ids,shareList:e.shareList,shareSourceStatusList:e.sourceStatusList,shareStatusList:e.statusList},like:{likeIds:t.ids,likeBtnList:t.likeBtnList},act361:{actNewlist:i.newlist,actIds:i.ids}},this.requestMarkData(this.allData)},getShareData:function(){for(var e={},i={},n=[],a={},s=[],o=0;o<this.feedIds.length;o++){var r,d,l=t("#"+this.feedIds[o]),c=l.find(".share"),h=parseInt(l.children(".header").children(".user-avatar").attr("data-stype"));c.length>0&&(601==h||602==h||701==h||709==h||102==h||103==h||104==h||107==h||110==h||708==h||1011==h||9801==h||9802==h||9803==h||9805==h||2904==h||2907==h||3730==h||3731==h||3732==h||3733==h||3735==h||3801==h||3802==h||3803==h||3804==h||602==h)&&(r=t.parseJSON(c.attr("data-share")),d=r.owner+"_"+r.id,(601==h||701==h||709==h||708==h||1011==h||9801==h||9802==h||9803==h)&&(d=this.packageShareUrl(h,r,c)),e[this.feedIds[o]]=d,i[this.feedIds[o]]=c),c.length>0&&(502==h||505==h)&&(r=this.packageStatusData(c),d=r.uid+"_"+r.did,a[d]=c,n.push(r)),c.length>0&&""!=c.children("i").html()&&c.addClass("has-num")}return e!={}&&s.push(JSON.stringify(e)),{ids:s,shareList:i,sourceStatusList:n,statusList:a}},getLikeData:function(){for(var e=[],i={},n=t("#feed-list").children(".a-feed"),a="",s=(n.length,0);s<this.feedIds.length;s++){var o=t("#"+this.feedIds[s]),r=o.find(".like"),d=parseInt(o.children(".header").children(".user-avatar").attr("data-stype"));if(d&&r&&(601==d||701==d||709==d||102==d||103==d||104==d||107==d||110==d||502==d||505==d||708==d||501==d||1011==d||9801==d||9802==d||9803==d||9805==d||2904==d||2907==d||1014==d||213==d||8001==d||8002==d||8003==d||8004==d||8016==d||8017==d||8018==d||8019==d||3730==d||3731==d||3732==d||3733==d||3735==d||3801==d||3802==d||3803==d||3804==d||602==d||4001==d||4002==d||4003==d||4004==d||4005==d)){var l=this.packageLikeData(r);a=l.type+"_"+l.sourceId,e.push(a),i[a]=r,r._num=!0}r.length>0&&""!=r.text().trim()&&r.addClass("has-num")}return{ids:e,likeBtnList:i}},getUserData:function(){for(var e=[],i=t("#feed-list").find(".user-avatar .avatar"),n={},a=0;a<this.feedIds.length;a++){i=t("#"+this.feedIds[a]).find(".user-avatar .avatar");var s=i.attr("namecard");void 0==n[s]?(e.push(s),n[s]=new Array,n[s].push(i)):n[s].push(i)}return{ids:e,newlist:n}},initReplyStyel:function(){for(var e=0;e<this.feedIds.length;e++){var i=t("#"+this.feedIds[e]),n=i.find(".reply");n.length>0&&""!=n.children("i").html()&&n.addClass("has-num")}},requestMarkData:function(e){var i=this;t.ajax({url:"http://www.renren.com/getFeedOptions",data:"activityList="+encodeURIComponent(e.act361.actIds.join(","))+"&likeList="+encodeURIComponent(e.like.likeIds.join("-"))+"&shareList="+encodeURIComponent(e.share.shareIds.join(","))+"&doingList="+encodeURIComponent(JSON.stringify(e.share.shareSourceStatusList)),type:"post",dataType:"text",success:function(n){try{var a=t.parseJSON(n);a.shareStatus&&i.addShareNum(e.share.shareList,a.shareStatus.value),a.likeStatus&&i.addlikeNum(e.like.likeBtnList,a.likeStatus.likeList),a.activityStatus&&void 0==nx.data.matter&&i.markUserFeed(e.act361.actNewlist,a.activityStatus),a.doingStatus&&i.addShareStatusNum(e.share.shareStatusList,a.doingStatus.value)}catch(s){console.log(s)}}})},packageShareUrl:function(e,t,i){var n;return n=601==e?"http://blog.renren.com/GetEntry.do?id="+t.id+"&owner="+t.owner:701==e||708==e?"http://photo.renren.com/photo/"+t.owner+"/photo-"+t.id:1011==e?"http://mvideo.renren.com/video/"+t.owner+"/"+t.id:9801==e||9802==e||9803==e||9805==e?"http://wiki.renren.com/movie/"+t.owner+"/comment/"+i.parents(".a-feed").find(".feed-content").attr("data-wikimid"):"http://photo.renren.com/photo/"+t.owner+"/album-"+t.id},packageStatusData:function(e){var i=t.parseJSON(e.attr("data-share")),n={};return n.uid=i.owner,n.did=i.id,n},packageLikeData:function(e){var i=t.parseJSON(e.attr("data-like")),n={};return n.sourceId=i.sourceId,n.type=i.stype,n},addShareNum:function(e,i){for(var n=0;n<i.length;n++){-1==i[n].num&&(i[n].num=0);var a=this.cutShareLikeNum(i[n].num);0!=a&&(t(e[i[n].fid]).children("i").html(a),t(e[i[n].fid]).addClass("has-num"),this.isNeedSharePopup(t(e[i[n].fid]),a))}},addShareStatusNum:function(e,i){for(var n=0;n<i.length;n++)if(e[i[n].gid]){e[i[n].gid]._num=i[n].num;var a=this.cutShareLikeNum(i[n].num);0!=a&&(t(e[i[n].gid]).children("i").html(a),t(e[i[n].gid]).addClass("has-num"),this.isNeedSharePopup(t(e[i[n].gid]),a))}},addlikeNum:function(e,i,n){var a,s;for(a=0;a<i.length;a++){var o=e[i[a].gid],r=i[a].likeCount,d=i[a].ownerLike;if(-1==i[a].gid.indexOf("comment")&&-1==i[a].gid.indexOf("wikicomment")?r>0&&(d?(t(o).addClass("liked"),t(o).html("<i></i>"+this.cutShareLikeNum(r))):(t(o).html("<i></i>"+this.cutShareLikeNum(r)),t(o).addClass("has-num")),this.isNeedLikePopup(o,r,d)):console.log(o),i[a].likeList.length>0){var l=t(o).parent(".appendix").children(".like-friend-list"),c=i[a].likeList,h="",p="";for(s=0;s<(c.length>4?4:c.length);s++)h+=this.likeAvatar(c[s]);for(s=0;s<c.length;s++)c[s].userId!=parseInt(nx.user.id)&&(s!=c.length-1?p+="<span class='like-name'>"+c[s].name+" </span>":s==c.length-1&&(p+="<span class='like-name'>"+c[s].name+"</span>"));1==i[a].ownerLike?""==p?l.html(h+this.likeTips("我",p,"","")):l.html(h+this.likeTips("我和",p+"等",i[a].likeCount,"人")):l.html(h+this.likeTips("",p+"等",i[a].likeCount,"人"))}}},markUserFeed:function(e,i){for(var n=i.length-1;n>=0;n--)if(0!=i[n].mid)for(var a=e[i[n].uid],s=a.length-1;s>=0;s--){var o=t(a[s]).parents(".a-feed");if(o.length>0){var r=o.find(".header .feed-user-info"),d=nx.data.feed.fedact,l=d["m"+i[n].mid];if(l){if(r.find(".similar-title").length>0)return;var c=t("<a class='add-mark2' title='"+l.alt+"' target='_blank' href='"+l.url+"'><img src='"+l.imgurl+"' alt='"+l.alt+"'></a>");c.appendTo(r)}}}},likeAvatar:function(e){var t=["<a>",'<img src="'+e.headUrl+'" title="'+e.name+'" data-uid="'+e.userId+'">',"</a>"].join("");return t},likeTips:function(e,t,i,n){var a=['<div class="list-like-tip">','   <i class="list-like-tip-arr"></i>'+e+t+'<span class="tip-counts">'+i+"</span>"+n+"赞过此内容","</div>"].join("");return a},isNeedLikePopup:function(e,t,i){var n=e.parents(".a-feed").find(".user-avatar").attr("data-stype");if("103"==n){var a=e.parents(".a-feed").find(".share-photo img");void 0!=a.attr("data-viewer")&&this.addLikePopupData([a],t,i)}else if("102"==n){var s=e.parents(".a-feed").find(".share-content .read-more"),o=e.parents(".a-feed").find(".share-content .share-blog-title");(void 0!=s.attr("data-viewer")||void 0!=o.attr("data-viewer"))&&this.addLikePopupData([s,o],t,i)}},isNeedSharePopup:function(e,t){var i=e.parents(".a-feed").find(".user-avatar").attr("data-stype");if("103"==i){var n=e.parents(".a-feed").find(".share-photo img");void 0!=n.attr("data-viewer")&&this.addSharePopupData([n],t)}else if("102"==i){var a=e.parents(".a-feed").find(".share-content .read-more"),s=e.parents(".a-feed").find(".share-content .share-blog-title");(void 0!=a.attr("data-viewer")||void 0!=s.attr("data-viewer"))&&this.addSharePopupData([a,s],t)}},addSharePopupData:function(e,i){var n=t.parseJSON(e[0].attr("data-viewer"));n.shareCount=i;for(var a=0;a<e.length;a++)e[a].attr("data-viewer",JSON.stringify(n))},addLikePopupData:function(e,i,n){var a=t.parseJSON(e[0].attr("data-viewer"));a.likeCount=i,a.isLike=n;for(var s=0;s<e.length;s++)e[s].attr("data-viewer",JSON.stringify(a))},cutShareLikeNum:function(e){var t=e;if(1e4>e);else{var i=Math.floor(e/1e4),n=Math.floor(e/1e3%10);t=1e5>e?0!=n?i+"."+n+"w":i+"w":parseInt(e)<1e7?i+"w":"999w"}return t}},e.FeedOptions=i}),define("newsfeed/tips",function(require,e){var t=jQuery.noConflict(),i=require("newsfeed/tools");require("ui/tooltip");var n={getSpecificFeed:function(e,i,n){t.ajax({url:"http://www.renren.com/requestfeedbyid.do",type:"post",data:"id="+e+"&view=10",dataType:"text",success:function(e){i.call(n,e)}})},getMissedFeedCount:function(e,i){t.ajax({url:"http://www.renren.com/feedmisscount.do?view=10",type:"get",dataType:"text",success:function(n){var a=t.parseJSON(n);"0"==a.code&&e.call(i,a.value)}})},readAllMissedFeed:function(e,i){t.ajax({url:"http://www.renren.com/feedmissreadall.do",type:"post",dataType:"text",success:function(t){e.call(i,t)}})},readAllFeed:function(e,i){t.ajax({url:"http://www.renren.com/readNews.do",type:"post",dataType:"text",data:"t=a",success:function(){e.call(i)}})}},a=function(){this.feedList=t("#feed-list"),this.feedTips=this.feedList.children(".new-feed-tip"),this.feedTipsBtn=this.feedTips.children("a"),this.feedTipsClsBtn=this.feedTips.find(".tips-close"),this.feedTipsCount=this.feedTipsBtn.children("span"),this.feedTips2=t("#toolRefreshFeed"),this.feedTipsBtn2=this.feedTips2.children(".refresh-back-to"),this.feedTipsCount2=this.feedTipsBtn2.find(".count-num"),this.continueBtn=t("#toolRefreshFeed .feed-continue-read"),this.continueFeedId="",this.continueBtnIsShown=!1,this.missedTipsFlag=!1,this.continueTips='<div id="feed-continue-tips" class="clearfix"><span class="tips-split"></span><span class="tips-text">上回阅读到这里</span><span class="tips-split"></span></div>',this.isNewLogin=!1,this.isMissedFeed=t("#needRequestMissFlag").val(),this.backTips='<div id="return-all-tips" class="clearfix"><span class="tips-split"></span><a href="javascript:;">返回全部新鲜事</a><span class="tips-split tips-split-right"></span></div>',this.backFooterTips='<div id="return-all-tips-footer" class="clearfix"><span class="tips-split"></span><a href="javascript:;">返回全部新鲜事</a><span class="tips-split tips-split-right"></span></div>',this.sideBarW=t(".nx-sidebar").width(),this.containW=t(".bd-container").width(),this.contentW=t(".bd-content").width(),this.nrWidth1=t("#toolBackTo").css("left"),this.feedTips2.css("left",this.nrWidth1),this.nav=t("#frameFixedNav"),this.checkBtn=this.nav.find(".fd-nav-filter"),this.filterList=this.nav.find(".newsfeed-filter-list"),this.initMissedFeed(),this.bindEvents()};a.prototype={bindEvents:function(){var e=this;t("body").delegate("#webpager","feed_status",function(i,a){if("false"!=e.feedTips2.attr("data-isshow")){var s=a.content;if(e.feedTips2.show(),"102"==s.feed_stype||"103"==s.feed_stype||"104"==s.feed_stype||"107"==s.feed_stype||"110"==s.feed_stype||"501"==s.feed_stype||"502"==s.feed_stype||"504"==s.feed_stype||"505"==s.feed_stype||"601"==s.feed_stype||"701"==s.feed_stype||"708"==s.feed_stype||"709"==s.feed_stype||"1101"==s.feed_stype||"1209"==s.feed_stype||"1011"==s.feed_stype){if(e.missedTipsFlag)return;if(s.feed_actor==nx.user.id){if("新鲜事"!=e.checkBtn.text())return;t(".newsfeed-empty").length>0&&t(".newsfeed-empty").remove(),n.getSpecificFeed(s.feed_id,function(e){t(nx.data.feed).trigger("feedRecieved",{data:e,insertType:"before"})})}else{var o=e.feedTipsBtn.attr("data-fid");t("#missed-feed-tips").length>0&&t("#missed-feed-tips").remove(),o?-1==o.indexOf(s.feed_id)&&(e.feedTipsBtn.attr("data-fid",o+","+s.feed_id),e.feedTipsBtn2.attr("data-fid",o+","+s.feed_id),e.feedTipsCount.html(parseInt(e.feedTipsCount.text())+1),e.feedTipsCount2.html(parseInt(e.feedTipsCount2.text())+1)):(e.feedTipsBtn.attr("data-fid",s.feed_id),e.feedTipsBtn2.attr("data-fid",s.feed_id),e.feedTipsBtn.css("display","block"),e.feedTipsClsBtn.css("display","block"),t(".get-more-feed").length>0&&0==e.feedList.find(".a-feed").length?t(".get-more-feed").addClass("border-top"):0==t(".get-more-feed").length&&0==e.feedList.find(".a-feed").length&&t(".new-feed-tip a").addClass("border-bottom"),t(".newsfeed-empty").length>0&&t(".newsfeed-empty").remove(),0!==t(document).scrollTop()&&(e.feedTips2.show(),0==e.continueBtnIsShown&&(e.feedTips.css("display","none"),e.feedTipsBtn2.css("display","block"))),e.feedTipsCount.html(parseInt(e.feedTipsCount.text())+1),e.feedTipsCount2.html(parseInt(e.feedTipsCount2.text())+1))}}}}),t(window).on("scroll",function(){t(".nx-right").height()-t(window).height()+265;t(document).scrollTop()>0&&"0"!==e.feedTipsCount2.html()?(e.feedTips2.show(),0==e.continueBtnIsShown&&(e.feedTipsBtn2.css("display","block"),e.feedTips.css("display","none"))):(e.feedTipsBtn2.hide(),e.feedTips.show()),t(document).scrollTop()>e.continueReadPos&&(t("#feed-continue-tips").remove(),e.hideContinueBtn())}),t(document).on("mainframe:reflow",function(i,n){var a=(t(".bd-container").width()-e.contentW)/2+e.contentW+t(".nx-sidebar").width()+20;void 0!==window.webpager&&void 0===window.webpager.getFold?"fold"===n?t(window).width()<1024?e.fixLoction70():e.fixLocationLeft(a):"unfold"===n&&(t(window).width()-(t(".nx-sidebar").width()+e.contentW+240)<180?e.fixLoction310():e.fixLocationLeft(a)):void 0!==window.webpager&&window.webpager.getFold()===!0&&void 0===n?t(window).width()<1024?e.fixLoction70():e.fixLocationLeft(a):void 0!==window.webpager&&window.webpager.getFold()===!1&&void 0===n?t(window).width()-(t(".nx-sidebar").width()+e.contentW+240)<180?e.fixLoction310():e.fixLocationLeft(a):void 0!==window.webpager&&window.webpager.getFold&&("fold"===n?t(window).width()<1024?e.fixLoction70():e.fixLocationLeft(a):"unfold"===n&&(t(window).width()-(t(".nx-sidebar").width()+e.contentW+240)<180?e.fixLoction310():e.fixLocationLeft(a)))}),this.feedTipsBtn.on("click",function(){e.isBackToAllFeed()||n.getSpecificFeed(t(this).attr("data-fid"),function(i){e.resetTips(),t(nx.data.feed).trigger("feedRecieved",{data:i,insertType:"before"})})}),e.feedTipsClsBtn.on("click",function(){e.resetTips()}),this.feedTipsBtn2.on("click",function(){e.isBackToAllFeed()||n.getSpecificFeed(t(this).attr("data-fid"),function(n){t("#feed-continue-tips").length>0&&t("#feed-continue-tips").remove(),void 0==i.fixDom("continue")?e.continueFeedId=e.feedList.find(".a-feed:last").attr("id"):e.continueFeedId=i.fixDom("continue").attr("id"),e.feedList.find(".a-feed:eq(0)").attr("id")!=e.continueFeedId&&(t(e.continueTips).insertBefore(t("#"+e.continueFeedId)),e.showContinueBtn()),t(document).scrollTop(0),e.resetTips(),t(nx.data.feed).trigger("feedRecieved",{data:n,insertType:"before"}),e.continueReadPos=t("#"+e.continueFeedId).position().top+35-41+1,t(".double-cols-feed").length>0&&t(e.continueTips).css("top",e.continueReadPos+"px")})}),this.continueBtn.on("click",function(){t(document).scrollTop(t("#"+e.continueFeedId).position().top+35-41),e.continueBtn.hide(),e.continueBtnIsShown=!1}),t(nx.data.feed).on("feedRecieved",function(){nx.data.feed.getMissedFeed&&(nx.data.feed.getMissedFeed=!1,e.initMissedFeed())}),t(".bd-content").on("click",".read-all-feed",function(){t.ui.dialog({dialogClass:"ui-dialog-confirm",width:550,buttons:[{text:"取消",click:function(){var e=t(this).dialog("instance");e._trigger("cancel"),e.destroy()}},{text:"确定","class":"ui-button-blue",click:function(e){var i=t(this).dialog("instance"),n=i._trigger("confirm");n&&i.destroy()}}],confirm:function(){n.readAllFeed(function(){t(".bd-content").find(".a-feed").remove(),t(".bd-content").find(".similar-feed-link").length&&t(".bd-content").find(".similar-feed-link").remove(),t(".read-all-feed").remove(),i.btnFactory(2)})}},"<div><h1>是否将全部新鲜事设置为已读</h1><h1>（会将原创内容、好友分组的新鲜事也一并设置为已读）</h1></div>")})},isBackToAllFeed:function(){return"新鲜事"!=this.checkBtn.text()?(this.filterList.find(".actived").removeClass("actived"),this.filterList.find("li:eq(0)").addClass("actived"),this.checkBtn.html("新鲜事").attr("data-feed-type","0"),this.nav.find(".split-icon").css("display","block"),this.nav.find(".sort-setting").css("display","block"),t(nx.data.feed).trigger("newsfeedFilter",{type:"0"}),t(document).scrollTop(0),this.resetTips(),!0):!1},feedTips2Left:function(){var e="",i=this,n=setInterval(function(){var a=t("#toolBackTo").css("right");a==e?(i.feedTips2.css({left:t(window).width()-parseInt(a)-i.feedTips2.width(),right:"auto"}),clearInterval(n)):e=a},20)},fixLoction70:function(){this.feedTips2Left()},fixLoction310:function(){this.feedTips2Left()},fixLocationLeft:function(e){this.feedTips2Left()},resetTips:function(){this.feedTipsBtn.css("display","none"),this.feedTipsClsBtn.css("display","none"),this.feedTipsBtn2.css("display","none"),this.feedTipsBtn.attr("data-fid",""),this.feedTipsBtn2.attr("data-fid",""),this.feedTipsCount.html(0),this.feedTipsCount2.html(0)},showContinueBtn:function(){var e=this;this.continueBtn.css("display","block"),this.continueBtnIsShown=!0,setTimeout(function(){e.hideContinueBtn()},3e4)},hideContinueBtn:function(){this.continueBtn.hide(),this.continueBtnIsShown=!1,t(document).scrollTop()>0&&"0"!==this.feedTipsCount2.html()&&this.feedTipsBtn2.show()},initMissedFeed:function(){var e=this;"1"==this.isMissedFeed&&n.getMissedFeedCount(function(i){if("0"!=i[0].feedcount&&!(t("#missed-feed-tips").length>0)){var n=e.missedFeedTmpl(i[0]);t(n).insertBefore(e.feedTips),e.missedTipsFlag=!0,e.initMissedParams()}})},missedFeedTmpl:function(e){var t="";t=this.isNewLogin?'<a href="#nogo" class="tips-text">好久没登录了？你错过了'+e.friendcount+"位好友的"+e.feedcount+"条精彩内容</a>":'<a href="#nogo" class="tips-text">没有更多新鲜事了，但你错过了'+e.friendcount+"位好友的"+e.feedcount+"条新鲜事</a>";var i=['<div id="missed-feed-tips">'+t,'	<a href="#nogo" title="今天不再出现" class="tips-close ui-icon ui-icon-close">关闭</a>',"</div>"].join("");return i},initMissedParams:function(){this.missedTipsCon=t("#missed-feed-tips"),this.missedTipsGetBtn=this.missedTipsCon.find(".tips-text"),this.missedTipsClsBtn=this.missedTipsCon.find(".tips-close"),this.missedTipsClsBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-6",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").addClass(i.vertical).addClass(i.horizontal).appendTo(this)}}}),this.bindMissedEvent()},bindMissedEvent:function(){var e=this;this.missedTipsClsBtn.on("click",function(){n.readAllMissedFeed(function(){e.missedTipsCon.remove()})}),this.missedTipsGetBtn.on("click",function(i){if(t(i.target).hasClass("tips-text")){if(t(nx.data.feed).trigger("getMissedFeedData"),t("#return-all-tips").length>0)return;e.missedTipsCon.hide(),t(".double-cols-feed").length>0?t(e.backTips).addClass("double-cols-miss-tips").insertBefore(".bd-publisher"):t(e.backTips).insertAfter(e.missedTipsCon),e.missedTipsCon.remove(),"新鲜事"!=e.checkBtn.text()&&(e.checkBtn.html("新鲜事").attr("data-feed-type","0"),e.filterList.find(".actived").removeClass("actived"),e.filterList.find("li:eq(0)").addClass("actived"))}}),t(".bd-content").on("click","#return-all-tips-footer a, #return-all-tips a",function(){t("#return-all-tips").remove(),t(document).scrollTop(0),e.missedTipsFlag=!1,t(nx.data.feed).trigger("newsfeedFilter",{type:0})})}},e.FeedTips=a}),define("newsfeed/specialFocus",function(require,e){var t=jQuery.noConflict(),i=require("mustache.js"),n={Templ:{successIcon:'<span class="add-success"><i></i>添加成功</span>',avatarList:['<div class="group-member">',"	<h2>",'		<span class="group-name">特别关注</span>(<span class="user-counts">{{candidate.length}}</span>)','		<a href="javascript:;" class="tool-box"></a>',"	</h2>",'	<div class = "member-list clearfix">',"	{{#candidate}}",'		<a href="http://www.renren.com/{{id}}/profile" namecard="{{id}}" title="{{name}}" target="_blank">','			<img src="{{head}}">',"		</a>","	{{/candidate}}","	</div>",'	<input class = "ui-friend-search" placeholder="输入好友姓名加入本组">',"</div>"].join(""),recommondList:['<div class="group-suggestor">',"	<h2>建议添加为特别关注</h2>",'		<ul class="suggestor-list">',"			{{#list}}",'				<li class="clearfix">','					<img src="{{tiny_url}}">','					<a href="http://www.renren.com/profile.do?id={{id}}" class="suggest-name">{{name}}</a>','					<a href="javascript:;" class="add-special" data-uid="{{id}}">添加</a>',"				</li>","			{{/list}}","		</ul>","</div>"].join(""),singleItem:['<a href="http://www.renren.com/{{id}}/profile" namecard="{{id}}" title="{{name}}" target="_blank">','	<img src="{{head}}">',"</a>"].join("")}};require("ui/friendSearch"),require("newsfeed/specialManage");var a={getFocusList:function(e,i){t.ajax({url:"http://www.renren.com/fetchRelationFeed.do?action=focus",type:"get",dataType:"json",success:function(t){e.call(i,t)}})},addIntoFocus:function(e,i,n){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action=addHigh",type:"post",data:"id="+e,dataType:"text",success:function(e){0===t.parseJSON(e).code?i.call(n,e):2===t.parseJSON(e).code?t.dialog.errorMsg("已达到20人数上限，去管理列表吧"):3===t.parseJSON(e).code?t.dialog.errorMsg("您已添加过该用户"):4===t.parseJSON(e).code&&t.dialog.errorMsg("请先加好友")}})}},s=function(){this.init()};s.prototype={init:function(){this.rightMenu=t(".nx-right"),this.insertRightMenu()},insertRightMenu:function(){t("#special-focus").length>0||(t("<div id='special-focus' class='side-item'></div>").insertBefore(t("#feed-list-right")),this.container=t("#special-focus"),this.getFocusAvatar(),this.events())},getFocusAvatar:function(){var e=this;a.getFocusList(function(a){var s=t(i.render(n.Templ.avatarList,a));s.appendTo(e.container),e.initAvatarItem(),e.searchInput.friendSearch({placeholder:"输入好友姓名添加特别关注",showGroupName:!0,selectEvent:function(t,i,n,a){var s={id:t,name:i,head:n};e.addFocus(s)}})})},initAvatarItem:function(){this.uList=this.container.find(".member-list"),this.listCount=this.container.find(".user-counts"),this.searchInput=this.container.find(".ui-friend-search"),this.toolBoxBtn=this.container.find(".tool-box")},events:function(){var e=this;this.container.on("click",".add-special",function(){var e=this,s=t(this).attr("data-uid");a.addIntoFocus(s,function(a){t(i.render(n.Templ.successIcon)).appendTo(t(e).parent("li")),t(e).remove()})}),this.container.on("click",".tool-box",function(){for(var a=e.uList.find("a"),s=[],o=0;o<a.length;o++)s.push({uId:t(a[o]).attr("namecard"),uName:t(a[o]).attr("title"),uTiny:t(a[o]).children("img").attr("src")});t.renren.specialManage({specialUList:s,submit:function(a){e.uList.html("");for(var s=0;s<a.length;s++)t(i.render(n.Templ.singleItem,a[s])).appendTo(e.uList);e.listCount.html(a.length)}})})},addFocus:function(e){var s=this;a.addIntoFocus(e.id,function(a){t(i.render(n.Templ.singleItem,e)).appendTo(s.uList),s.listCount.html(parseInt(s.listCount.html())+1)})}},e.SpecialFocus=s,t.widget("dialog.errorMsg",t.dialog.alert,{_create:function(){this.options.buttons=[],this.options.modal=!1,this._super(),this._delay("destroy",3e3)}})}),define("feed/xiaozu",function(require,e){function t(e,t){d[e]?t(d[e]):s.ajax({url:c,dataType:"json",method:"post",data:"voteId="+e,success:function(i){d[e]=i,t(i)}})}function i(e,t,i){setTimeout(function(){s(".progress-len",t.get(0)).css("width",180*e.percent/100+"px")},100);var n=s("input",t.get(0));return 0!==i&&(e.isChecked?n[0].checked=!0:n.removeAttr("checked")),
n[0].disabled=!0,'<div class="progress">			<div class="progress-len" style="width:0" ></div>			<div class="progress-data">'+e.ballot+"("+e.percent+"%)</div>		</div>"}function n(e,t,n){e.msg&&s.dialog.alert(e.msg),e.options&&s.each(e.options,function(e,a){var o=i(a,s(t[e]),n);s(t[e]).append(o)})}function a(e,t){s.ajax({url:l,dataType:"json",method:"post",data:e,success:function(e){t(e)}})}var s=require("jquery"),o=(jQuery,"nxContainer"),r=s("#"+o),d={},l="http://xiaozu.renren.com/xiaozu/uservote?from=newsfeed",c="http://xiaozu.renren.com/xiaozu/isUserHasVote?from=newsfeed";r.delegate(".group-vote-open-btn","click",function(){var e=s(this),i=e.attr("opened"),a=e.attr("voteid"),o=(e.attr("isvoted"),e.closest(".group-vote-items")),r=s(".group-vote-item",o[0]);1==i?(s(".group-vote-item:gt(3)",o[0]).hide(),e.attr("opened",0),e.html("展开全部选项")):(e.attr("reqed")||t(a,function(t){e.attr("reqed",1),t.options?(n(t,r),e.attr("isvoted",1)):(e.attr("isvoted",0),s(".group-vote-btn-con",o[0]).show())}),s(".group-vote-item",o[0]).show(),e.attr("opened",1),e.html("收起部分选项"))}),r.delegate(".group-vote-btn","click",function(e){var t=s(this),i=t.attr("voteid"),o=t.closest(".group-vote-items"),r=o.find("input:checked"),d=s(".group-vote-item",o[0]);if(!r.length)return void s.dialog.alert("请选择一个选项!");var l=[],c="";s.each(r,function(e,t){t.checked&&l.push(t.value)}),c="voteId="+i+"&optIds="+l.join("&optIds="),a(c,function(e){n(e,d,e.flag),t.hide()})})}),define(function(require){require("feed/xiaozu")}),define("feed/vipSend",function(require,e){function t(e){define(["vip/plugin/sendBirthGift"],function(t){t.initialize(e)})}function i(e){define(["vip/skin"],function(t){t.init(e)})}var n=require("jquery"),a=n("#nxContainer");a.delegate(".feed-send-gift-btn","click",function(){var e=n(this).attr("data-userId");n.ajax({url:"http://i.renren.com/api4v7/getV7BirthGiftJsSrc",type:"post",dataType:"json",success:function(i){define.config({map:{"vip/plugin/sendBirthGift":i[0]}}),t(e)}})}),a.delegate(".vip-feed-skin-btn","click",function(){var e=n(this).attr("data-tplV7Id");n.ajax({url:"http://i.renren.com/api4v7/getV7SkinJsSrc",type:"post",dataType:"json",success:function(t){define.config({map:{"vip/skin":t[0]}}),i(e)}})})}),define(function(require){require("feed/vipSend")}),define("feed/huatiImg",function(require,e){function t(e,t){var i=t.attr("feedid");e&&n.each(e,function(t,a){var s=n("#huati_vote_"+i+"_"+t),o='<span class="votenum ">'+Math.round(a)+"%</span>";s.removeClass("unvote"),e.hasVoteId==t?s.addClass("voteds"):s.addClass("votedus"),s.html(o)})}function i(e,t){n.ajax({url:o,dataType:"json",method:"post",data:e,success:function(e){t(e)}})}var n=require("jquery"),a="nxContainer",s=n("#"+a),o="http://huati.renren.com/vote";s.delegate(".voteicon","click",function(e){var a=n(this);if(a.hasClass("unvote")){var s=a.attr("voteid"),o=a.attr("optIds"),r=a.attr("topicTitle"),d=a.attr("topic_suffix"),l=a.attr("topic_id");query={voteId:s,options:o,type:"106",optionContent:"",topicTitle:r,suffix:d,topicId:l},i(query,function(e){t(e,a)})}})}),define(function(require){require("feed/huatiImg")}),define("newsfeed/specialManage",function(require,e){require("ui/scrollbar"),require("ui/placeholder");var t=jQuery.noConflict(),i=require("mustache.js"),n={Templ:{mamageContent:['	<div class="dialog-content-other">','		<div class="clearfix">','			<div class="group-list">','				<input class="search-friend">','				<div class="glist-container">',"					<ul>","					</ul>","				</div>","			</div>",'			<div class="show-list-container">','				<p class="select-all clearfix">',"					<a></a>","					全选","				</p>",'				<div class="detail-container">','					<div class="list-detail clearfix">',"					</div>","				</div>","			</div>","		</div>",'		<div class="select-tips clearfix">','			<span>已选特别关注成员<span class="count-msg">(<span class="selected"></span>/20)</span><span class="error-tips">最多选择20个好友</span></span>','			<a class="clear-data">清空</a>',"		</div>",'		<div class="actived-container">','			<div class="select-list-container clearfix">',"			</div>","		</div>","	</div>"].join(""),groupListItem:["<li>",'	<a class="a-group" data-map="{{mapCount}}">{{groupName}}</a>',"</li>"].join(""),singleUserItem:['<div class="a-friend {{selected}}" data-uid="{{userId}}">','	<img src="{{userTiny}}">',"	<p>{{userName}}</p>",'	<i class="active-icon"></i>',"</div>"].join(""),singleActivedItem:['<a data-uid="{{uId}}" class = "a-selected" data-utiny="{{uTiny}}">',"		<span>{{uName}}</span>","		<i></i>","	</a>"].join("")}},a={getAllData:function(e,i){var n=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:!0,init:!0,param:{}});t.ajax({url:"http://friend.renren.com/friendsSelector.do",type:"post",dataType:"text",data:"p="+n,success:function(n){e.call(i,t.parseJSON(n))}})},getSpecificData:function(e,i,n){var a=JSON.stringify({uid:!0,uhead:!0,uname:!0,group:e,init:"全部好友"===e,param:{}});t.ajax({url:"http://friend.renren.com/recommendSelector.do",type:"post",cache:!0,dataType:"text",data:"p="+a,success:function(e){i.call(n,t.parseJSON(e))},error:function(e){console.log("失败")}})},searchGroupData:function(e,i,n,a){var s;s="全部好友"===i?"all":"normal",t.ajax({url:"http://friend.renren.com/friends/api/searchgroupdata?t="+Math.random(),type:"post",dataType:"text",data:"p=[{'t':'people','data':'"+e+"'},{'t':'gid','data':'"+i+"'},{'t':'gtype','data':'"+s+"'}]",success:function(e){n.call(a,t.parseJSON(e))}})},setFocus:function(e,i,n,a){t.ajax({url:"http://www.renren.com/relationFeedOper.do?action="+e,type:"post",data:"id="+i,dataType:"text",success:function(e){}})}};t.widget("renren.specialManage",{options:{specialUList:[],submit:function(e){}},_create:function(){var e=this,a=t(i.render(n.Templ.mamageContent));this._dialog=t.ui.dialog({title:"特别关注成员管理",dialogClass:"special-management",show:!1,width:610,buttons:[{text:"取消",click:function(){var e=t(this).dialog("instance");e._trigger("cancel"),e.close()}},{text:"确认","class":"ui-button-blue",click:function(){var e=t(this).dialog("instance");e._trigger("confirm")}}],confirm:function(){e.addHight()},cancel:function(){e._destroy()},close:function(){e._destroy()}},a),this.dialog=t(".special-management"),this.initData(),this._events()},_init:function(){},_events:function(){var e=this;this.dialog.on("click",".a-group",function(){t(this).hasClass(".actived")||(e.groupList.find(".actived").removeClass("actived"),t(this).addClass("actived"),e.getSpecificGroup(t(this).html(),t(this).attr("data-map")))}),this.dialog.on("click",".a-friend",function(){t(this).toggleClass("selected");var a=t(this).children("p").html(),s=t(this).attr("data-uid"),o=t(this).children("img").attr("src");t(this).hasClass("selected")?(t(i.render(n.Templ.singleActivedItem,{uId:s,uName:a,uTiny:o})).appendTo(e.activedUList),e.activedCount++):(e.activedUList.find(".a-selected[data-uid="+s+"]").remove(),e.activedCount--),e.isSelectAll(),e.isMaxCount(),e.activedShower.html(e.activedCount)}),this.dialog.on("click",".a-selected i",function(){var i=t(this).parent(".a-selected").attr("data-uid");t(this).parent(".a-selected").remove(),e.showUList.find(".a-friend[data-uid="+i+"]").removeClass("selected"),e.activedCount--,e.isSelectAll(),e.isMaxCount(),e.activedShower.html(e.activedCount)}),this.dialog.on("keyup",".search-friend",function(){var i=t(this).val();e.searchFirends(i)}),this.dialog.on("click",".select-all a",function(){t(this).toggleClass("checked"),t(this).hasClass("checked")?e.checkAll():e.clearAll()}),this.dialog.on("click",".clear-data",function(){e.cleanUp(),e.isSelectAll(),e.isMaxCount()})},_destroy:function(){this.dialog.remove()},initData:function(){var e=this;this.feedList=t("#feed-list"),this.gListCont=this.dialog.find(".glist-container"),this.groupList=this.dialog.find(".group-list ul"),this.activedUListCont=this.dialog.find(".actived-container"),this.activedUList=this.dialog.find(".select-list-container"),this.showUListCont=this.dialog.find(".detail-container"),this.showUList=this.dialog.find(".show-list-container .list-detail"),this.searchInput=this.dialog.find(".search-friend"),this.activedShower=this.dialog.find(".select-tips .selected"),this.errorTips=this.dialog.find(".select-tips .error-tips"),this.msgCon=this.dialog.find(".select-tips .count-msg"),this.checkAllBtn=this.dialog.find(".select-all a"),this.canSubmit=!0,this.activedCount=this.options.specialUList.length,this.initActivedData(),this.searchInput.placeholder({text:"搜索好友"}),a.getAllData(function(t){e.renderGroupList(t)})},initActivedData:function(){this.activedShower.html(this.activedCount);for(var e=0;e<this.activedCount;e++)t(i.render(n.Templ.singleActivedItem,this.options.specialUList[e])).appendTo(this.activedUList)},renderGroupList:function(e){for(var t=e.groups,a="",s=0;s<t.length+1;s++)a+=0===s?i.render(n.Templ.groupListItem,{groupName:"全部好友",mapCount:s}):i.render(n.Templ.groupListItem,{groupName:t[s-1],mapCount:s});this.groupList.html(a),this.renderSpecificGroup(e,-1),this.activedGroupName="全部好友",this.addScollBar(this.groupList,this.gListCont,223)},getSpecificGroup:function(e,t){var i=this;a.getSpecificData(e,function(n){i.activedGroupName=e,i.renderSpecificGroup(n,t)})},renderSpecificGroup:function(e,a){var s,o=e.candidate,r="",d=[],l=this.activedUList.find("a");for(s=0;s<l.length;s++)d.push(t(l[s]).attr("data-uid"));for(s=0;s<o.length;s++)r+=-1!=t.inArray(o[s].id.toString(),d)?i.render(n.Templ.singleUserItem,{userTiny:o[s].head,userId:o[s].id,userName:o[s].name,selected:"selected"}):i.render(n.Templ.singleUserItem,{userTiny:o[s].head,userId:o[s].id,userName:o[s].name,selected:""});-1==a?this.groupList.find(".a-group:eq(0)").addClass("actived"):(this.groupList.find(".actived").removeClass("actived"),this.groupList.find("a[data-map="+a+"]").addClass("actived"),this.searchFirends(this.searchInput.val())),this.showUList.html(r),this.isSelectAll(),this.isMaxCount(),this.addScollBar(this.showUList,this.showUListCont,223),t(".a-friend img").lazyload()},searchFirends:function(e){var t=this;a.searchGroupData(e,t.activedGroupName,function(i){t.showUList.find(".a-friend").addClass("hidden");var n=i.data;if(n.length>0)for(var a=0;a<n.length;a++)t.showUList.find(".a-friend[data-uid="+n[a].fid+"]").removeClass("hidden");""===e.trim()&&t.showUList.find(".a-friend").removeClass("hidden"),t.isSelectAll(),t.isMaxCount(),t.addScollBar(t.showUList,t.showUListCont,223)})},checkAll:function(){var e=this.showUList.find(".a-friend").not(".hidden").not(".selected");e.addClass("selected");for(var a=0;a<e.length;a++)t(i.render(n.Templ.singleActivedItem,{uId:t(e[a]).attr("data-uid"),uName:t(e[a]).children("p").html(),uTiny:t(e[a]).children("img").attr("src")})).appendTo(this.activedUList),this.activedCount++;this.activedShower.html(this.activedCount),this.isMaxCount()},clearAll:function(){for(var e=this.showUList.find(".selected").not(".hidden"),i=0;i<e.length;i++)this.activedUList.find("a[data-uid="+t(e[i]).attr("data-uid")+"]").remove();this.showUList.find(".selected").removeClass("selected"),this.activedCount=this.activedUList.find("a").length,this.activedShower.html(this.activedCount),this.isMaxCount()},isSelectAll:function(){this.showUList.find(".selected").not(".hidden").length===this.showUList.find(".a-friend").not(".hidden").length&&0!==this.showUList.find(".selected").not(".hidden").length?this.checkAllBtn.addClass("checked"):this.checkAllBtn.removeClass("checked")},isMaxCount:function(){this.activedCount>20?(this.msgCon.addClass("error-msg"),this.errorTips.show(),this.canSubmit=!1):(this.msgCon.removeClass("error-msg"),this.errorTips.hide(),this.canSubmit=!0),this.addScollBar(this.activedUList,this.activedUListCont,67)},cleanUp:function(){this.showUList.find(".selected").removeClass("selected"),this.activedUList.html(""),this.searchInput.val(""),this.searchFirends(""),this.activedCount=0,this.activedShower.html(this.activedCount),this.isMaxCount()},addScollBar:function(e,i,n){e.height()>n?i.scrollbar({minScrollbarLength:1,wheelSpeed:20,stopBubble:!0,scroll:function(){t.fn.lazyload.update()}}):i.scrollbar({destroy:"destroy"})},addHight:function(){if(this.canSubmit){for(var e=this.activedUList.find(".a-selected"),i=[],n=0;n<this.options.specialUList.length;n++)a.setFocus("delHigh",this.options.specialUList[n].uId);for(var s=0;s<e.length;s++)a.setFocus("addHigh",t(e[s]).attr("data-uid")),i.push({id:t(e[s]).attr("data-uid"),name:t(e[s]).children("span").html(),head:t(e[s]).attr("data-utiny")});this.feedList.html(""),t(nx.data.feed).trigger("groupFocus"),this.options.submit(i),this._destroy()}else t.dialog.alert("已达到20人数上限")}})}),define("newsfeed/similarFeed",["exports","jquery","newsfeed/feed"],function(e,t){var i={getData:function(e,i,n){t.ajax({url:"http://www.renren.com/getavatars.do",type:"get",dataType:"text",data:"uids="+e,success:function(e){i.call(n,t.parseJSON(e))}})},getFeedById:function(e,i,n){t.ajax({url:"http://www.renren.com/requestfeedbyid.do",type:"post",data:"id="+e+"&view=10",dataType:"text",success:function(e){i.call(n,e)}})}},n=function(e){this.feedIds=e.otherIds,this.defaultId=e.defaultId,this.init()};n.prototype={init:function(){var e=this;i.getFeedById(this.feedIds,function(i){t(nx.data.feed).trigger("feedRecieved",{data:i,insertType:"similarAppend",type:"",selfFid:e.defaultId})})}};var a=function(e){this.feedList=t("#feed-list"),this.similarFeedId=e.feedId,this.article=t("#"+e.feedId),this.feedsData=e.moreData,this.header=this.article.find(".header"),this.defaultUser=this.header.find(".user-avatar"),this.defaultUid=this.defaultUser.find(".avatar").attr("namecard"),this.hasSwitched=0,this.activedIcon='<i class="similar-feed-icon show-icon"></i>',this.uids=new Array,this.defaultFid=new Array,this.init()};a.prototype={init:function(){this.header.addClass("over-hidden").find(".feed-tool").hide(),this.header.find(".feed-action-info").hide(),this.getIds(),this.getAvatars()},getAvatars:function(){var e=this;i.getData(this.uids.toString(),function(i){t(e.getUList(i)).appendTo(e.header),e.setParams(),e.events(),e.addActionBar(e.similarFeedId),e.similarFeedCon.hide(),e.similarFeedCon.fadeIn(200,function(){e.canSwitchTime>0&&e.similarFeedCon.find(".default-user img").show(),e.defaultUser.find("a:eq(0)").attr("href","javascript:;").removeAttr("target").addClass("avatar-first"),t(e.activedIcon).appendTo(e.defaultUser.find(".avatar")),e.defaultFid.length>0&&new n({otherIds:e.defaultFid.toString(),defaultId:e.similarFeedId})})})},getIds:function(){for(var e=0;e<this.feedsData.length;e++){var i=t.inArray(this.feedsData[e].actor,this.uids);this.feedsData[e].actor!=this.defaultUid&&-1==i&&this.uids.push(this.feedsData[e].actor)}},setParams:function(){this.similarFeedCon=this.article.find(".similar-ulist-container"),this.nextBtn=this.similarFeedCon.find(".next-cont"),this.preBtn=this.similarFeedCon.find(".pre-cont"),this.avatarList=this.similarFeedCon.find("ul"),this.canSwitchTime>0&&this.nextBtn.show();for(var e=0;e<this.feedsData.length;e++)if(this.feedsData[e].actor==this.defaultUid)this.defaultFid.push(this.feedsData[e].feed);else{var i=t.inArray(this.feedsData[e].actor,this.uids),n=this.avatarList.find("li").eq(i).find("a");void 0==n.attr("data-similar-fid")||""==n.attr("data-similar-fid")?n.attr("data-similar-fid",this.feedsData[e].feed):n.attr("data-similar-fid",n.attr("data-similar-fid")+","+this.feedsData[e].feed)}this.defaultUser.find(".avatar").attr("data-default-id",this.similarFeedId+","+this.defaultFid.toString())},events:function(){var e=this;this.nextBtn.click(function(){e.header.find(".similar-feed-icon").parent(".avatar").length>0&&e.header.find(".similar-feed-icon").hide(),e.hasSwitched<e.canSwitchTime&&(e.hasSwitched=e.hasSwitched+1,e.preBtn.show(),e.hasSwitched==e.canSwitchTime&&e.nextBtn.hide(),e.avatarList.animate({left:0-360*e.hasSwitched+"px"},1e3))}),this.preBtn.click(function(){0!=e.hasSwitched&&(e.hasSwitched=e.hasSwitched-1,e.nextBtn.show(),e.avatarList.animate({left:0-360*e.canSwitchTime+360*(e.canSwitchTime-e.hasSwitched)+"px"},1e3,function(){0==e.hasSwitched&&e.preBtn.hide(),e.header.find(".similar-feed-icon").parent(".avatar").length>0&&e.header.find(".similar-feed-icon").show()}))}),this.avatarList.on("click",".similar-list-avatar",function(){var i=e.header.find(".similar-feed-icon");e.toggleIcon(i,t(this).parent("li")),e.getSimilarData(t(this).attr("data-similar-fid"))}),this.defaultUser.on("click",".avatar-first",function(){var i=e.header.find(".similar-feed-icon");e.toggleIcon(i,t(this)),e.getSimilarData(t(this).attr("data-default-id"))})},getUList:function(e){this.uListLength=e.length,this.canSwitchTime=this.uListLength/6<=1?0:Math.ceil(this.uListLength/6)-1;for(var t="",i=0;i<this.uListLength;i++)t+='<li><a class="similar-list-avatar" href="javascript:;" namecard="'+e[i].uid+'"><img src="'+(""==e[i].avatar?"http://head.xiaonei.com/photos/0/0/men_tiny.gif":e[i].avatar)+'" width="50">'+this.getVipHats(e[i].hat_id)+"</a>"+this.getVipHatsLink(e[i].hat_id)+"</li>";t='<div class="user-list-container"><ul class="clearfix" style="width:'+60*(this.uListLength+1)+'px">'+t+"</ul></div>";var n=['<div class="similar-ulist-container clearfix">','	<span class="pre-cont"><a href="javascript:;" class="pre-p"></a></span>'+t,'	<span class="next-cont"><a href="javascript:;" class="next-p"></a></span>',"</div>"].join("");return n},toggleIcon:function(e,i){e.length>0&&e.remove(),t(this.activedIcon).appendTo(i)},getSimilarData:function(e){var t,a=this,s=e.split(",");s.length>1?(t=s[0],i.getFeedById(t,function(i){a.exchangeFeed(i);var s=e.substring(e.indexOf(","));new n({otherIds:s,defaultId:t})})):(t=e,i.getFeedById(t,function(e){a.exchangeFeed(e)}))},exchangeFeed:function(e){var i=this.article.attr("id");if(""==e)this.article.find(".feed-content").html('<p class="no-feed-tips">该条新鲜事已删除</p>'),this.article.find(".appendix").html("").hide(),this.article.find(".feed-reply-container").html("").hide(),this.article.find(".own-reply").html("").hide(),"none"==this.article.find("div:last").css("display")&&this.article.find("div:last").html("").hide(),this.setArticleAtr("","");else{var n=t(e),a=n.attr("id"),s=n.find(".user-avatar").attr("data-stype");this.article.find(".feed-content").replaceWith(n.find(".feed-content")).show(),this.article.find(".appendix").replaceWith(n.find(".appendix")).show(),this.article.find(".feed-reply-container").replaceWith(n.find(".feed-reply-container")).show(),this.article.find(".own-reply").replaceWith(n.find(".own-reply")).show(),"none"==this.article.find("div:last").css("display")&&"none"==n.find("div:last").css("display")&&this.article.find("div:last").replaceWith(n.find("div:last")).show(),this.setArticleAtr(a,s),this.addActionBar(a),t(nx.data.feed).trigger("feedRecieved",{data:this.article.get(0),insertType:"similarReplace"})}this.rmPrevFeeds(i),this.article.newsfeedfeed("destroy").newsfeedfeed()},rmPrevFeeds:function(e){""!=e&&t(".bd-content").find(".linkage-for-"+e).remove()},getVipHats:function(e){if("0"==e)return"";var t="<div style=\"display:block;width:58px;height:33px;position:absolute;top:-8px;left:0px;background:url('http://s.xnimg.cn/xnapp/vip/resimg/viphat/"+e+"/hat.png') no-repeat;_background:none;_filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(enabled=true, sizingMethod=noscale, src='http://s.xnimg.cn/xnapp/vip/resimg/viphat/"+e+'/hat.png\');" class="hats"></div>';return t},getVipHatsLink:function(e){if("0"==e)return"";var t='<a target="_blank" href="http://i.renren.com/store/hat/home" title="点击美化小头像" style="cursor:pointer;position:absolute;left:25px;top:-8px;display:block;width:33px;height:33px;text-indent:-9999em;outline:0 none;">点击美化小头像</a>';return t},addActionBar:function(e){if("1"==t.parseJSON(t("#get-params-for-"+e).html()).no_desc){var i=t(this.article.find(".header .feed-action-info p"));i.insertAfter(this.article.find(".header")).addClass("similar-feed-desc").html(i.text().substring(0,i.text().indexOf("-")))}else this.article.find(".similar-feed-desc").remove()},setArticleAtr:function(e,t){this.article.attr("id",e),this.article.find(".user-avatar").attr("data-stype",t)}},e.SameActorFeed=n,e.SimilarFeed=a}),define("newsfeed/feedSort",function(require,e){require("ui/tooltip");var t=jQuery.noConflict(),i=require("newsfeed/tools"),n=require("newsfeed/doubleCols"),a={setOrder:function(e,i,n){t.ajax({url:"http://www.renren.com/feed_setting/set_order",type:"post",data:"feed_order="+e,dataType:"text",success:function(){i.call(n)}})},setViewPort:function(e,i,n){t.ajax({url:"http://www.renren.com/feed_setting/setFeedShow",type:"post",data:"feedType="+e,dataType:"text",success:function(e){i.call(n)}})}},s=function(){var e=t("#frameFixedNav .feed-sort");this.sortBtn=e.find(".setting-btn"),this.sortList=e.find("ul"),this.splitIcon=t(".fd-nav-list .split-icon"),nx.user.isvip,nx.data.isDoubleFeed?(this.sortList.find(".double-cols").addClass("checked"),t(".app-upload-box-both").show()):(this.sortList.find(".single-col").addClass("checked"),t(".app-upload-box-odd").show()),getHotList(jQuery),this.initDialog(),this.events()};s.prototype={events:function(){var e=this;this.sortBtn.on("click",function(){e.sortList.show()}),this.sortList.on("click","li",function(s){return t(this).hasClass("checked")?(e.sortList.hide(),!1):(t(this).hasClass("by-smart")?a.setOrder("false",function(){t(nx.data.feed).trigger("sortBySmart"),t.dialog.systemTips("新鲜事已为智能排序")}):t(this).hasClass("by-time")?a.setOrder("true",function(){t(nx.data.feed).trigger("sortByTime"),t.dialog.systemTips("新鲜事已为时间排序")}):t(this).hasClass("single-col")?(t(".app-upload-box").hide(),t(".app-upload-box-odd").show(),getHotList(jQuery),a.setViewPort("off",function(){nx.data.isDoubleFeed=!1,n.changeCols(s,"single"),t.dialog.systemTips("已切换单栏浏览模式"),t(".none-feed").length?i.btnFactory(2):t(".a-feed").length&&i.btnFactory(1),t(".a-feed").length&&i.btnFactory(4)}),t("#mergeModule").before(t("#huatiBox")),t("#huatiBoxIn").remove()):t(this).hasClass("double-cols")&&(t(".app-upload-box").hide(),t(".app-upload-box-both").show(),getHotList(jQuery),a.setViewPort("on",function(){nx.data.isDoubleFeed=!0,n.changeCols(s,"double"),t.dialog.systemTips("已切换双栏浏览模式"),t(".none-feed").length?i.btnFactory(2):t(".a-feed").length&&setTimeout(function(){i.btnFactory(1)},500),t(".a-feed").length&&i.btnFactory(4),t(".bd-publisher").find("div").length?(t(".new-feed-tip").length&&!t(".new-feed-tip").hasClass("pubTip")&&t(".new-feed-tip").addClass("pubTip"),t("#missed-feed-tips").length&&!t("#missed-feed-tips").hasClass("pubTip")&&t("#missed-feed-tips").addClass("pubTip")):(t(".new-feed-tip").length&&t(".new-feed-tip").removeClass("pubTip"),t("#missed-feed-tips").length&&t("#missed-feed-tips").removeClass("pubTip"))}),t("#huatiBoxIn").remove()),void e.exchangeClass(t(this)))}),t(".fd-nav-list").on("click","a",function(){"新鲜事"!==t(this).html().trim()&&0==t(this).parents(".feed-sort").length&&0==t(this).hasClass("fd-nav-gName-label")&&0==t(this).hasClass("fd-nav-gName")&&(e.sortBtn.hide(),e.splitIcon.hide())}),t("body").on("click",function(i){0==t(i.target).parents(".sort-setting").length&&0==t(i.target).hasClass("setting-btn")&&e.sortList.hide()})},exchangeClass:function(e){e.hasClass("by-smart")||e.hasClass("by-time")?(this.sortList.find(".checked").not(".single-col").not(".double-cols").removeClass("checked"),e.addClass("checked"),this.sortList.hide()):(e.hasClass("single-col")||e.hasClass("double-cols"))&&(this.sortList.find(".checked").not(".by-smart").not(".by-time").removeClass("checked"),e.addClass("checked"),this.sortList.hide())},initDialog:function(){t.widget("dialog.systemTips",t.ui.dialog,{_createWidget:function(e){this.options.modal=!1,this._super({buttons:[],dialogClass:"newsfeed-dialog-systemTips ui-dialog",width:220,height:33,position:{my:"center",at:"top+110",of:window,collision:"fit",using:function(e){var i=t(this).css(e).offset().top;0>i&&t(this).css("top",e.top-i)}}},"<div><p>"+e+"</p></div>"),this._delay("destroy",2e3)}})}},e.FeedSort=s}),define("newsfeed/Recommend",function(require,e){var t=jQuery.noConflict(),i=require("newsfeed/tools"),n={getRecommendData:function(e,i,n,a,s){t.ajax({url:"http://rcd.renren.com/cwf_nget_newsfeed",type:"post",dataType:"text",data:"type=3G_SOCIALFEEDLOADER&limit="+e+"&p="+i+"&uid="+nx.user.id+"&idlist="+n.toString(),success:function(e){var i=t.parseJSON(e);a.call(s,i)}})}},a=function(e){this.feedArticle=t("#"+e),this.pNum=0,this.shownIdList=[],this.uListContainer=this.feedArticle.find(".action-4-pics"),this.showMoreBtn=this.feedArticle.find(".show-more-action"),this.initAvatar(),this.initIdList(),this.events()};a.prototype={initAvatar:function(){for(var e=this.feedArticle.find(".action-feed-content img"),t=0;t<e.length;t++)i.recommandResize(e[t])},initIdList:function(){for(var e=this.feedArticle.find(".action-4-pics a"),i=0;i<e.length;i++)this.shownIdList.push(t(e[i]).find("a").eq(0).attr("namecard"))},events:function(){var e=this;this.feedArticle.on("click",".show-more-action",function(){e.showMoreItem(t(this))})},showMoreItem:function(e){var a=this;2!==this.pNum&&(this.pNum=this.pNum+1,n.getRecommendData(8,this.pNum,this.shownIdList,function(e){if(e.code&&-1==e.code)a.changeMoreBtn();else{var n=e.explanations;if(n.length>0){for(var s=0;s<n.length;s++)t(a.actionModule(n[s])).appendTo(a.uListContainer),i.recommandResize(a.feedArticle.find(".action-4-pics a:eq("+(s+4)+") img").get(0));(2==a.pNum||n.length<8)&&a.changeMoreBtn()}else a.changeMoreBtn()}}))},changeMoreBtn:function(){this.showMoreBtn.attr("href","http://friend.renren.com/managefriends").attr("target","_blank").text("寻找更多可能认识的人")},actionModule:function(e){var t=['	<a href="http://www.renren.com/profile.do?id='+e.id+'" namecard="'+e.id+'" target="_blank">','		<img src="'+e.main_url+'">',"		<span>"+e.name+"</span>","	</a>"].join("");return t}},e.Recommend=a}),define("newsfeed/mvideo",["jquery","exports"],function(e,t){var i=function(e){this.feedId=e,require(["ui/renren/mvideo"],this.init.bind(this))};i.prototype.init=function(){var t=e("#"+this.feedId).find(".micro-video-content"),i=t.prop("href").match(/\d+/g),n=430;e(".double-cols-feed").length&&(n=410),t.renrenmvideo({width:n,height:n,screenshot:t.find("img").prop("src"),ownerId:i[0],videoId:i[1]}),e(document).on("newsfeed:single.newsfeed_mvideo",function(){t.renrenmvideo("option",{width:430,height:430})}),e(document).on("newsfeed:double.newsfeed_mvideo",function(){t.renrenmvideo("option",{width:410,height:410})}),this.ms=t},i.prototype.destroy=function(){this.ms&&e(document).off(".newsfeed_mvideo")},t.MVideo=i}),define("newsfeed/photo",function(require,e){var t=jQuery.noConflict(),i=require("newsfeed/tools"),n={getOriginalPhoto:function(e,i,n,a){t.ajax({url:"http://photo.renren.com/photo/"+e+"/album-"+i+"/photoFeed/v7",type:"get",dataType:"text",success:function(e){var i=t.parseJSON(e);0===i.code?n.call(a,i):t.dialog.alert(i.msg)}})},getSharePhotoData:function(e,i,n,a,s){t.ajax({url:"http://photo.renren.com/photo/"+e+"/album-"+i+"/sharePhotoFeed/v7?photoId="+n,type:"get",dataType:"text",success:function(e){var i=t.parseJSON(e);0===i.code?a.call(s,i):t.dialog.alert(i.msg)}})}},a=function(e){this.feedId=e,this.article=t("#"+e),this.showMoreBtn=this.article.find(".show-more-pic"),this.resizePhoto(),this.showMoreBtn.length>0&&this.events()};a.prototype={resizePhoto:function(){var e=this.article.find(".cursor-all img").not(".photo-content-1 img");i.imgRelocation(this.feedId,e)},events:function(){var e=this;this.showMoreBtn.click(function(){e.showMorePic()})},showMorePic:function(e){var i=this;if(this.article.find(".photo-content-more").length>0){var a=t.parseJSON(this.article.find(".appendix .like").attr("data-like")),s=a.sourceId,o=a.owner;n.getOriginalPhoto(o,s,function(e){var t=e.data,n=i.article.find(".photo-content-more");i.handlePic(t,n,6,"original")})}else if(this.article.find(".album-imgs-more").length>0){var r=i.showMoreBtn.attr("data-more"),d=i.showMoreBtn.attr("data-albumId"),l=i.showMoreBtn.attr("data-owner");n.getSharePhotoData(l,d,r,function(e){var t=e.data,n=i.showMoreBtn.parent(".album-imgs-more"),a=n.find(".cursor-all:eq(0)").attr("href");i.handlePic(t,n,0,"share",a)})}},handlePic:function(e,i,n,a,s){for(var o=e.length>12?12:e.length,r="",d="",l=n;o>l;l++)if(""!=e[l]){if(-1!=e[l].largeUrl.indexOf("gif")||-1!=e[l].largeUrl.indexOf("GIF"))d='<i class="icon">GIF图</i>',e[l].showUrl=e[l].showUrl+".jpg";else switch(e[l].isFullOrLong){case 0:d="";break;case 1:d='<i class="icon">全景图</i>';break;case 2:d='<i class="icon">长图</i>'}"original"==a?r+=7==l||10==l?"<a href='#nogo' class='cursor-all clearfix middle-p'><img src="+e[l].showUrl+' data-viewer = \'{"type":"photo","owner":"'+e[l].owner+'","id":"'+e[l].id+'","url":"'+e[l].largeUrl+'","width":'+e[l].width+',"height":'+e[l].height+"}'>"+d+"</a>":"<a href='#nogo' class='cursor-all clearfix'><img src="+e[l].showUrl+' data-viewer = \'{"type":"photo","owner":"'+e[l].owner+'","id":"'+e[l].id+'","url":"'+e[l].largeUrl+'","width":'+e[l].width+',"height":'+e[l].height+"}'>"+d+"</a>":"share"==a&&(r+=1==l||4==l?"<a href='"+s+"' target = '_blank' class='cursor-all clearfix middle-p'><img src="+e[l].showUrl+">"+d+"</a>":"<a href='"+s+"' target = '_blank' class='cursor-all clearfix'><img src="+e[l].showUrl+">"+d+"</a>")}this.showMoreBtn.hide(),t(r).appendTo(i),this.resizePhoto()}},e.multiPhoto=a}),define("newsfeed/voice",function(require,e){var t=jQuery.noConflict(),i=require("newsfeed/tools"),n=function(e,i){this.feedArticle=t("#"+e),this.feedStype=i,this.resizeVocalImg(),this.events()};n.prototype={events:function(){this.feedArticle.on("mouseover",".vocal-btn",function(){if(!this.playerInited){if(this.playerInited=!0,t(this).parents(".feed-content").length>0)var e=t(this).parents(".feed-content").find(".vocal-player");else var e=t(this).parents(".photo-feed-content").find(".vocal-player");var i=e.data("vocal");t.renren.vocalPlayer(i,e)}}),this.feedArticle.on("click",".vocal-btn",function(){if(t(this).hide(),t(this).parents(".feed-content").length>0)var e=t(this).parents(".feed-content").find(".vocal-player");else var e=t(this).parents(".photo-feed-content").find(".vocal-player");e.css("display","block"),e.trigger("click")})},resizeVocalImg:function(){var e,t=this.feedArticle.find(".feed-content").length>0?this.feedArticle.find(".feed-content .vocal-player"):this.feedArticle.find(".photo-feed-content .vocal-player"),n=this.feedArticle.find(".feed-content").length>0?this.feedArticle.find(".feed-content .vocal-player .count"):this.feedArticle.find(".photo-feed-content .vocal-player .count"),a=this.feedArticle.find(".vocal-btn");switch(this.feedStype){case"103":e=this.feedArticle.find(".share-photo img");break;case"701":e=this.feedArticle.find(".photo-feed-pic1");break;case"2004":e=this.feedArticle.find(".share-photo img")}i.vocalResize(e,t,n,a,this.feedStype)}},e.Voice=n}),define("newsfeed/logerFactory",function(require,e){var t=jQuery.noConflict();t.widget("newsfeed.logerFactory",{options:{logUrl:"",logData:"",logType:"",logSelector:"",limitTime:3e4,packageNum:30,cleanData:function(){},getData:function(){},cultCount:function(){console.log("XXX"),this.timeSendData()}},_create:function(){this.logUrl=this.options.logUrl,this.logSelector=this.options.logSelector,this.logType=this.options.logType,"time"===this.logType?(this.limitTime=this.options.limitTime,this.timer(),this.timeEvents()):"sendLog"===this.logType?this.timeSendData():(this.packageNum=this.options.packageNum,this.logCount=0,this.bindClickEvent())},_init:function(){},_destroy:function(){},timeEvents:function(){var e=this;t(window).on("unload",function(){e.timeSendData()})},timeSendData:function(){if(""!=this.options.getData()){var e=this.logUrl+"?"+this.options.getData();try{this.sendStats(e),this.options.cleanData()}catch(t){console.log("新鲜事log请求有问题")}}},timer:function(){setInterval(function(){if(""!=this.options.getData()){var e=this.logUrl+"?"+this.options.getData();try{this.sendStats(e),this.options.cleanData()}catch(t){console.log("新鲜事log请求有问题")}}},this.limitTime)},bindClickEvent:function(){var e=this;""!=this.logSelector&&t(document).on("click",this.logSelector,function(){
if(void 0!=this.packageNum){if(this.logCount=this.logCount+1,this.logCount==this.packageNum)if(""!=e.options.getData){var t=e.logUrl+"?"+e.options.getData();e.sendStats(t),e.cleanData()}else{var t=e.logUrl+"?"+e.logData;e.sendStats(t)}}else{var t=e.logUrl+"?"+e.logData;e.sendStats(t)}})},sendStats:function(e){var t="log_"+(new Date).getTime(),i=window[t]=new Image;i.onload=i.onerror=function(){window[t]=null},i.src=e,i=null}})}),define("newsfeed/log",function(require,e){var t=jQuery.noConflict(),i=require("newsfeed/tools"),n=function(){this.feedList=t("#feed-list"),this.nav=t("#frameFixedNav"),this.rightMenu=t(".nx-right"),this.initParams(),this.events(),this.timer()};n.prototype={initParams:function(){this.pvLog="",this.clickLog="",this.replyLog="",this.likeLog="",this.readLog="",this.shareLog="",this.blockLog="",this.actionLog="",this.atLog="",this.cultCount=0},recordPvLog:function(e,t){var i="",n="1";"similarFeed"==t&&(n="2");for(var a=0;a<e.length;a++){var s=this.getLogData(e[a]);i+=",0,"+s.exposeTime+","+nx.user.id+",,"+e[a]+","+s.feedOwnerId+","+s.feedStype+","+s.indexNum+","+s.createTime+","+s.platForm+","+nx.data.feed.pvTab+","+n+","+(new Date).getTime()+",0,,,"+s.privacyLog+",",s=null,a<e.length-1&&(i+="|")}this.pvLog=""==this.pvLog?i:this.pvLog+"|"+i,this.sendLog()},recordReplyLog:function(e,t){var i="",n="",a=this.getLogData(e);n=""==t?a.feedOwnerId:t,i=",2,"+(new Date).getTime()+","+a.exposeTime+","+nx.user.id+",,"+e+","+a.feedOwnerId+","+a.feedStype+","+a.indexNum+","+a.createTime+","+a.platForm+","+nx.data.feed.pvTab+",1,0,0,"+n+",",this.replyLog=""==this.replyLog?i:this.replyLog+"|"+i,this.checkCount()},recordShareLog:function(e){var t="",i=this.getLogData(e);t=",3,"+(new Date).getTime()+","+i.exposeTime+","+nx.user.id+",,"+e+","+i.feedOwnerId+","+i.feedStype+","+i.indexNum+","+i.createTime+","+i.platForm+","+nx.data.feed.pvTab+",1,0,0,,"+i.original_source+","+i.original_actor+",",this.shareLog=""==this.shareLog?t:this.shareLog+"|"+t,this.checkCount()},recordLikeLog:function(e,t,i){var n="",a=this.getLogData(e);n=","+t+","+(new Date).getTime()+","+a.exposeTime+","+nx.user.id+",,"+e+","+a.feedOwnerId+","+a.feedStype+","+a.indexNum+","+a.createTime+","+a.platForm+","+nx.data.feed.pvTab+",1,0,0,"+i+",",this.likeLog=""==this.likeLog?n:this.likeLog+"|"+n,this.checkCount()},recordReadLog:function(e){var t="",i=this.getLogData(e);t=",7,"+(new Date).getTime()+","+i.exposeTime+","+nx.user.id+",,"+e+","+i.feedOwnerId+","+i.feedStype+","+i.indexNum+","+i.createTime+","+i.platForm+","+nx.data.feed.pvTab+",1,0,0,",this.readLog=""==this.readLog?t:this.readLog+"|"+t,this.checkCount()},recordBlockLog:function(e,t){var i="",n=this.getLogData(e);i=","+t+","+(new Date).getTime()+","+n.exposeTime+","+nx.user.id+",,"+e+","+n.feedOwnerId+","+n.feedStype+","+n.indexNum+","+n.createTime+","+n.platForm+","+nx.data.feed.pvTab+",1,0,0,,user,"+n.feedOwnerId+",",this.blockLog=""==this.blockLog?i:this.blockLog+"|"+i,this.checkCount()},recordAtLog:function(e,t){var i="";i=","+(new Date).getTime()+","+nx.user.id+","+e+","+t+",0,",this.atLog=""==this.atLog?i:this.atLog+"|"+i,this.checkCount()},recordActionLog:function(e){var t="";t=","+(new Date).getTime()+","+nx.user.id+","+e+",,0,",this.actionLog=""==this.actionLog?t:this.actionLog+"|"+t,this.checkCount()},checkCount:function(){this.cultCount++,this.cultCount>=15&&this.sendLog()},events:function(){var e=this;t(nx.data.feed).on("feedRendered",function(t,i){var n=i.ids,a=i.type;e.recordPvLog(n,a)}),t(nx.data.feed).on("replyAdded",function(t,i){e.recordReplyLog(i.feedId,i.replyTo)}),this.feedList.on("click",".share",function(){var i=t(this).parents(".a-feed").attr("id");e.recordShareLog(i)}),this.feedList.on("click",".like, .trigger-like-comment",function(){var i="5",n="1";t(this).hasClass("liked")&&(i="6"),t(this).hasClass("trigger-like-comment")&&(n="2");var a=t(this).parents(".a-feed").attr("id");e.recordLikeLog(a,i,n)}),this.feedList.on("click",".feed-hide",function(){var i=t(this).parents(".a-feed").attr("id");e.recordReadLog(i)}),this.feedList.on("click",".feed-block-user",function(){var i=t(this).parents(".a-feed").attr("id");e.recordBlockLog(i,"8")}),this.feedList.on("click",".feed-focus-user",function(){var i=t(this).parents(".a-feed").attr("id");e.recordBlockLog(i,"9")}),t(nx.data.feed).on("replyAdded",function(t,i){var n=i.atlog,a=i.stype;e.recordAtLog(n,a)}),this.nav.on("click",".fd-nav-item:eq(0) a",function(){e.recordActionLog("11")}),this.nav.on("click",".friends-original",function(){e.recordActionLog("12")}),this.nav.on("click",".content-focus",function(){e.recordActionLog("13")}),this.nav.on("click",".group-focus",function(){e.recordActionLog("14")}),this.nav.on("click",".nf-group-item a",function(){e.recordActionLog("15")}),this.rightMenu.on("click",".sort-type",function(){"0"==t(this).attr("data-type")?e.recordActionLog("16"):"20"==t(this).attr("data-type")&&e.recordActionLog("17")}),this.rightMenu.on("click",".btn_follow",function(){e.recordActionLog("18")}),this.rightMenu.on("click",".tool-box",function(){e.recordActionLog("19")}),this.feedList.on("click",".reply",function(){e.recordActionLog("20")}),this.feedList.on("click",".pack-replies span, .pack-replies i, .more-replies span, .more-replies i",function(){if(1==t(this).parent().hasClass("pack-replies")){var i=t(this).parents(".a-feed").attr("id");t("#get-params-for-"+i).length>0&&"0"==t.parseJSON(t("#get-params-for-"+i).html()).isUserFeed&&e.recordActionLog("21")}}),this.feedList.on("click",".feed-setting-item",function(){e.recordActionLog("22")}),this.feedList.on("click",".new-feed-tip a",function(){e.recordActionLog("23")}),t(".refresh-back-to").on("click",function(){e.recordActionLog("24")}),this.feedList.on("click",".feed-action-info a",function(){e.recordActionLog("25")}),this.feedList.on("click",".user-avatar .avatar",function(){e.recordActionLog("26")}),this.feedList.on("click",".a-reply",function(){e.recordActionLog("27")}),t("#toolBackTo a").eq(0).on("click",function(){e.recordActionLog("28")}),this.feedList.on("click",".get-more-feed",function(){e.recordActionLog("29")}),this.feedList.on("click",".show-more-pic",function(){e.recordActionLog("30")})},getLogData:function(e){var n={},a=t("#"+e),s=a.find(".user-avatar"),o=s.find(".avatar").attr("href");n.exposeTime=i.queryByName("expose_time",o),n.feedOwnerId=i.queryByName("ff_id",o),n.feedStype=i.queryByName("sfet",o),n.indexNum=a.index(),n.createTime=s.attr("data-create-time"),n.platForm=i.queryByName("platform",o),n.privacyLog="",s.attr("original_source")&&(n.original_source=s.attr("original_source")),s.attr("original_actor")&&(n.original_actor=s.attr("original_actor"));var r=s.attr("data-sourcecontrol");return void 0==r?n.privacyLog="1":""==r||"99"==r?n.privacyLog="1":"0"==r?n.privacyLog="3":"-1"==r&&"2"==n.privacyLog,n},timer:function(){var e=this;setInterval(function(){if(""!=e.packageSendData())try{e.sendLog()}catch(t){console.log("新鲜事log请求有问题")}},3e4)},packageSendData:function(){if(""==this.pvLog&&""==this.clickLog&&""==this.replyLog&&""==this.likeLog&&""==this.readLog&&""==this.shareLog&&""==this.blockLog&&""==this.actionLog&&""==this.atLog)return"";var e="pv="+this.pvLog+"&click="+this.clickLog+"&reply="+this.replyLog+"&like="+this.likeLog+"&read="+this.readLog+"&share="+this.shareLog+"&block="+this.blockLog+"&action="+this.actionLog+"&at="+this.atLog;return e},sendLog:function(){var e=this,t="http://log.feed.renren.com/xfeed/log?"+this.packageSendData();this.sendStats(t),e.pvLog=e.clickLog=e.replyLog=e.likeLog=e.readLog=e.shareLog=e.blockLog=e.actionLog=e.atLog="",this.cultCount=0},sendStats:function(e){var t="log_"+(new Date).getTime(),i=window[t]=new Image;i.onload=i.onerror=function(){window[t]=null},i.src=e,i=null}},e.FeedLoger=n}),define("follow/feed/recommend",function(require,e){var t=require("jquery"),i=require("mustache.js");this.ajaxLoadNum=0;var n=function(e,t,i){var n=this;n.elem=e,n.amount=t,n.itemWidth=i,n.init=function(){n.total=n.elem.find("li").length,n.elem.find("ul").width(n.itemWidth*n.total),n.total<=n.amount&&n.elem.find(".pager-btn").remove(),n.events()},n.init()};n.prototype={events:function(){var e=this;e.elem.find(".pager-btn");e.elem.hover(function(){t(this).find(".pager-btn").css("display","inline-block")},function(){t(this).find(".pager-btn").css("display","none")}),e.elem.on("click",".pager-btn",function(){var i=t(this);return e.total=e.elem.find("li").length,e.start=parseInt(e.elem.data("start"))||0,i.hasClass("forward-disable")||i.hasClass("back-disable")?!1:(i.hasClass("pager-forward")?(e.start=e.start+e.amount,e.start>=e.total-e.amount&&i.addClass("forward-disable"),i.prev().hasClass("back-disable")&&i.prev().removeClass("back-disable")):i.hasClass("pager-back")&&(e.start=e.start-e.amount,0==e.start&&i.addClass("back-disable"),i.next().hasClass("forward-disable")&&i.next().removeClass("forward-disable")),void e.elem.data("start",e.start).find("ul").animate({left:-(e.itemWidth*e.start)+"px"},500))}),t(".userhead").on("mouseover",function(e){t(".double-cols-feed").length&&t(this).parent().find(".double-hover").show()}).on("mouseleave",function(e){t(".double-cols-feed").length&&t(this).parent().find(".double-hover").hide()})}},e.init=function(){t.ajax({url:"http://follow.renren.com/recommend/friends/v7",type:"GET",data:"uid="+nx.user.id,dataType:"json",success:function(t){0==t.code&&(e.ajaxLoadNum++,e.followNum=t.data.followInfo.publisherCount,e.userRender(t.data.followInfo),e.recommendRender(t.data.recommendInfo),e.getPageNum(),e.getZhanNum())}})},e.userRender=function(e){e.subscriberCount>0&&e.openFollow&&(e.subStatus=!0),e.publisherCount>0&&(e.pubStatus=!0),e.uid=nx.user.id;var a=['<div class="side-item follow-user-box">','	<div class="side-item-header follow-user-pub">',"		<h4>我关注的</h4>","	</div>",'	<div class="side-item-body user-follow-area clearfix">',"		{{#pubStatus}}",'		<a target="_blank" class="myfollow-person" href="http://follow.renren.com/list/{{uid}}/pub/v7">','			<img class="myfollow-icon" src="http://s.xnimg.cn/nx/newsfeed/res/myfollow-person.png"><span class="myfollow-num">{{publisherCount}}</span><span class="myfollow-text">关注的人</span>',"		</a>","		{{/pubStatus}}","		{{^pubStatus}}",'		<a target="_blank" class="myfollow-person" href="http://follow.renren.com/recommend/v7">','			<div class="default"><span class="myfollow-num">0</span><span class="myfollow-text">关注的人</span></div>','			<div class="hover">发现<br>更多红人</div>',"		</a>","		{{/pubStatus}}",'		<a target="_blank" class="page-pub" href="http://page.renren.com/">','			<div class="default"><span class="myfollow-num">0</span><span class="myfollow-text">公共主页</span></div>','			<div class="hover">发现更多<br>公共主页</div>',"		</a>",'		<a target="_blank" class="user-zhan" href="http://zhan.renren.com/suggest">','			<div class="default"><span class="myfollow-num">0</span><span class="myfollow-text">小站</span></div>','			<div class="hover">发现更多<br>推荐小站</div>',"		</a>","	</div>",'	<div id="fansBox">','		<div class="side-item-header side-item-fans">',"			{{#openFollow}}","			<h4>关注我的<span>{{subscriberCount}}</span></h4>",'			<div class="option">','				<a href="javascript:void(0);" class="pager-btn pager-back back-disable" title="上一页"></a>','				<a href="javascript:void(0);" class="pager-btn pager-forward" title="下一页"></a>','				<a href="http://follow.renren.com/list/{{uid}}/sub/v7" target="_blank" title="查看更多" class="more"></a>',"			</div>","			{{/openFollow}}","			{{^openFollow}}","			<h4>关注我的人<span>0</span></h4>",'			<a class="btn_green border btn_follow_open" href="http://follow.renren.com/promotion/v7" target="_blank">开启关注','				<div class="tip_open">',"					<p>开启专注后，你可以拥有自己的粉丝</p>","					<p>区分好友和粉丝，净化新鲜事！</p>","					<i></i>","				</div>	","			</a>","			{{/openFollow}}","		</div>","		{{#subStatus}}",'		<div class="fans-follow-area">','			<ul class="side-item-info clearfix">',"				{{#subscriberList}}","				<li>",'					<a class="headImg" namecard="{{id}}" href="http://www.renren.com/{{id}}/profile" target="_blank"><img onload="nx.image.resize(this,30,30,\'center\')" src="{{headUrl}}" /></a>',"				</li>","				{{/subscriberList}}","			</ul>","		</div>","		{{/subStatus}}","	</div>","</div>"].join("");t("#follow_right").append(i.to_html(a,e)),t(".double-cols-feed").length?new n(t("#fansBox"),11,38):new n(t("#fansBox"),6,36)},e.recommendRender=function(e){t.each(e.recommendList,function(e,t){t.isAuthed&&(t.subAuthInfo=nx.stringplus.TSubString(t.authDescription,16,"..."),nx.stringplus.Length(t.authDescription)!=nx.stringplus.Length(t.subAuthInfo)&&(t.authinfoHover=!0))});var a=['<div class="side-item">','	<div id="recommendBox">','		<div class="side-item-header clearfix">',"			<h4>关注推荐</h4>",'			<div class="option">','				<a href="javascript:void(0);" class="pager-btn pager-back back-disable" title="上一页"></a>','				<a href="javascript:void(0);" class="pager-btn pager-forward" title="下一页"></a>','				<a href="http://follow.renren.com/recommend/v7" target="_blank" title="更多推荐" class="more"></a>',"			</div>","		</div>",'		<div class="recommend_follow_area">','			<ul class="follow_list clearfix" data-from="0106003">',"				{{#list}}",'				<li class="item_recommend">','					<p class="userhead border" namecard="{{id}}">','						<a class="photo" target="_blank" href="http://www.renren.com/profile.do?id={{id}}">','							<img onload="nx.image.resize(this,100,100,\'center\')" src="{{icon}}" />',"						</a>",'						<a class="double-hover btn_follow follow0" data-uid="{{id}}"></a>','						<span class="username">{{#isAuthed}}<img src="http://a.xnimg.cn/nx/follow/cssimg/authed.png" />{{/isAuthed}}{{name}}</span>',"					</p>","					{{#isAuthed}}","						{{#authinfoHover}}",'						<p class="authinfo" title="{{authDescription}}">{{subAuthInfo}}</p>',"						{{/authinfoHover}}","						{{^authinfoHover}}",'						<p class="authinfo">{{subAuthInfo}}</p>',"						{{/authinfoHover}}","					{{/isAuthed}}","					{{^isAuthed}}",'					<p class="authinfo">{{univName}}</p>',"					{{/isAuthed}}",'					<p class="follow-nums">{{friendFollowCount}}位好友关注</p>','					<a href="javascript:void(0);" class="btn_gray btn_follow border follow0" data-uid="{{id}}"><span class="default">关注</span><span class="hover">关注</span></a>',"				</li>","				{{/list}}","			</ul>","		</div>","	</div>","</div>"].join("");t("#follow_right").append(i.to_html(a,{list:e.recommendList})),t(".double-cols-feed").length?(t(".recommend_follow_area").find("li").find(".userhead").attr("namecard","0"),new n(t("#recommendBox"),4,106)):new n(t("#recommendBox"),2,110)},e.getPageNum=function(){t.ajax({url:"http://page.renren.com/home/myAttentionPages/pagenum",type:"GET",dataType:"json",success:function(i){0===i.code&&(i.data.pagenum>0&&(t("#follow_right .follow-user-box").find(".page-pub").attr("href","http://page.renren.com/home/mypages").html('<img class="myfollow-icon" src="http://s.xnimg.cn/nx/newsfeed/res/myfollow-page.png"><span class="myfollow-num">'+i.data.pagenum+'</span><span class="myfollow-text">公共主页</span>'),e.pageNum=i.data.pagenum),e.ajaxLoadNum++,3==e.ajaxLoadNum&&e.isZero())}})},e.getZhanNum=function(){t.ajax({url:"http://zhan.renren.com/followingsites/count",type:"GET",dataType:"json",success:function(i){0==i.code&&(i.count>0&&t("#follow_right .follow-user-box").find(".user-zhan").attr("href","http://zhan.renren.com/followings").html('<img class="myfollow-icon" src="http://s.xnimg.cn/nx/newsfeed/res/myfollow-zhan.png"><span class="myfollow-num">'+i.count+'</span><span class="myfollow-text">小站</span>'),e.ajaxLoadNum++,e.zhanNum=i.count,3==e.ajaxLoadNum&&e.isZero())}})},e.isZero=function(){0==e.followNum&&0==e.pageNum&&0==e.zhanNum&&(t(".follow-user-box .follow-user-pub").html("<h4>我关注的<span>0</span></h4>"),t(".follow-user-box .user-follow-area").remove())}}),define("follow/feed/focusFilter",function(require,e){var t=jQuery.noConflict(),i=function(){this.feedList=t("#feed-list"),this.rightMenu=t(".nx-right"),this.init()};i.prototype={init:function(){var e=this.filterModule();t("#focus-filter").length>0&&(t("#focus-filter").remove(),t("#follow_right").remove()),this.rightMenu.find(".advert-box").length>0?t(e).insertAfter(t("#mergeModule")):t(e).appendTo(this.rightMenu),this.initParam()},initParam:function(){this.filterList=t("#focus-filter"),this.showBtn=this.filterList.find(".more-btn"),this.showMoreBtn="<i class='up'></i><i class='down'></i>",this.preventFlag=!0,this.bindEvents()},bindEvents:function(){var e=this;this.showBtn.on("click",function(){t(this).hasClass("hidden-btn")&&e.packFilterMenu()}),this.filterList.on("click",".sort-type",function(){var i=e.filterList.find(".actived");e.preventFlag?e.showFilterMenu():t(this).hasClass("actived")?e.packFilterMenu():(i.removeClass("actived"),t(this).addClass("actived"),e.packFilterMenu(t(this).attr("data-type")))})},packFilterMenu:function(e){var i=this,n=0;this.filterList.find("a").not(".actived").slideUp("fast",function(){n+=1,null!==e&&void 0!==e&&i.triggerFilter(n,e)}),this.filterList.find("a").not(".actived").addClass("hidden-item"),t(this.showMoreBtn).appendTo(this.filterList.find(".actived")),this.preventFlag=!0},showFilterMenu:function(){this.filterList.find(".hidden-item").slideDown("fast"),this.filterList.find(".hidden-item").removeClass("hidden-item"),this.filterList.find(".actived i").remove(),this.preventFlag=!1},triggerFilter:function(e,i){3===e&&t(nx.data.feed).trigger("contentFocus",{type:i})},filterModule:function(){var e=['<div id="focus-filter" class="side-item">',"	<ul>","		<li>",'			<a href="javascript:;" class="sort-type actived" data-type="1">','				关注内容<i class="up"></i><i class="down"></i>',"			</a>","		</li>","		<li>",'			<a href="javascript:;" class="sort-type hidden-item" style="display:none;" data-type="0">',"				人的新鲜事","			</a>","		</li>","		<li>",'			<a href="javascript:;" class="sort-type hidden-item" style="display:none;" data-type="20">',"				公共主页的新鲜事","			</a>","		</li>","		<li>",'			<a href="javascript:;" class="more-btn hidden-btn hidden-item" style="display:none;">',"				<i></i>","			</a>","		</li>","	</ul>","</div>",'<div id="follow_right"></div>'].join("");return e}},e.focusFilter=i}),require(["jquery"],function(e){e(function(){define(function(require,t){require("app/publisher");var i,n,a=e(".bd-publisher"),s=e(".bd-content"),o=e(".nx-content",s),r=e(".nx-right",s),d=e("<div>").prependTo(o),l=nx.browser.name.toLowerCase().match("ie");d.apppublisher({ready:function(){i=d.find(".ui-renren-publisher-avatar"),n=d.find(".triangle")},open:function(){d.find(".textarea-textzone").apptextbox("disable"),a.append(d),i.hide(),n.hide(),r.css({position:"absolute",top:0,right:0}),d.find(".textarea-textzone").velocity({height:d.hasClass("ui-renren-publisher-appstart")?67:127},200,function(){d.css({zIndex:99}).velocity({left:(s.width()-587)/2+70},{easing:nx.browser.msie?"linear":"easeOutBounce",duration:300,complete:function(){i.velocity({opacity:[1,0]},{display:"block",duration:800}),n.velocity({opacity:[1,0]},{display:"block",duration:800}),d.find(".textarea-textzone").apptextbox("enable").apptextbox("focus")}}),r.velocity({top:d.height()+35},{duration:500,complete:function(){r.data("top",r.css("top")),r.css({position:"relative",top:0})}})}),e(".double-cols-feed").length&&(e(".new-feed-tip").length&&!e(".new-feed-tip").hasClass("pubTip")&&e(".new-feed-tip").addClass("pubTip"),e("#missed-feed-tips").length&&!e("#missed-feed-tips").hasClass("pubTip")&&e("#missed-feed-tips").addClass("pubTip"))},close:function(){d.find(".textarea-textzone").velocity({height:45},200,function(){i.hide(),n.hide(),o.prepend(d),d.velocity({left:0},{duration:300,complete:function(){l?d.css({zIndex:"0"}):d.css({zIndex:"auto"})}}),r.css({position:"absolute",top:r.data("top")}).velocity({top:0},{duration:500,complete:function(){l?r.css({position:"relative",top:"0"}):r.css({position:"static"})}})}),e(".double-cols-feed").length&&(e(".new-feed-tip").length&&e(".new-feed-tip").removeClass("pubTip"),e("#missed-feed-tips").length&&e("#missed-feed-tips").removeClass("pubTip"))}})}),define(function(require,e){require("ui/renren/footprint"),jQuery.renren.footprint()}),require(["ui/renren/recommendFri"],function(){e("#recommendArea").addClass("recommend2").renrenrecommendfri({isDoubleFeed:e(".double-cols-feed").length>0}),e(document).on("newsfeed:single newsfeed:double",function(t){e("#recommendArea").renrenrecommendfri({isDoubleFeed:t.type.indexOf("double")>-1})})}),define(function(require,e){var t=require("photo/past");t.init()}),define(function(require,e){var t=require("newsfeed/index");new t.feedIndex}),e("#feed-list img[data-src]").lazyload({instantly:!0})})}),define("ui/showPrivacyFoot",function(require,e){require("ui/dialog"),require("ui/friendSearch");var t=require("mustache.js"),i=!1,n=jQuery.noConflict(),a=2,s={init:function(e){this.successShowDialog(e)},successShowDialog:function(e){var t=this;n.ui.dialog({dialogClass:"privacy-foot",title:"隐身名单",width:505,height:430,buttons:[{text:"取消",click:function(){var e=this;i?n.dialog.confirm("您确认不保存之前的操作，关闭此弹层吗？",function(t){n(e).dialog("destroy")}):n(e).dialog("destroy")}},{text:"确定","class":"ui-button-blue",click:function(){t.save(),n(this).dialog("destroy")}}]}),n.ajax({url:"http://www.renren.com/hiddenfootprint/",type:"get",dataType:"json",abortOnRetry:!0,success:function(e){var i=n.parseJSON(e.hiddenFootprint);t.getNum(i)}})},getNum:function(e){var t=this;n.ajax({url:"http://www.renren.com/hiddenfootprintmanager/generalHiddenFpAssembly",type:"get",dataType:"json",abortOnRetry:!0,success:function(i){var a=i,s=a.HIDDEN_FOOTPRINT_TOALL;t.packlist(e,a),s&&n(".privacy-foot .ui-widget-content #friendselectarea").hide(),t.bindEvents()}})},packlist:function(e,i){var a=i,s={};s.vipMember=a.vipMember,s.hidetotal=a.HIDDEN_FOOTPRINT_TOALL,s.leftnum=a.MAX_FRIENDS-e.length;for(var o=['<p style="margin-bottom:20px" >','<label for="hiddentype1">','<input type="radio" value="1"',"{{^vipMember}}","disabled=true","{{/vipMember}}","{{#hidetotal}}",'checked="checked"',"{{/hidetotal}}",'name="hiddentype" id="hiddentype1"/>',"<span ","{{^vipMember}}",'style="color:#888;"',"{{/vipMember}}",">设置对全部好友不留脚印</span>","</label>","{{^vipMember}}",'<a href="http://i.renren.com/pay/pre" target="_blank">开通VIP会员即可对所有的好友设置隐身</a>',"{{/vipMember}}","</p>",'<p style="margin-bottom:10px">','<label for="hiddentype2">','<input type="radio" value="2" ',"{{^vipMember}}","checked=true","{{/vipMember}}","{{^hidetotal}}",'checked="checked"',"{{/hidetotal}}",'name="hiddentype" id="hiddentype2" />','<span id="usingTip">还可以选择<span id ="footnum">{{leftnum}}</span>个好友，当访问他们时不留脚印</span>',"</label>","</p>"].join(""),r=t.render(o,s),d="",l=e.length-1;l>=0;l--){var c='<a href="#nogo" class="oneperson" id="'+e[l].id+'"><img src="'+e[l].tinyUrl+'"><div class="right"><p class="name">'+e[l].name+'</p><p  class="x-to-hide"  >删除</p></div></a>';d=c+d}d='<div id="friendselectarea"><input class= "ui-friend-search"><div class="user-list" id="hiddenPeopleList" >'+d+"</div></div>",n(".privacy-foot .ui-widget-content").html(r+d)},bindEvents:function(){var e=this,t=n(".privacy-foot .ui-widget-content").find(".ui-friend-search");t.friendSearch({placeholder:"输入想隐身查看的好友",showGroupName:!1,groupName:"",selectEvent:function(t,i,n){var a={id:t,name:i,head:n};e.addNewPerson(a)}}),n(".privacy-foot").delegate(".x-to-hide","click",function(){e.removeFoot(this)}),n(".privacy-foot").delegate("#hiddentype1","click",function(){i=!0,n(".privacy-foot .ui-widget-content #friendselectarea").hide(),a=1}),n(".privacy-foot").delegate("#hiddentype2","click",function(){i=!0,n(".privacy-foot .ui-widget-content #friendselectarea").show(),a=2})},removeFoot:function(e){i=!0;var t=n(e).parents(".oneperson");t.remove();var a=parseInt(n(".privacy-foot .ui-widget-content").find("#footnum").text())+1;n(".privacy-foot .ui-widget-content").find("#footnum").html(a)},addNewPerson:function(e){if(0==n("#footnum").text())return void n.dialog.error("已经选择了"+maxBlind+"个好友");for(var t=n(".user-list").children(),a=t.length-1;a>=0;a--)if(e.id==t[a].id)return void n.dialog.error("该好友已经在名单中。");i=!0;var s=['<img src="'+e.head+'">','<div class="right">','<p class="name">'+e.name+"</p>",'<p  class="x-to-hide" >删除</p>',"</div>"].join(""),o=document.getElementById("hiddenPeopleList"),r=o.childNodes[0],d=document.createElement("a");d.href="#nogo",d.className="oneperson",d.id=e.id,d.innerHTML=s,r?o.insertBefore(d,r):o.innerHTML=d.outerHTML;var l=parseInt(n(".privacy-foot .ui-widget-content").find("#footnum").text())-1;n(".privacy-foot .ui-widget-content").find("#footnum").html(l)},makecontent:function(){return""==n(".privacy-foot .ui-widget-content").html()?n(".foot-setting").html():n(".privacy-foot .ui-widget-content").find("#friendselectarea").html()},save:function(){var e="";if(1==a)e+="type=2&guestId=-1";else{for(var t=[],i=n(".user-list").children(),s=i.length-1;s>=0;s--)t.push(i[s].id);e+="type=1&guestId=-1&guestIds="+t.join("&guestIds=")}this.saveReq(e)},saveReq:function(e){i&&n.ajax({url:"http://www.renren.com/addhiddenfootprint",type:"post",data:e,dataType:"json",abortOnRetry:!0,success:function(e){var t=e;if(99==t.result){1==a?isToAll=!0:isToAll=!1;var i,s="您的设置已保存成功",o="您的设置已保存成功，访问隐身名单中的好友不留脚印";i=2==a?s:o,n.dialog.alert(i)}else 101==t.result?n.dialog.alert("当天已经设置过10次，不能再设置了"):102==t.result?n.dialog.alert("非好友关系不能设置"):-1==t.result?n.dialog.alert("服务器错误！"):n.dialog.error("您当前无权限进行操作!")}})}};e.privacyFoot=s}),jQuery(function(){jQuery(document).on("click","[data-privacyfoot]",function(){var e=this.getAttribute("data-privacyfoot");define(function(require,t){var i=require("ui/showPrivacyFoot");i.privacyFoot.init(e)})})}),function(){var e,t,i,n,a,s;e=jQuery,a=!1,n=null,t=function(t,i,o,r,d){var l,c;if(!a)return n=document.createElement("div"),l=i/2,c=d?31:Math.max(document.documentElement.scrollTop,document.body.scrollTop)+195,n.style.cssText="position:absolute;z-index:1990;left:50%;margin-left:-"+l+"px;top:"+c+"px;width:"+i+"px;height:"+o+"px;",d?(n.innerHTML='<div id="DULEISI_SWF"></div>',e("body").append(n),"undefined"==typeof swfobject?nx.load("http://s.xnimg.cn/jspro/lib/swfobject.js",function(){s(t,i,o)}):s(t,i,o)):(n.innerHTML='<embed src="'+t+'" type="application/x-shockwave-flash" width="'+i+'" height="'+o+'" wmode="transparent" allowscriptaccess="always" />',e("body").append(n)),a=!0},i=function(){a&&(n.parentNode.removeChild(n),a=!1)},s=function(t,i,n){var a={quality:"high",allowScriptAccess:"always",wmode:"transparent",bgcolor:"#FFFFFF",allowfullscreen:"false"},s={username:decodeURIComponent(nx.user.name),friHead01:"",friHead02:"",friHead03:""};s.userhead=nx.user.tinyPic;var o=e("#footprintList img");o.length&&(s.friHead01=o[0].src),o.length>=2&&(s.friHead02=o[1].src),o.length>=3&&(s.friHead03=o[2].src),swfobject.embedSWF(t,"DULEISI_SWF",i,n,"9.0.0","",s,a)},window.createHomeSwfAd=t,window.destroyHomeSwfAd=window.closeKsf=i}(),require(["jquery","ui/tabs"],function(e){var t={fortuneTab:"rp",footprintTab:"fp",birthTab:"bn"},i=["rp","fp","bn"];e(function(){var n=i.indexOf(e("#mergeSelected").val());e("#mergeModule").tabs({active:n>-1?n:0,activate:function(i,n){e.ajax({url:"http://www.renren.com/ajax/rightTabSelect",type:"POST",data:"rselected="+t[n.newTab.attr("id")],dataType:"text"})}})})}),define("fortune/fortuneItem",function(require,e){require("ui/tooltip");var t=require("jquery"),i=require("fortune/fortunePopup");e.ItemBody=function(){var e=this;e.s_item=t("#fortune"),e.s_itemBody=t("#fortune-side-item-body"),e.s_packUpBtn=e.s_item.find("#packUp"),e.s_unFoldBtn=e.s_item.find("#unFold"),e.s_assembleBtn=t("#assembleBtn"),e.s_freshBtn=e.s_item.find("#myFreshBtn"),e.s_getFreshTime=t("#interval").val(),e.init=function(){"none"==e.s_itemBody.css("display")&&e.s_item.addClass("packup"),e.CountFresh(),e.TitleHover(),e.AssbtnClick();var t=require("fortune/bodyHover");e.s_bodyHover=new t.BodyHover,e.s_bodyHover.HoverInit(e.s_getFreshTime)},e.init()},e.ItemBody.prototype={CountFresh:function(){var e=this;setTimeout(function(){e.s_freshBtn.addClass("active"),e.s_freshBtn.css("cursor","pointer");var t=e.s_item.find(".freshClock");t[0]&&t.css("display","none")},e.s_getFreshTime)},TitleHover:function(){var e=this;e.s_unFoldBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}}),e.s_packUpBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}})},AssbtnClick:function(){var e=this;e.s_assembleBtn.click(function(){var n=/msie 7/i.test(navigator.userAgent);n&&t(".nx-right").addClass("setzIndex"),e.s_packUpBtn.hide(),0==t("#forPopupBox").length&&(i.createPopup(),e.popupShow=new i.PopupShow),e.s_assembleBtn.hasClass("inactive")?"none"==e.popupShow.s_popupBox.css("display")&&e.popupShow.PopupType(0,e.s_bodyHover):e.popupShow.PopupType(1,e.s_bodyHover)})}}}),define("fortune/bodyHover",function(require,e){var t=require("jquery");e.BodyHover=function(){var e=this;e.s_item=t("#fortune"),e.s_itemBody=t("#fortune-side-item-body"),e.s_midContent=e.s_item.find(".for_content"),e.s_assembleBtn=t("#assembleBtn"),e.rightMoreLive=t("#rightMoreLive"),e.leftMoreLive=t("#leftMoreLive"),e.s_freshBtn=e.s_item.find("#myFreshBtn")},e.BodyHover.prototype={HoverInit:function(e){var t=this;t.s_getFreshTime=e,t.ChangeTime(),t.AssbtnHover(),t.FreshHover(208),t.ContentHover(),t.LeftLiveHover(),t.RightLiveHover(),"none"==t.s_itemBody.css("display")&&t.BigitemSwitch("off"),t.LearnMoreHover()},AssbtnHover:function(){var e=this,i=t("#userIfPin").val();e.s_assembleBtn.attr("title",""),"true"==i?e.s_assembleBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-10",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:"已攒"}):e.s_assembleBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-10",at:"left+66 top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").css("left","30px").appendTo(this)}},content:"点击即可随机获取人品值"})},FreshHover:function(e){var i=this;i.s_freshBtn.attr("title",""),i.s_freshBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"right+6 bottom-15",at:"left+56 top",using:function(i,n){t(this).css(i),t("<div>").addClass("right-opt-tip-arrow").css("left",e+"px").appendTo(this)}},content:function(){return i.FormatTime()}})},FormatTime:function(){var e,t=this,i=Math.floor(t.s_getFreshTime/6e4),n=Math.floor(t.s_getFreshTime%6e4/1e3),a=i+"分"+n+"秒";return t.s_getFreshTime<=0?(e="立即刷新页面即可获得1点RP",t.FreshHover(138)):e="每半小时刷新页面可获得1点RP ， 距离下<br>次还有"+a+"。",e},ContentHover:function(){var e=this;e.s_midContent.attr("title",""),e.s_midContent.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:"点击查看更多"})},RightLiveHover:function(){var e=this;e.rightMoreLive.attr("title",""),e.rightMoreLive.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:"更多直播"})},LeftLiveHover:function(){var e=this;e.leftMoreLive.attr("title",""),e.leftMoreLive.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:"更多直播"})},BigitemSwitch:function(e){var t=this;"on"==e?(t.s_assembleBtn.tooltip("enable"),t.s_midContent.tooltip("enable"),t.rightMoreLive.tooltip("enable"),t.leftMoreLive.tooltip("enable"),t.s_freshBtn.tooltip("enable")):"off"==e&&(t.s_assembleBtn.tooltip("disable"),t.s_midContent.tooltip("disable"),t.rightMoreLive.tooltip("disable"),t.leftMoreLive.tooltip("disable"),t.s_freshBtn.tooltip("disable"))},ChangeTime:function(){var e=this;setTimeout(function(){e.s_getFreshTime-=1e3,e.ChangeTime()},1e3);
},LearnMoreHover:function(){var e=this;e.s_learnMoreBtn=t("#rpLearnMoreIcon"),e.s_learnMoreBtn.attr("title",""),e.s_learnMoreBtn.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}},content:function(){var e=[];return e.push('<h3 class="fortuneLearnH3">什么是攒人品？</h3>'),e.push('<h4 style="margin-top:10px" class="fortuneLearnH4"><div class="rpLearnIcon"></div>人品值=Renren Power，是你长期混迹于人人网的象征</h4>'),e.push('<h4 class="fortuneLearnH4"><div class="rpLearnIcon"></div>每日点击一下“攒”可随机获得一定人品值</h4>'),e.push('<h4 class="fortuneLearnH4"><div class="rpLearnIcon"></div>每半小时刷新页面，也可得到1点人品值</h4>'),e.push('<h4 class="fortuneLearnH4"><div class="rpLearnIcon"></div>积攒来的人品值可以兑换各种心仪的礼品</h4>'),'<div class="rpLearnBoxWin">'+e.join("")+"</div>"}})}}}),define("fortune/fortunePopup",function(require,e){var t=require("jquery"),i=require("fortune/publisher");e.createPopup=function(){var e='<div class="fortune_popup" id="forPopupBox">                                                                              <div class="fortune_win" id="fortune_win">                                                                                    <div class="fortune_win_close" id="for_win_close"></div>                                                                                    <div class="box_mask" id="box_mask"></div>                                                                                    <div class="score_float_layer" id="score_float">                                                                                          <div class="center_box">                                                                                                <div class="text_box" id="for_scoreF_text">                                                                                                        <span><img src="http://a.xnimg.cn/imgpro/emotions/tie/18.gif" class="for_scoreF_emotion"/>恭喜您获得了<br/><span class="score_num" id="scoreNum">8</span>人品值</span>                                                                                                </div>                                                                                                <div class="verticalLine"></div>                                                                                                <div class="unlockModule">                                                                                                        <img id="rpUnlockObj"  src="http://a.xnimg.cn/n/apps/rp/res/unlockObj.png"/>                                                                                                        <div class="unlockAni"></div>                                                                                                        <span>成功解锁了每日一攒</span>                                                                                                        <a href="http://renpin.renren.com/myrp" target="_blank">全部解锁</a>                                                                                                </div>                                                                                          </div>                                                                                          <div id="rpPubSucIcon"></div>                                                                                    </div>                                                                                    <div class="popup_content_box success_unlock_box">                                                                                               <div class="unlock_obj_box">                                                                                                          <input type="hidden" class="IDhideValue"></input>                                                                                                </div>                                                                                                <div id="rpUnlockPubBox">		                                                                            <textarea name="content" placeholder="点击“炫耀一下”可获取一次攒人品机会" id="rpStatus"></textarea>		                                                                            <a href="javascript:void(0)" id="rpPubSubmit" class="ui-button-blue ui-button">炫耀一下</a>		                                                                            <span class="chars-info"><span class="chars-count">0</span>/200</span>                                                                                                </div>                                                                                    </div>                                                                                    <div class="popup_content_box no_unlock_box">                                                                                                          <span class="desc"><img src="http://a.xnimg.cn/imgpro/emotions/tie/18.gif" class="for_scoreF_emotion"/>恭喜您获得了<br/><span class="score_num"></span>人品值</span>                                                                                                <a href="http://renpin.renren.com/myrp" target="_blank" class="question"><div class="whatIcon"></div>什么是人品值？攒人品有什么用？</a>                                                                                    </div>                                                                                    <div class="for_affirm_box" id="for_affirm">                                                                                                 <div class="for_affirm_text">                                                                                                  	<span>如果关闭就会失去一次再攒人品的机会，</br>确定关闭吗？</span>                                                                                                 </div>                                                                                                <div  class="button_box">                                                                                                       <a href="#" class="for_submit ui-button-blue ui-button" id="for_sub_btn">确认</a>                                                                                                       <a href="#" class="for_cancel ui-button-white ui-button" id="for_can_btn">取消</a>                                                                                                </div>                                                                                    </div>                                                                                    <div class="popup_content_box rank_list_box">                                                                                                <div class="assembledTip">你今天攒过了，尝试每半小时刷新获取更多人品吧</div>                                                                                                <div class="todayRpRank" id="todayRpRank">                                                                                                          <h3>今日人品排名</h3><a href="http://renpin.renren.com/myrp" target="_blank" class="viewMore">查看更多</a>                                                                                                          <ul>                                                                                                                  <li id="rpRankOne"><div class="rankBox"><a class="rpRankHead" target="_blank"><img src=""/></a></div><a class="rankName" target="_blank"></a><span class="rankRp">15</span></li>                                                                                                                  <li id="rpRankTwo"><div class="rankBox"><a class="rpRankHead" target="_blank"><img src=""/></a></div><a class="rankName" target="_blank"></a><span class="rankRp">15</span></li>                                                                                                                  <li id="rpRankThree"><div class="rankBox"><a class="rpRankHead" target="_blank"><img src=""/></a></div><a class="rankName" target="_blank"></a><span class="rankRp">15</span></li>                                                                                                          <ul>                                                                                                </div>                                                                                                <div class="rpMallEntry"><span>攒了这么多RP，看看能兑换点什么吧？</span><a href="http://renpin.renren.com/mall" class="mall_button" target="_blank">RP兑换中心</a></div>                                                                                    </div>                                                                        </div></div>';t("#fortune-side-item-body").append(e)},e.PopupShow=function(){var e=this;e.s_item=t("#fortune"),e.s_popupBox=t("#forPopupBox"),e.s_fortuneWin=t("#fortune_win"),e.s_contentBox=e.s_fortuneWin.find(".popup_content_box "),e.s_unlockBox=e.s_item.find(".success_unlock_box"),e.s_noUnlockBox=e.s_item.find(".no_unlock_box"),e.s_rankListBox=e.s_item.find(".rank_list_box"),e.s_scoreFloat=t("#score_float"),e.s_assembledIcon=e.s_item.find(".assembled"),e.s_fortuneWinClose=t("#for_win_close"),e.s_affirmBox=t("#for_affirm"),e.s_closeAble=!0,e.s_popOpen=!1,e.ForWinClose()},e.PopupShow.prototype={PopupType:function(e,t){var i=this;i.s_showType=e,i.DocCloseFun(),0==i.s_showType?i.RankListPopup():1==i.s_showType&&i.GetRpPopup(),i.s_bodyHover=t},RankListPopup:function(){var e=this,i=t(".double-cols-feed");e.RankAjax(),e.InitSize(345,420),i[0]?e.s_fortuneWin.css("left","0px"):e.s_fortuneWin.css("right","-88px"),e.s_contentBox.hide(),e.s_popupBox.show(),e.s_rankListBox.show()},RankAjax:function(){var e=this;t.ajax({url:"http://renpin.renren.com/info/rankinfo",type:"POST",dataType:"json",success:function(i){if(0==i.code){for(var n=i.data,a=0;3>a;a++)if(n[a]){var s=t("#todayRpRank").find("li").eq(a);s.css("visibility","visible"),s.find(".rpRankHead").attr("href","http://www.renren.com/"+n[a].userId+"/profile").find("img").attr("src",n[a].pic),s.find(".rankName").attr("href","http://www.renren.com/"+n[a].userId+"/profile").html(n[a].name),s.find(".rankRp").html(n[a].dailyRp)}e.s_closeAble=!0,e.s_popOpen=!0,e.s_bodyHover.BigitemSwitch("off")}else t.dialog.error(i.msg)},error:function(){t.dialog.error("服务器异常,请稍后再试!")}})},InitSize:function(e,t){var i=this;i.s_fortuneWin.css({height:e+"px",width:t+"px"}),i.s_popupBox.css("width",t+2+"px")},GetRpAjax:function(){var e=this;t.ajax({url:"http://renpin.renren.com/action/collectrp",type:"POST",dataType:"json",success:function(i){if(0==i.code){var n=i.unlockInfo;if(e.s_ifUnlock=n.id,-1==i.currRp?e.s_popupBox.find(".for_scoreF_emotion").show():e.s_popupBox.find(".for_scoreF_emotion").hide(),e.s_popupBox.find(".score_num").html(i.currRp),t("#bTotalRpNum").html(i.rp),t("#bTodayRpNum").html(i.dailyRp),t("#totalRp").val(i.rp),0==t(".assembled").length){var a='<div class="assembled"></div>';t(".fortuneBar").append(a),e.s_assembledIcon=e.s_item.find(".assembled")}t("#userIfPin").val("true"),t("#assembleBtn").addClass("inactive"),e.s_bodyHover.AssbtnHover(),e.s_bodyHover.BigitemSwitch("off"),e.s_assembledIcon.show(),"undefined"==typeof e.s_ifUnlock?e.NoUnlockPopup():(e.s_unlockBox.find(".unlock_obj_box").append('<img id="unlock_new_obj" src="'+n.fullurl+'"/>'),e.s_unlockBox.find(".IDhideValue").attr("value",n.id),t("#rpUnlockObj").attr("src",n.picUrl),e.s_scoreFloat.find(".unlockModule span").html('成功解锁了"'+n.name+'"'),e.UnlockPopup(n.name))}else t.dialog.error(i.msg)},error:function(){t.dialog.error("服务器异常,请稍后再试!")}})},GetRpPopup:function(){var e=this;e.GetRpAjax()},UnlockPopup:function(e){var n=this;n.s_closeAble=!1,n.s_popOpen=!0,n.InitSize(250,360),n.s_contentBox.hide(),n.s_fortuneWin.css("right","-61px"),new i.fortunePublisher("#rpUnlockPubBox"),n.s_pubSubmit=t("#rpPubSubmit"),n.s_pubContent=t("#rpStatus"),n.PubSubmit(e),n.s_popupBox.show(),n.s_unlockBox.show(),n.FloatAni(0)},NoUnlockPopup:function(){var e=this;e.s_closeAble=!0,e.s_popOpen=!0,e.s_fortuneWin.css("right","0"),e.InitSize(150,238),e.s_contentBox.hide(),e.s_popupBox.show(),e.s_noUnlockBox.show()},FloatAni:function(e){var i=this,n=3e3;i.s_scoreFloatCenter=i.s_scoreFloat.find(".center_box"),i.s_pubIcon=t("#rpPubSucIcon"),1==e?(n=3e3,i.s_scoreFloatCenter.hide(),i.s_pubIcon.show()):(i.s_scoreFloatCenter.show(),i.s_pubIcon.hide()),i.s_scoreFloat.show(),setTimeout(function(){i.s_scoreFloat.fadeOut("slow")},n)},PubSubmit:function(e){var n=this;n.s_pubSubmit.unbind("click"),n.s_pubSubmit.click(function(){if(i.publisherCheck("#rpUnlockPubBox")&&!n.s_pubSubmit.hasClass("ui-state-disabled")){n.s_pubSubmit.addClass("ui-state-disabled");var a=n.s_pubContent.val(),s=n.s_unlockBox.find(".IDhideValue").val();(""==a||"点击“炫耀一下”可获取一次攒人品机会"==a)&&(a='成功解锁了"'+e+'"!'),t.ajax({url:"http://renpin.renren.com/action/publish",type:"POST",data:"content="+a+"&unlockid="+s+"&from=1",dataType:"json",success:function(e){if(0==e.code){e.unlockInfo;n.s_pubContent.val(""),n.FloatAni(1),setTimeout(function(){t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),n.s_popupBox.hide(),e.auth&&(t("#assembleBtn").removeClass("inactive"),n.s_assembledIcon.hide(),t("#userIfPin").val("false"),n.s_bodyHover.AssbtnHover()),n.s_closeAble=!0,n.s_popOpen=!1,n.s_bodyHover.BigitemSwitch("on"),t("#unlock_new_obj").remove(),n.s_pubSubmit.removeClass("ui-state-disabled")},3e3)}else t.dialog.error(e.msg)},error:function(){t.dialog.error("服务器异常,请稍后再试!")}})}})},ForWinClose:function(){var e=this;e.s_affirmCancelBtn=t("#for_can_btn"),e.s_affirmSubmitBtn=t("#for_sub_btn"),e.s_fortuneWinClose.click(function(){e.s_closeAble?(t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),e.s_popupBox.hide(),e.s_popOpen=!1,e.s_bodyHover.BigitemSwitch("on")):e.CloseAffirmFun()}),e.s_affirmCancelBtn.click(function(){e.s_affirmBox.slideUp("fast")}),e.s_affirmSubmitBtn.click(function(){t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),e.s_affirmBox.hide(),e.s_popupBox.hide(),e.s_pubContent.val(""),e.s_closeAble=!0,e.s_popOpen=!1,e.s_bodyHover.BigitemSwitch("on"),t("#unlock_new_obj").remove()})},DocCloseFun:function(){var e=this,i=!0;t(document).bind("click.fortune",function(){i&&e.s_closeAble&&e.s_popOpen&&(t(".nx-right").hasClass("setzIndex")&&t(".nx-right").removeClass("setzIndex"),e.s_popupBox.hide(),e.s_popOpen=!1,e.s_bodyHover.BigitemSwitch("on"),t(document).unbind("click.fortune")),i=!0}),e.s_popupBox.click(function(){i=!1})},CloseAffirmFun:function(){var e=this;e.s_affirmBox.slideDown("fast")}}}),define("fortune/publisher",function(require,e){var t=require("jquery");e.fortunePublisher=function(e){var i=this;i.s_container=t(e),i.s_pubBtn=t("#rpPubSubmit"),i.s_pubInput=t("#rpStatus"),i.s_charsBox=i.s_container.find(".chars-info"),i.s_countText=i.s_container.find(".chars-count"),i.s_charsTotal=200,i.init=function(){i.OpenAt(),i.TextareaClick(),i.StopClick()},i.init()},e.fortunePublisher.prototype={OpenAt:function(){var e=this;require.async(["ui/renren/at"],function(){e.s_pubInput.renrenat()})},TextareaClick:function(){var e=this;e.s_pubInput.click(function(){e.StartCharsCounter()})},StartCharsCounter:function(){var e=this;e.s_charsTotal<0||(e.s_charsCounter=setInterval(function(){e.UpdateCharsCount()},500))},StopCharsCounter:function(){clearInterval(self.s_charsCounter)},UpdateCharsCount:function(){var e=this,t=e.GetLength(e.s_pubInput.val());e.s_countText.text(t.toString()),parseInt(e.s_countText.text())>200?(e.s_charsBox.addClass("active"),e.s_pubBtn.addClass("ui-state-disabled")):(e.s_charsBox.removeClass("active"),e.s_pubBtn.removeClass("ui-state-disabled"))},GetLength:function(e){var t=e.length;return t},StopClick:function(){var e=this;e.s_pubBtn.click(function(){e.StopCharsCounter()}),t("#for_sub_btn").click(function(){e.StopCharsCounter()})}},e.publisherCheck=function(e){var i=this,n=!0;return i.s_container=t(e),i.s_countText=i.s_container.find(".chars-count"),parseInt(i.s_countText.text())>200&&(n=!1),n}}),define(function(require,e){var t=require("fortune/fortuneItem");jQuery(function(e){new t.ItemBody})}),define("right/birthMoudle",function(require,e){require("ui/tooltip");var t=require("jquery");e.BirthBody=function(){var e=this;e.birthBox=t("#homeBirthdayPart"),e.pageIndex=1,e.totalPage=Math.ceil(t("#birthNum").val()/3),e.init=function(){e.setBgImg(),e.titleHover(),e.sendGift(),e.turnPage(),e.initName(),e.totalPage>1&&e.initOption()},e.init()},e.BirthBody.prototype={setBgImg:function(){var e=t("#birthNoticeList"),i=t("#homeBirthdayPart"),n=e.find("li");n.length>1&&i.removeClass("double-nobirth-bg")},initOption:function(){var e=this,t=e.birthBox.find(".pager-forward,.pager-back");e.birthBox.hover(function(){t.show()},function(){t.hide()})},titleHover:function(){var e=this;e.birthBox.find(".pager-forward,.pager-back,.more").tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}})},sendGift:function(){var e=this;t(document).on("click","#homeBirthdayPart .giftBtn",function(){e.birthBox.find(".birthListBox").removeClass("overHide"),t("#mergeModule").addClass("overHide");var i='<div class="optionBox"><a href="javascript:;" id="bSendGift">送Ta礼物</a><a id="bSendMsg" href="javascript:void(0)" onclick="window.webpager.talk('+t(this).attr("data")+')">给Ta留言</a></div>';t(this).parent().css("z-index",10).append(i),t(".mergeBody").css({"z-index":10,position:"relative"}),e.bindClick(t(this).attr("data")),e.docClick()}),t("#birthNoticeList").delegate(".common-sendGift","click",function(){var i=t(this).attr("data-id");return e.sendGiftFn(i),!1})},initName:function(){var e=this;if(e.birthBox.find(".name").length>0)for(var t=e.birthBox.find(".name"),i=t.length,n=0;i>n;n++){var a=t.eq(n).html(),s=a.replace(/[^\x00-\xff]/g,"**").length;s>=11?e.nameHover(t.eq(n)):t.eq(n).removeAttr("title")}},nameHover:function(e){e.tooltip({tooltipClass:"right-opt-tip",position:{my:"center bottom-12",at:"center top",using:function(e,i){t(this).css(e),t("<div>").addClass("right-opt-tip-arrow").appendTo(this)}}})},docClick:function(){var e=this;t(document).bind("click.birth",function(){e.birthBox.find(".optionBox").parent().removeAttr("style"),t(".mergeBody").removeAttr("style"),e.birthBox.find(".optionBox").remove(),e.birthBox.find(".birthListBox").addClass("overHide"),t("#mergeModule").removeClass("overHide"),t(document).unbind("click.birth")})},sendGiftFn:function(e){var i=this;this.giftModuleInited?i.showBirthDialog(e):t.ajax({url:"http://i.renren.com/api4v7/getV7BirthGiftJsSrc",type:"post",dataType:"json",success:function(t){define.config({map:{"vip/plugin/sendBirthGift":t[0]}}),i.giftModuleInited=!0,i.showBirthDialog(e)}})},bindClick:function(e){var i=this;t("#bSendGift").click(function(){i.sendGiftFn(e)})},showBirthDialog:function(e){define(["vip/plugin/sendBirthGift"],function(t){t.initialize(e)})},turnPage:function(){function e(){var e=3,o="-215px",r='<div class="listGroup">';if(i.birthBox.find(".listGroup").length<=i.pageIndex){for(var d=i.pageIndex==i.totalPage-1?a.length:3*(i.pageIndex+1),l=i.pageIndex*e;d>l;l++){var c=a[l].name,h=c.replace(/[^\x00-\xff]/g,"**").length,p=h>=11?"overLen":"removeTitle";r+='<li class="common-item"><div class="ui-button giftBtn" data="'+a[l].id+'"><span>送礼</span><div class="arrowIcon"></div></div><a href="http://www.renren.com/'+a[l].id+'/profile" namecard="'+a[l].id+'" class="userPhoto"><img src="'+a[l].tinyPhotoUrl+'"/></a><a href="http://www.renren.com/'+a[l].id+'/profile" namecard="'+a[l].id+'" class="name '+p+'" title="'+a[l].name+'">'+a[l].name+'</a><span class="birthday">'+a[l].birthString+'</span><p class="birthday-item-ctl"><a href="javascript:;" class="common-sendGift" data-id="'+a[l].id+'">送礼</a>|<a href="javascript:;" class="leave-message" onclick="window.webpager.talk('+a[l].id+');return false;">留言</a></p></li>'}r+="</div>";var f=t(r);i.nameHover(t(".overLen",f)),t(".removeTitle",f).removeAttr("title"),t("#birthNoticeList").append(f)}n=!0,i.birthBox.find(".listGroup").not(":eq("+(i.pageIndex-1)+"),:eq("+i.pageIndex+")").hide(),i.birthBox.find(".listGroup").eq(i.pageIndex-1).animate({"margin-left":o},function(){if(i.birthBox.find(".listGroup").eq(i.pageIndex-1).hide(),i.pageIndex++,i.pageIndex===i.totalPage){var e=i.birthBox.find(".listGroup").eq(i.pageIndex-1),a=e.children("li").length;1==a&&t("#homeBirthdayPart").addClass("double-nobirth-bg"),s.addClass("forward-disable")}n=!1})}var i=this,n=!1,a=null,s=i.birthBox.find(".pager-forward"),o=i.birthBox.find(".pager-back");s.click(function(){return t(this).hasClass("forward-disable")||n?!1:(i.birthBox.find(".listGroup").show(),o.removeClass("back-disable"),void(null===a?t.ajax({url:"http://www.renren.com/ajaxFriendBirthdays/get7daysFriendBirthdays",type:"post",dataType:"json",success:function(t){a=t.friendBirthdays,e()}}):e()))}),o.click(function(){return t(this).hasClass("back-disable")||n?!1:(t("#homeBirthdayPart").removeClass("double-nobirth-bg"),s.removeClass("forward-disable"),i.birthBox.find(".listGroup").show(),n=!0,i.birthBox.find(".listGroup").not(":eq("+(i.pageIndex-2)+"),:eq("+(i.pageIndex-1)+")").hide(),void i.birthBox.find(".listGroup").eq(i.pageIndex-2).animate({"margin-left":"0"},function(){i.birthBox.find(".listGroup").eq(i.pageIndex-1).hide(),i.pageIndex--,1===i.pageIndex&&o.addClass("back-disable"),n=!1}))})}}}),define(function(require,e){var t=require("right/birthMoudle");jQuery(function(e){new t.BirthBody})}),require(["jquery","ui/tabs"],function(e){var t=e("#viparea"),i=e("#viparea-main-area"),n=e(".notice-area");t.tabs({collapsible:!0,memoryKey:"homevipareawrapper",activate:function(t,n){e.ajax({type:"POST",dataType:"text",url:"http://i.renren.com/homecenter/pop",data:0}),n.newPanel.length?(e("#viparea-control").addClass("slide-control-opened"),i.addClass("viparea-show")):(e("#viparea-control").removeClass("slide-control-opened"),i.removeClass("viparea-show"))}}),i.tabs({event:"mouseenter",memoryKey:"homeviparea",active:e("#viparea-main-area").data("tab"),beforeLoad:function(t,i){return 0!==i.panel.children().length?!1:void e.extend(i.ajaxSettings,{type:"post",dataType:"text",success:function(e){i.panel.html(e)},error:function(){i.panel.html("网络服务异常，请稍后再试")}})},activate:function(t,i){var n=i.newTab.siblings().addBack().index(i.newTab);e("#viparea_nav span").animate({left:35*n+"px"})}}),i.on("click",".viparea_area_c a",function(t){if(this.hash&&0===this.hash.indexOf("#/viparea/")){t.preventDefault(),i.trigger("componentChange");var n=this.hash.split("/");require([n.slice(1,4).join("/")],function(t){t.init({reset:e.noop,con:{on:function(e,t){i.on(e,t)}}},n.slice(4))})}}),n.find(".close-notice-area").click(function(){n.remove();var t=n.find(".notice-content");e.ajax({type:"POST",dataType:"text",url:"http://i.renren.com/api4v7/cancelMemberZoneDisplay?uid="+nx.user.id+"&displayId="+t.attr("data-id")+"&position="+t.attr("data-position")})})}),function(){function e(){i.hide()}$=jQuery;var t=$("#vip_fixed_point"),i=$("#vip-notice-all"),n=$(".vip-notice-dialog"),a=$("#notice-buttons");n.length&&(t.append(i),i.show(),i.find(".ui-widget-content").replaceWith(n.addClass("ui-widget-content").show()),a.length&&i.find(".ui-dialog-buttonset").replaceWith(a.addClass("ui-dialog-buttonset").show()),i.find(".ui-dialog-close").click(function(){e()}))}(),define("home/safeAuth",function(require,e,t){var i,n,a,s,o,r,d,l,c;return i=require("jquery"),require("ui/dialog"),n=require("mustache.js"),o='<div class="dialog-safe">\n <p>为了亲的帐号安全考虑，完成一个快速的安全实名认证吧！</p>\n</div> ',r='<div class="verify-form">\n  <div class="header"><h3>进行安全验证</h3></div>\n  <div class="item">\n    <div class="leftpart"><label for="regMobile">手机号码&nbsp;:</label></div>\n    <div class="rightpart">\n      <input type="text" name="mobile" id="regMobile" maxlength="11" tabindex="1" class="left" autocomplete="off">\n    </div>\n  </div>\n  <div class="item">\n    <div class="leftpart"><label for="icode">短信验证码&nbsp;:</label></div>\n    <div class="rightpart">\n      <input type="text" name="icode" id="icode" class="left verify_icode" maxlength="6" value="" tabindex="3"> \n      <button type="button" id="btn_getcode" class="verify_geticode ui-button ui-button-default" tabindex="4">发送验证码</button>\n    </div>\n  </div>\n</div>',d={error:'<span class="msginfo">\n  <i class="ui-icon ui-iconfont icon-error" title="{{msg}}">&#xe877;</i>\n</span>',success:'<span class="msginfo"><i class="ui-icon ui-iconfont icon-success"></i></span>'},c=null,s=function(){return i(o).dialog({appendTo:"body",dialogClass:"ui-dialog-confirm",buttons:[{text:"现在就去","class":"ui-button-green",click:function(){return l(),i(this).dialog("instance").destroy()}}]})},l=function(){return c=i(r).dialog({appendTo:"body",dialogClass:"ui-dialog-confirm",width:480,buttons:[{text:"完成","class":"ui-button-green complete-secur-verify",click:function(){return a.sendPost()}}]}),a.init()},a={mobile:"",code:"",t:60,getCodeUrl:"http://reg.renren.com/realinfo/verify/downCode",bindUrl:"http://reg.renren.com/realinfo/bindMobile",init:function(){return i(function(){return i(".item").on("keyup","input",function(e){var t;return t=i(e.currentTarget),"mobile"===t.attr("name")&&(a.mobile=i.trim(t.val())),"icode"===t.attr("name")?(t.val().length>6&&t.val(t.val().substring(0,6)),a.code=i.trim(t.val())):void 0}),i(".item").on("focusout","input",function(e){var t,n;return n=a,t=i(e.currentTarget),a.verify[t.attr("name")](t,n),a.btnActive()}),i(".item").on("focusin","input",function(e){var t;return t=i(e.currentTarget),t.parent().find(".msginfo").remove()}),i("#btn_getcode").on("click",function(e){return/^1[3|4|5|7|8][0-9]\d{8}$/.test(a.mobile)?(a.getCode(),i(this).prop("disabled",!0)):i.dialog.error("请输入正确的手机号")})})},sendPost:function(){var e;return e=i(".complete-secur-verify"),a.verify.mobile(i("#regMobile"),a,!0)&&a.verify.icode(i("#icode"),a,!0),e.hasClass("active")?(a.bindMobile(),e.prop("disabled",!0)):void 0},btnActive:function(){return 2===i(".verify-form").find(".icon-success").length?i(".complete-secur-verify").addClass("active"):i(".complete-secur-verify").removeClass("active")},verify:{mobile:function(e,t,n){return 0===t.mobile.length?(t.infoMsg.error(e,"手机号不能为空"),n&&i.dialog.error("手机号不能为空"),!1):/^1[3|4|5|7|8][0-9]\d{8}$/.test(t.mobile)?(t.infoMsg.success(e),!0):(t.infoMsg.error(e,"请输入正确的手机号"),n&&i.dialog.error("请输入正确的手机号"),!1)},icode:function(e,t,n){return 0===t.code.length?(t.infoMsg.error(e,"验证码不能为空"),n&&i.dialog.error("验证码不能为空"),!1):/^\d{6}$/.test(t.code)?t.infoMsg.success(e):(t.infoMsg.error(e,"请输入有效的验证码"),n&&i.dialog.error("请输入有效的验证码"),!1)}},infoMsg:{error:function(e,t){var i;return i=n.render(d.error,{msg:t}),e.parent().find(".msginfo").remove().end().append(i)},success:function(e){return e.parent().find(".msginfo").remove().end().append(d.success)}},timeInterval:function(){var e,t,n;return t=a,e=i("#btn_getcode"),e.text(t.t+"秒重新发送"),n=setInterval(function(){return 0!==t.t?(t.t--,e.text(t.t+"秒重新发送")):(clearInterval(n),t.t=60,e.text("发送验证码").prop("disabled",!1))},1e3)},getCode:function(){var e;return e=this,i.ajax({url:e.getCodeUrl,type:"get",data:{mobile:this.mobile},dataType:"json"}).done(function(t){return 0===t.code?e.timeInterval():(i.dialog.error(t.msg),i("#btn_getcode").prop("disabled",!1))}).fail(function(e){return i.dialog.error("服务异常,请稍后重试"),i("#btn_getcode").prop("disabled",!1)})},bindMobile:function(){var e;return e=this,i.ajax({url:e.bindUrl,type:"post",data:{mobile:this.mobile,code:this.code},dataType:"json"}).done(function(e){return 0===e.code?(i(".complete-secur-verify").remove(),c.dialog("instance").destroy(),window.location.href="http://www.renren.com"):(i.dialog.error(e.msg+"或者验证码已经过期"),i(".complete-secur-verify").prop("disabled",!1))}).fail(function(){return i.dialog.error("服务异常，请稍后重试"),i(".complete-secur-verify").prop("disabled",!1)})}},t.exports={init:s}}),require(["home/safeAuth","jquery"],function(e,t){return t.get("http://www.renren.com/ajax/realnamecheck/isNeedPop",function(t){return 0===t.errCode&&t.isNeedPop===!0?e.init():void 0},"json")}),playShadow(jQuery);